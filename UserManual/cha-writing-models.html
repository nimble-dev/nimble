<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Writing models in NIMBLE’s dialect of BUGS | NimbleUserManual.knit</title>
  <meta name="description" content="This is the NIMBLE User Manual." />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Writing models in NIMBLE’s dialect of BUGS | NimbleUserManual.knit" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/nimble-icon.png" />
  <meta property="og:description" content="This is the NIMBLE User Manual." />
  <meta name="github-repo" content="nimble-dev/nimble" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Writing models in NIMBLE’s dialect of BUGS | NimbleUserManual.knit" />
  
  <meta name="twitter:description" content="This is the NIMBLE User Manual." />
  <meta name="twitter:image" content="/nimble-icon.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cha-installing-nimble.html"/>
<link rel="next" href="cha-building-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<img src="./nimble-icon.png"
     width=100>
<li><a href="./cha-welcome-nimble.html">NIMBLE User Manual, Version 1.2.0</a></li>
<li><a href="https://github.com/nimble-dev/nimble">NIMBLE Development Team</a></li>
<li><a href="https://R-nimble.org">https://R-nimble.org</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html"><i class="fa fa-check"></i><b>1</b> Welcome to NIMBLE</a>
<ul>
<li class="chapter" data-level="1.1" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html#sec:what-is-nimble"><i class="fa fa-check"></i><b>1.1</b> What does NIMBLE do?</a></li>
<li class="chapter" data-level="1.2" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html#how-to-use-this-manual"><i class="fa fa-check"></i><b>1.2</b> How to use this manual</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html"><i class="fa fa-check"></i><b>2</b> Lightning introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:brief-example"><i class="fa fa-check"></i><b>2.1</b> A brief example</a></li>
<li class="chapter" data-level="2.2" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-model"><i class="fa fa-check"></i><b>2.2</b> Creating a model</a></li>
<li class="chapter" data-level="2.3" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:compiling-model"><i class="fa fa-check"></i><b>2.3</b> Compiling the model</a></li>
<li class="chapter" data-level="2.4" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:intro-runMCMC"><i class="fa fa-check"></i><b>2.4</b> One-line invocation of MCMC</a></li>
<li class="chapter" data-level="2.5" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-mcmc"><i class="fa fa-check"></i><b>2.5</b> Creating, compiling and running a basic MCMC configuration</a></li>
<li class="chapter" data-level="2.6" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:customizing-mcmc"><i class="fa fa-check"></i><b>2.6</b> Customizing the MCMC</a></li>
<li class="chapter" data-level="2.7" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:running-mcem"><i class="fa fa-check"></i><b>2.7</b> Running MCEM</a></li>
<li class="chapter" data-level="2.8" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-your-own"><i class="fa fa-check"></i><b>2.8</b> Creating your own functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html"><i class="fa fa-check"></i><b>3</b> More introduction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#nimble-adopts-and-extends-the-bugs-language-for-specifying-models"><i class="fa fa-check"></i><b>3.1</b> NIMBLE adopts and extends the BUGS language for specifying models</a></li>
<li class="chapter" data-level="3.2" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#sec:nimble-lang-writ"><i class="fa fa-check"></i><b>3.2</b> nimbleFunctions for writing algorithms</a></li>
<li class="chapter" data-level="3.3" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#sec:nimble-algor-libr"><i class="fa fa-check"></i><b>3.3</b> The NIMBLE algorithm library</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html"><i class="fa fa-check"></i><b>4</b> Installing NIMBLE</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:requ-run-nimble"><i class="fa fa-check"></i><b>4.1</b> Requirements to run NIMBLE</a></li>
<li class="chapter" data-level="4.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:compiler"><i class="fa fa-check"></i><b>4.2</b> Installing a C++ compiler for NIMBLE to use</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#macos"><i class="fa fa-check"></i><b>4.2.1</b> MacOS</a></li>
<li class="chapter" data-level="4.2.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#linux"><i class="fa fa-check"></i><b>4.2.2</b> Linux</a></li>
<li class="chapter" data-level="4.2.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#windows"><i class="fa fa-check"></i><b>4.2.3</b> Windows</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#installing-the-nimble-package"><i class="fa fa-check"></i><b>4.3</b> Installing the NIMBLE package</a></li>
<li class="chapter" data-level="4.4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#troubleshooting-installation-problems"><i class="fa fa-check"></i><b>4.4</b> Troubleshooting installation problems</a></li>
<li class="chapter" data-level="4.5" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#customizing-your-installation"><i class="fa fa-check"></i><b>4.5</b> Customizing your installation</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#using-your-own-copy-of-eigen"><i class="fa fa-check"></i><b>4.5.1</b> Using your own copy of Eigen</a></li>
<li class="chapter" data-level="4.5.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#using-libnimble"><i class="fa fa-check"></i><b>4.5.2</b> Using libnimble</a></li>
<li class="chapter" data-level="4.5.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:blas"><i class="fa fa-check"></i><b>4.5.3</b> BLAS and LAPACK</a></li>
<li class="chapter" data-level="4.5.4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#customizing-compilation-of-the-nimble-generated-c"><i class="fa fa-check"></i><b>4.5.4</b> Customizing compilation of the NIMBLE-generated C++</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Models in NIMBLE</b></span></li>
<li class="chapter" data-level="5" data-path="cha-writing-models.html"><a href="cha-writing-models.html"><i class="fa fa-check"></i><b>5</b> Writing models in NIMBLE’s dialect of BUGS</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:supp-feat-bugs"><i class="fa fa-check"></i><b>5.1</b> Comparison to BUGS dialects supported by WinBUGS, OpenBUGS and JAGS</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#supported-features-of-bugs-and-jags"><i class="fa fa-check"></i><b>5.1.1</b> Supported features of BUGS and JAGS</a></li>
<li class="chapter" data-level="5.1.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:extensions-bugs"><i class="fa fa-check"></i><b>5.1.2</b> NIMBLE’s Extensions to BUGS and JAGS</a></li>
<li class="chapter" data-level="5.1.3" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:not-yet-supported"><i class="fa fa-check"></i><b>5.1.3</b> Not-supported features of BUGS and JAGS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#writing-models"><i class="fa fa-check"></i><b>5.2</b> Writing models</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#declaring-stochastic-and-deterministic-nodes"><i class="fa fa-check"></i><b>5.2.1</b> Declaring stochastic and deterministic nodes</a></li>
<li class="chapter" data-level="5.2.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:more-kinds-bugs"><i class="fa fa-check"></i><b>5.2.2</b> More kinds of BUGS declarations</a></li>
<li class="chapter" data-level="5.2.3" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:vectorized-versus-scalar-declarations"><i class="fa fa-check"></i><b>5.2.3</b> Vectorized versus scalar declarations</a></li>
<li class="chapter" data-level="5.2.4" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:dists-and-functions"><i class="fa fa-check"></i><b>5.2.4</b> Available distributions</a></li>
<li class="chapter" data-level="5.2.5" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:BUGS-lang-fxns"><i class="fa fa-check"></i><b>5.2.5</b> Available BUGS language functions</a></li>
<li class="chapter" data-level="5.2.6" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:BUGS-link"><i class="fa fa-check"></i><b>5.2.6</b> Available link functions</a></li>
<li class="chapter" data-level="5.2.7" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:trunc"><i class="fa fa-check"></i><b>5.2.7</b> Truncation, censoring, and constraints</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cha-building-models.html"><a href="cha-building-models.html"><i class="fa fa-check"></i><b>6</b> Building and using models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cha-building-models.html"><a href="cha-building-models.html#creating-model-objects"><i class="fa fa-check"></i><b>6.1</b> Creating model objects</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cha-building-models.html"><a href="cha-building-models.html#using-nimblemodel-to-create-a-model"><i class="fa fa-check"></i><b>6.1.1</b> Using <em>nimbleModel</em> to create a model</a></li>
<li class="chapter" data-level="6.1.2" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:readBUGSmodel"><i class="fa fa-check"></i><b>6.1.2</b> Creating a model from standard BUGS and JAGS input files</a></li>
<li class="chapter" data-level="6.1.3" data-path="cha-building-models.html"><a href="cha-building-models.html#sub:multiple-instances"><i class="fa fa-check"></i><b>6.1.3</b> Making multiple instances from the same model definition</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:nodes-and-variables"><i class="fa fa-check"></i><b>6.2</b> NIMBLE models are objects you can query and manipulate</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:what-are-nodes-and-variables"><i class="fa fa-check"></i><b>6.2.1</b> What are variables and nodes?</a></li>
<li class="chapter" data-level="6.2.2" data-path="cha-building-models.html"><a href="cha-building-models.html#determining-the-nodes-and-variables-in-a-model"><i class="fa fa-check"></i><b>6.2.2</b> Determining the nodes and variables in a model</a></li>
<li class="chapter" data-level="6.2.3" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:accessing-nodes"><i class="fa fa-check"></i><b>6.2.3</b> Accessing nodes</a></li>
<li class="chapter" data-level="6.2.4" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:how-nodes-are"><i class="fa fa-check"></i><b>6.2.4</b> How nodes are named</a></li>
<li class="chapter" data-level="6.2.5" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:why-use-node"><i class="fa fa-check"></i><b>6.2.5</b> Why use node names?</a></li>
<li class="chapter" data-level="6.2.6" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:cdisdata"><i class="fa fa-check"></i><b>6.2.6</b> Checking if a node holds data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="cha-building-models.html"><a href="cha-building-models.html#using-models-in-parallel"><i class="fa fa-check"></i><b>6.3</b> Using models in parallel</a></li>
</ul></li>
<li class="part"><span><b>III Algorithms in NIMBLE</b></span></li>
<li class="chapter" data-level="7" data-path="cha-mcmc.html"><a href="cha-mcmc.html"><i class="fa fa-check"></i><b>7</b> MCMC</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:nimbleMCMC"><i class="fa fa-check"></i><b>7.1</b> One-line invocation of MCMC: <em>nimbleMCMC</em></a></li>
<li class="chapter" data-level="7.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-configuration"><i class="fa fa-check"></i><b>7.2</b> The MCMC configuration</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:default-mcmc-conf"><i class="fa fa-check"></i><b>7.2.1</b> Default MCMC configuration</a></li>
<li class="chapter" data-level="7.2.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:customizing-mcmc-conf"><i class="fa fa-check"></i><b>7.2.2</b> Customizing the MCMC configuration</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:build-compile-mcmc"><i class="fa fa-check"></i><b>7.3</b> Building and compiling the MCMC</a></li>
<li class="chapter" data-level="7.4" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:initMCMC"><i class="fa fa-check"></i><b>7.4</b> Initializing MCMC</a></li>
<li class="chapter" data-level="7.5" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:runMCMC"><i class="fa fa-check"></i><b>7.5</b> User-friendly execution of MCMC algorithms: <em>runMCMC</em></a></li>
<li class="chapter" data-level="7.6" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:executing-the-mcmc-algorithm"><i class="fa fa-check"></i><b>7.6</b> Running the MCMC</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-rerun"><i class="fa fa-check"></i><b>7.6.1</b> Rerunning versus restarting an MCMC</a></li>
<li class="chapter" data-level="7.6.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:sampler-time"><i class="fa fa-check"></i><b>7.6.2</b> Measuring sampler computation times: <em>getTimes</em></a></li>
<li class="chapter" data-level="7.6.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#assessing-the-adaption-process-of-rw-and-rw_block-samplers"><i class="fa fa-check"></i><b>7.6.3</b> Assessing the adaption process of <em>RW</em> and <em>RW_block</em> samplers</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:extracting-samples"><i class="fa fa-check"></i><b>7.7</b> Extracting MCMC samples</a></li>
<li class="chapter" data-level="7.8" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:WAIC"><i class="fa fa-check"></i><b>7.8</b> Calculating WAIC</a></li>
<li class="chapter" data-level="7.9" data-path="cha-mcmc.html"><a href="cha-mcmc.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>7.9</b> k-fold cross-validation</a></li>
<li class="chapter" data-level="7.10" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc"><i class="fa fa-check"></i><b>7.10</b> Variable selection using Reversible Jump MCMC</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc-indicator"><i class="fa fa-check"></i><b>7.10.1</b> Using indicator variables</a></li>
<li class="chapter" data-level="7.10.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc-no-indicator"><i class="fa fa-check"></i><b>7.10.2</b> Without indicator variables</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:samplers-provided"><i class="fa fa-check"></i><b>7.11</b> Samplers provided with NIMBLE</a>
<ul>
<li class="chapter" data-level="7.11.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#conjugate-gibbs-samplers"><i class="fa fa-check"></i><b>7.11.1</b> Conjugate (‘Gibbs’) samplers</a></li>
<li class="chapter" data-level="7.11.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#subsec:HMC"><i class="fa fa-check"></i><b>7.11.2</b> Hamiltonian Monte Carlo (HMC)</a></li>
<li class="chapter" data-level="7.11.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#particle-filter-samplers"><i class="fa fa-check"></i><b>7.11.3</b> Particle filter samplers</a></li>
<li class="chapter" data-level="7.11.4" data-path="cha-mcmc.html"><a href="cha-mcmc.html#customized-log-likelihood-evaluations-rw_llfunction-sampler"><i class="fa fa-check"></i><b>7.11.4</b> Customized log-likelihood evaluations: <em>RW_llFunction sampler</em></a></li>
</ul></li>
<li class="chapter" data-level="7.12" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-example-litters"><i class="fa fa-check"></i><b>7.12</b> Detailed MCMC example: <em>litters</em></a></li>
<li class="chapter" data-level="7.13" data-path="cha-mcmc.html"><a href="cha-mcmc.html#mcmc-suite-compare-mcmcs"><i class="fa fa-check"></i><b>7.13</b> Comparing different MCMCs with <em>MCMCsuite</em> and <em>compareMCMCs</em></a></li>
<li class="chapter" data-level="7.14" data-path="cha-mcmc.html"><a href="cha-mcmc.html#running-mcmc-chains-in-parallel"><i class="fa fa-check"></i><b>7.14</b> Running MCMC chains in parallel</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html"><i class="fa fa-check"></i><b>8</b> Particle Filters, PMCMC, MCEM, Laplace approximation and quadrature</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#particle-filters-sequential-monte-carlo-and-iterated-filtering"><i class="fa fa-check"></i><b>8.1</b> Particle filters / sequential Monte Carlo and iterated filtering</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#filtering-algorithms"><i class="fa fa-check"></i><b>8.1.1</b> Filtering algorithms</a></li>
<li class="chapter" data-level="8.1.2" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#sec:particle-mcmc"><i class="fa fa-check"></i><b>8.1.2</b> Particle MCMC (PMCMC)</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#monte-carlo-expectation-maximization-mcem"><i class="fa fa-check"></i><b>8.2</b> Monte Carlo Expectation Maximization (MCEM)</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#sec:estimate-mcem-cov"><i class="fa fa-check"></i><b>8.2.1</b> Estimating the asymptotic covariance From MCEM</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#laplace-approximation-and-adaptive-gauss-hermite-quadrature"><i class="fa fa-check"></i><b>8.3</b> Laplace approximation and adaptive Gauss-Hermite quadrature</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cha-spatial.html"><a href="cha-spatial.html"><i class="fa fa-check"></i><b>9</b> Spatial models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cha-spatial.html"><a href="cha-spatial.html#intrinsic-gaussian-car-model-dcar_normal"><i class="fa fa-check"></i><b>9.1</b> Intrinsic Gaussian CAR model: <em>dcar_normal</em></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cha-spatial.html"><a href="cha-spatial.html#specification-and-density"><i class="fa fa-check"></i><b>9.1.1</b> Specification and density</a></li>
<li class="chapter" data-level="9.1.2" data-path="cha-spatial.html"><a href="cha-spatial.html#example"><i class="fa fa-check"></i><b>9.1.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cha-spatial.html"><a href="cha-spatial.html#proper-gaussian-car-model-dcar_proper"><i class="fa fa-check"></i><b>9.2</b> Proper Gaussian CAR model: <em>dcar_proper</em></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cha-spatial.html"><a href="cha-spatial.html#specification-and-density-1"><i class="fa fa-check"></i><b>9.2.1</b> Specification and density</a></li>
<li class="chapter" data-level="9.2.2" data-path="cha-spatial.html"><a href="cha-spatial.html#example-1"><i class="fa fa-check"></i><b>9.2.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cha-spatial.html"><a href="cha-spatial.html#sec:spatial-mcmc-sampling-car"><i class="fa fa-check"></i><b>9.3</b> MCMC Sampling of CAR models</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cha-spatial.html"><a href="cha-spatial.html#initial-values"><i class="fa fa-check"></i><b>9.3.1</b> Initial values</a></li>
<li class="chapter" data-level="9.3.2" data-path="cha-spatial.html"><a href="cha-spatial.html#zero-neighbor-regions"><i class="fa fa-check"></i><b>9.3.2</b> Zero-neighbor regions</a></li>
<li class="chapter" data-level="9.3.3" data-path="cha-spatial.html"><a href="cha-spatial.html#zero-mean-constraint"><i class="fa fa-check"></i><b>9.3.3</b> Zero-mean constraint</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cha-bnp.html"><a href="cha-bnp.html"><i class="fa fa-check"></i><b>10</b> Bayesian nonparametric models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:bnpmixtures"><i class="fa fa-check"></i><b>10.1</b> Bayesian nonparametric mixture models</a></li>
<li class="chapter" data-level="10.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:crp"><i class="fa fa-check"></i><b>10.2</b> Chinese Restaurant Process model</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="cha-bnp.html"><a href="cha-bnp.html#specification-and-density-2"><i class="fa fa-check"></i><b>10.2.1</b> Specification and density</a></li>
<li class="chapter" data-level="10.2.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:excrp"><i class="fa fa-check"></i><b>10.2.2</b> Example</a></li>
<li class="chapter" data-level="10.2.3" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:extensionscrp"><i class="fa fa-check"></i><b>10.2.3</b> Extensions</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:sb"><i class="fa fa-check"></i><b>10.3</b> Stick-breaking model</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="cha-bnp.html"><a href="cha-bnp.html#specification-and-function"><i class="fa fa-check"></i><b>10.3.1</b> Specification and function</a></li>
<li class="chapter" data-level="10.3.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:exsb"><i class="fa fa-check"></i><b>10.3.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="cha-bnp.html"><a href="cha-bnp.html#mcmc-sampling-of-bnp-models"><i class="fa fa-check"></i><b>10.4</b> MCMC sampling of BNP models</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:mcmcdcrp"><i class="fa fa-check"></i><b>10.4.1</b> Sampling CRP models</a></li>
<li class="chapter" data-level="10.4.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:mcmcsb"><i class="fa fa-check"></i><b>10.4.2</b> Sampling stick-breaking models</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Programming with NIMBLE</b></span></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="11" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html"><i class="fa fa-check"></i><b>11</b> Writing simple nimbleFunctions</a>
<ul>
<li class="chapter" data-level="11.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:RC-intro"><i class="fa fa-check"></i><b>11.1</b> Introduction to simple nimbleFunctions</a></li>
<li class="chapter" data-level="11.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:r-fiunctions-implemented"><i class="fa fa-check"></i><b>11.2</b> R functions (or variants) implemented in NIMBLE</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#finding-help-for-nimbles-versions-of-r-functions"><i class="fa fa-check"></i><b>11.2.1</b> Finding help for NIMBLE’s versions of R functions</a></li>
<li class="chapter" data-level="11.2.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#basic-operations"><i class="fa fa-check"></i><b>11.2.2</b> Basic operations</a></li>
<li class="chapter" data-level="11.2.3" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:basic-math-linear"><i class="fa fa-check"></i><b>11.2.3</b> Math and linear algebra</a></li>
<li class="chapter" data-level="11.2.4" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:nimble-dist-funs"><i class="fa fa-check"></i><b>11.2.4</b> Distribution functions</a></li>
<li class="chapter" data-level="11.2.5" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:basic-flow-control"><i class="fa fa-check"></i><b>11.2.5</b> Flow control: <em>if-then-else</em>, <em>for</em>, <em>while</em>, and <em>stop</em></a></li>
<li class="chapter" data-level="11.2.6" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:print"><i class="fa fa-check"></i><b>11.2.6</b> <em>print</em> and <em>cat</em></a></li>
<li class="chapter" data-level="11.2.7" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:check-user-interr"><i class="fa fa-check"></i><b>11.2.7</b> Checking for user interrupts: <em>checkInterrupt</em></a></li>
<li class="chapter" data-level="11.2.8" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#optimization-optim-and-nimoptim"><i class="fa fa-check"></i><b>11.2.8</b> Optimization: <em>optim</em> and <em>nimOptim</em></a></li>
<li class="chapter" data-level="11.2.9" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#integration-integrate-and-nimintegrate"><i class="fa fa-check"></i><b>11.2.9</b> Integration: <em>integrate</em> and <em>nimIntegrate</em></a></li>
<li class="chapter" data-level="11.2.10" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:altern-keyw-some"><i class="fa fa-check"></i><b>11.2.10</b> ‘nim’ synonyms for some functions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:how-nimble-handles"><i class="fa fa-check"></i><b>11.3</b> How NIMBLE handles types of variables</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:nimbleList-RCFuns"><i class="fa fa-check"></i><b>11.3.1</b> nimbleList data structures</a></li>
<li class="chapter" data-level="11.3.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:how-types-work"><i class="fa fa-check"></i><b>11.3.2</b> How numeric types work</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:decl-argum-return"><i class="fa fa-check"></i><b>11.4</b> Declaring argument and return types</a></li>
<li class="chapter" data-level="11.5" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:comp-nimbl-pass"><i class="fa fa-check"></i><b>11.5</b> Compiled nimbleFunctions pass arguments by reference</a></li>
<li class="chapter" data-level="11.6" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:calling-external-code"><i class="fa fa-check"></i><b>11.6</b> Calling external compiled code</a></li>
<li class="chapter" data-level="11.7" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:calling-R-code"><i class="fa fa-check"></i><b>11.7</b> Calling uncompiled R functions from compiled nimbleFunctions</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="cha-user-defined.html"><a href="cha-user-defined.html"><i class="fa fa-check"></i><b>12</b> Creating user-defined distributions and functions for models</a>
<ul>
<li class="chapter" data-level="12.1" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:user-functions"><i class="fa fa-check"></i><b>12.1</b> User-defined functions</a></li>
<li class="chapter" data-level="12.2" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:user-distributions"><i class="fa fa-check"></i><b>12.2</b> User-defined distributions</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:registerDistributions"><i class="fa fa-check"></i><b>12.2.1</b> Using <em>registerDistributions</em> for alternative parameterizations and providing other information</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:adv-user-def"><i class="fa fa-check"></i><b>12.3</b> Advanced user-defined functions and distributions</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cha-using-models.html"><a href="cha-using-models.html"><i class="fa fa-check"></i><b>13</b> Working with NIMBLE models</a>
<ul>
<li class="chapter" data-level="13.1" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:accessing-variables"><i class="fa fa-check"></i><b>13.1</b> The variables and nodes in a NIMBLE model</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:get-nodes"><i class="fa fa-check"></i><b>13.1.1</b> Determining the nodes in a model</a></li>
<li class="chapter" data-level="13.1.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:introduced-nodes"><i class="fa fa-check"></i><b>13.1.2</b> Understanding lifted nodes</a></li>
<li class="chapter" data-level="13.1.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdgetdependencies"><i class="fa fa-check"></i><b>13.1.3</b> Determining dependencies in a model</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:nodeInfo"><i class="fa fa-check"></i><b>13.2</b> Accessing information about nodes and variables</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="cha-using-models.html"><a href="cha-using-models.html#getting-distributional-information-about-a-node"><i class="fa fa-check"></i><b>13.2.1</b> Getting distributional information about a node</a></li>
<li class="chapter" data-level="13.2.2" data-path="cha-using-models.html"><a href="cha-using-models.html#getting-information-about-a-distribution"><i class="fa fa-check"></i><b>13.2.2</b> Getting information about a distribution</a></li>
<li class="chapter" data-level="13.2.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:getParam"><i class="fa fa-check"></i><b>13.2.3</b> Getting distribution parameter values for a node</a></li>
<li class="chapter" data-level="13.2.4" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:getBound"><i class="fa fa-check"></i><b>13.2.4</b> Getting distribution bounds for a node</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdcalc-cdsim-cdgetl"><i class="fa fa-check"></i><b>13.3</b> Carrying out model calculations</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="cha-using-models.html"><a href="cha-using-models.html#core-model-operations-calculation-and-simulation"><i class="fa fa-check"></i><b>13.3.1</b> Core model operations: calculation and simulation</a></li>
<li class="chapter" data-level="13.3.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdsimn-cdcalcn-cdget"><i class="fa fa-check"></i><b>13.3.2</b> Pre-defined nimbleFunctions for operating on model nodes: <em>simNodes</em>, <em>calcNodes</em>, and <em>getLogProbNodes</em></a></li>
<li class="chapter" data-level="13.3.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:access-log-prob"><i class="fa fa-check"></i><b>13.3.3</b> Accessing log probabilities via <em>logProb</em> variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="cha-data-structures.html"><a href="cha-data-structures.html"><i class="fa fa-check"></i><b>14</b> Data structures in NIMBLE</a>
<ul>
<li class="chapter" data-level="14.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:modelValues-struct"><i class="fa fa-check"></i><b>14.1</b> The modelValues data structure</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#creating-modelvalues-objects"><i class="fa fa-check"></i><b>14.1.1</b> Creating modelValues objects</a></li>
<li class="chapter" data-level="14.1.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:access-cont-modelv"><i class="fa fa-check"></i><b>14.1.2</b> Accessing contents of modelValues</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:nimbleLists"><i class="fa fa-check"></i><b>14.2</b> The nimbleList data structure</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:predef-nimbleLists"><i class="fa fa-check"></i><b>14.2.1</b> Pre-defined nimbleList types</a></li>
<li class="chapter" data-level="14.2.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:eigen-nimFunctions"><i class="fa fa-check"></i><b>14.2.2</b> Using <em>eigen</em> and <em>svd</em> in nimbleFunctions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html"><i class="fa fa-check"></i><b>15</b> Writing nimbleFunctions to interact with models</a>
<ul>
<li class="chapter" data-level="15.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:writ-nimble-funct"><i class="fa fa-check"></i><b>15.1</b> Overview</a></li>
<li class="chapter" data-level="15.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-comp-nimbl"><i class="fa fa-check"></i><b>15.2</b> Using and compiling nimbleFunctions</a></li>
<li class="chapter" data-level="15.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#writing-setup-code"><i class="fa fa-check"></i><b>15.3</b> Writing setup code</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#useful-tools-for-setup-functions"><i class="fa fa-check"></i><b>15.3.1</b> Useful tools for setup functions</a></li>
<li class="chapter" data-level="15.3.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:access-modify-numer"><i class="fa fa-check"></i><b>15.3.2</b> Accessing and modifying numeric values from setup</a></li>
<li class="chapter" data-level="15.3.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#determining-numeric-types-in-nimblefunctions"><i class="fa fa-check"></i><b>15.3.3</b> Determining numeric types in nimbleFunctions</a></li>
<li class="chapter" data-level="15.3.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:determ-pers-texttts"><i class="fa fa-check"></i><b>15.3.4</b> Control of setup outputs</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:nimble-lang-comp"><i class="fa fa-check"></i><b>15.4</b> Writing run code</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:driv-models:-calc"><i class="fa fa-check"></i><b>15.4.1</b> Driving models: <em>calculate</em>, <em>calculateDiff</em>, <em>simulate</em>, <em>getLogProb</em></a></li>
<li class="chapter" data-level="15.4.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#getting-and-setting-variable-and-node-values"><i class="fa fa-check"></i><b>15.4.2</b> Getting and setting variable and node values</a></li>
<li class="chapter" data-level="15.4.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#getting-parameter-values-and-node-bounds"><i class="fa fa-check"></i><b>15.4.3</b> Getting parameter values and node bounds</a></li>
<li class="chapter" data-level="15.4.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:access-model-modelv"><i class="fa fa-check"></i><b>15.4.4</b> Using modelValues objects</a></li>
<li class="chapter" data-level="15.4.5" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-model-variable"><i class="fa fa-check"></i><b>15.4.5</b> Using model variables and modelValues in expressions</a></li>
<li class="chapter" data-level="15.4.6" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:incl-other-meth"><i class="fa fa-check"></i><b>15.4.6</b> Including other methods in a nimbleFunction</a></li>
<li class="chapter" data-level="15.4.7" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-other-nimbl"><i class="fa fa-check"></i><b>15.4.7</b> Using other nimbleFunctions</a></li>
<li class="chapter" data-level="15.4.8" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:virt-nimbl-nimbl"><i class="fa fa-check"></i><b>15.4.8</b> Virtual nimbleFunctions and nimbleFunctionLists</a></li>
<li class="chapter" data-level="15.4.9" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#character-objects"><i class="fa fa-check"></i><b>15.4.9</b> Character objects</a></li>
<li class="chapter" data-level="15.4.10" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:user-defined-data"><i class="fa fa-check"></i><b>15.4.10</b> User-defined data structures</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:user-samplers"><i class="fa fa-check"></i><b>15.5</b> Example: writing user-defined samplers to extend NIMBLE’s MCMC engine</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#user-defined-samplers-and-posterior-predictive-nodes"><i class="fa fa-check"></i><b>15.5.1</b> User-defined samplers and posterior predictive nodes</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#copying-nimblefunctions-and-nimble-models"><i class="fa fa-check"></i><b>15.6</b> Copying nimbleFunctions (and NIMBLE models)</a></li>
<li class="chapter" data-level="15.7" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:debugging"><i class="fa fa-check"></i><b>15.7</b> Debugging nimbleFunctions</a></li>
<li class="chapter" data-level="15.8" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#timing-nimblefunctions-with-run.time"><i class="fa fa-check"></i><b>15.8</b> Timing nimbleFunctions with <em>run.time</em></a></li>
<li class="chapter" data-level="15.9" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#clearing-and-unloading-compiled-objects"><i class="fa fa-check"></i><b>15.9</b> Clearing and unloading compiled objects</a></li>
<li class="chapter" data-level="15.10" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#reducing-memory-usage"><i class="fa fa-check"></i><b>15.10</b> Reducing memory usage</a></li>
</ul></li>
<li class="part"><span><b>V Automatic Derivatives in NIMBLE</b></span></li>
<li class="chapter" data-level="16" data-path="cha-AD.html"><a href="cha-AD.html"><i class="fa fa-check"></i><b>16</b> Automatic Derivatives</a>
<ul>
<li class="chapter" data-level="16.1" data-path="cha-AD.html"><a href="cha-AD.html#sec:use-derivs"><i class="fa fa-check"></i><b>16.1</b> How to turn on derivatives in a model</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="cha-AD.html"><a href="cha-AD.html#finish-setting-up-the-glmm-example"><i class="fa fa-check"></i><b>16.1.1</b> Finish setting up the GLMM example</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="cha-AD.html"><a href="cha-AD.html#sec:AD-laplace"><i class="fa fa-check"></i><b>16.2</b> How to use Laplace approximation and adaptive Gauss-Hermite quadrature</a></li>
<li class="chapter" data-level="16.3" data-path="cha-AD.html"><a href="cha-AD.html#sec:AD-user-def"><i class="fa fa-check"></i><b>16.3</b> How to support derivatives in user-defined functions and distributions</a></li>
<li class="chapter" data-level="16.4" data-path="cha-AD.html"><a href="cha-AD.html#what-operations-are-and-arent-supported-for-ad"><i class="fa fa-check"></i><b>16.4</b> What operations are and aren’t supported for AD</a></li>
<li class="chapter" data-level="16.5" data-path="cha-AD.html"><a href="cha-AD.html#basics-of-obtaining-derivatives-in-nimblefunctions"><i class="fa fa-check"></i><b>16.5</b> Basics of obtaining derivatives in <code>nimbleFunctions</code></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="cha-AD.html"><a href="cha-AD.html#checking-derivatives-with-uncompiled-execution"><i class="fa fa-check"></i><b>16.5.1</b> Checking derivatives with uncompiled execution</a></li>
<li class="chapter" data-level="16.5.2" data-path="cha-AD.html"><a href="cha-AD.html#sec:AD-holding-out"><i class="fa fa-check"></i><b>16.5.2</b> Holding some local variables out of derivative tracking</a></li>
<li class="chapter" data-level="16.5.3" data-path="cha-AD.html"><a href="cha-AD.html#sec:AD-multiple-NF"><i class="fa fa-check"></i><b>16.5.3</b> Using AD with multiple nimbleFunctions</a></li>
<li class="chapter" data-level="16.5.4" data-path="cha-AD.html"><a href="cha-AD.html#sec:understanding-more-AD"><i class="fa fa-check"></i><b>16.5.4</b> Understanding more about how AD works: <em>taping</em> of operations</a></li>
<li class="chapter" data-level="16.5.5" data-path="cha-AD.html"><a href="cha-AD.html#resetting-a-nimderivs-call"><i class="fa fa-check"></i><b>16.5.5</b> Resetting a <code>nimDerivs</code> call</a></li>
<li class="chapter" data-level="16.5.6" data-path="cha-AD.html"><a href="cha-AD.html#a-note-on-performance-benchmarking"><i class="fa fa-check"></i><b>16.5.6</b> A note on performance benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="cha-AD.html"><a href="cha-AD.html#advanced-uses-double-taping"><i class="fa fa-check"></i><b>16.6</b> Advanced uses: double taping</a></li>
<li class="chapter" data-level="16.7" data-path="cha-AD.html"><a href="cha-AD.html#derivatives-involving-model-calculations"><i class="fa fa-check"></i><b>16.7</b> Derivatives involving model calculations</a>
<ul>
<li class="chapter" data-level="16.7.1" data-path="cha-AD.html"><a href="cha-AD.html#method-1-nimderivs-of-modelcalculate"><i class="fa fa-check"></i><b>16.7.1</b> Method 1: <code>nimDerivs</code> of <code>model$calculate</code></a></li>
<li class="chapter" data-level="16.7.2" data-path="cha-AD.html"><a href="cha-AD.html#method-2-nimderivs-of-a-method-that-calls-modelcalculate"><i class="fa fa-check"></i><b>16.7.2</b> Method 2: <code>nimDerivs</code> of a method that calls <code>model$calculate</code></a></li>
</ul></li>
<li class="chapter" data-level="16.8" data-path="cha-AD.html"><a href="cha-AD.html#sec:parameter-transform"><i class="fa fa-check"></i><b>16.8</b> Parameter transformations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="example-maximum-likelihood-estimation-using-optim-with-gradients-from-nimderivs..html"><a href="example-maximum-likelihood-estimation-using-optim-with-gradients-from-nimderivs..html"><i class="fa fa-check"></i><b>17</b> Example: maximum likelihood estimation using <code>optim</code> with gradients from <code>nimDerivs</code>.</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cha-writing-models" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Writing models in NIMBLE’s dialect of BUGS<a href="cha-writing-models.html#cha-writing-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Models in NIMBLE are written using a variation on the BUGS language.
From BUGS code, NIMBLE creates a model object. This chapter
describes NIMBLE’s version of BUGS. The next chapter explains how to
build and manipulate model objects.
<!---  With NIMBLE you can also define your own distributions and functions for use in BUGS code; discussion of this functionality is deferred to Chapter \@ref(cha-user-defined) as it requires the use of nimbleFunctions.  --></p>
<div id="sec:supp-feat-bugs" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Comparison to BUGS dialects supported by WinBUGS, OpenBUGS and JAGS<a href="cha-writing-models.html#sec:supp-feat-bugs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many users will come to NIMBLE with some familiarity with WinBUGS,
OpenBUGS, or JAGS, so we start by summarizing how NIMBLE is similar to
and different from those before documenting NIMBLE’s version of BUGS
more completely. In general, NIMBLE aims to be compatible with the
original BUGS language and also JAGS’ version. However, at this
point, there are some features not supported by NIMBLE, and there are
some extensions that are planned but not implemented.</p>
<div id="supported-features-of-bugs-and-jags" class="section level3 hasAnchor" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Supported features of BUGS and JAGS<a href="cha-writing-models.html#supported-features-of-bugs-and-jags" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Stochastic and deterministic<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a> node declarations.</li>
<li>Most univariate and multivariate distributions.</li>
<li>Link functions.</li>
<li>Most mathematical functions.</li>
<li>‘for’ loops for iterative declarations.</li>
<li>Arrays of nodes up to 4 dimensions.</li>
<li>Truncation and censoring as in JAGS using the <code>T()</code>
notation and <code>dinterval</code>.</li>
</ol>
</div>
<div id="sec:extensions-bugs" class="section level3 hasAnchor" number="5.1.2">
<h3><span class="header-section-number">5.1.2</span> NIMBLE’s Extensions to BUGS and JAGS<a href="cha-writing-models.html#sec:extensions-bugs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>NIMBLE extends the BUGS language in the following ways:</p>
<ol style="list-style-type: decimal">
<li>User-defined functions and distributions – written as nimbleFunctions – can be used in model code. See Chapter <a href="cha-user-defined.html#cha-user-defined">12</a>.</li>
<li>Multiple parameterizations for distributions, similar to those in R, can be used.</li>
<li>Named parameters for distributions and functions, similar to R function calls, can be used.</li>
<li>Linear algebra, including for vectorized
calculations of simple algebra, can be used in deterministic declarations.</li>
<li>Distribution parameters can be expressions, as in JAGS but not in WinBUGS. Caveat: parameters to <em>multivariate</em>
distributions (e.g., <code>dmnorm</code>) cannot be expressions (but an expression can be defined in a separate deterministic expression and the resulting variable then used). <!--- still true. -Perry --></li>
<li>Alternative models can be defined from the same model code by using if-then-else statements that are evaluated when the model is defined.</li>
<li>More flexible indexing of vector nodes within larger variables is allowed. For example one can place a multivariate normal vector arbitrarily within a higher-dimensional object, not just in the last index.</li>
<li>More general constraints can be declared using <code>dconstraint</code>, which extends the concept of JAGS’ <code>dinterval</code>.</li>
<li>Link functions can be used in stochastic, as well as deterministic, declarations.<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></li>
<li>Data values can be reset, and which parts of a model are flagged as data can be changed, allowing one model to be used for different data sets without rebuilding the model each time.</li>
<li>One can use stochastic/dynamic indexes, i.e., indexes can be other nodes or functions of other nodes. For a given dimension of a node being indexed, if the index is not constant, it must be a scalar value. So expressions such as <code>mu[k[i], 3]</code> or <code>mu[k[i], 1:3]</code> or <code>mu[k[i], j[i]]</code> are allowed, but not <code>mu[k[i]:(k[i]+1)]</code><a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> Nested dynamic indexes such as <code>mu[k[j[i]]]</code> are also allowed.</li>
</ol>
</div>
<div id="sec:not-yet-supported" class="section level3 hasAnchor" number="5.1.3">
<h3><span class="header-section-number">5.1.3</span> Not-supported features of BUGS and JAGS<a href="cha-writing-models.html#sec:not-yet-supported" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The following are not supported.</p>
<ol style="list-style-type: decimal">
<li>The appearance of the same node on the left-hand side of both a
<code>&lt;-</code> and a <span class="math inline">\(\sim\)</span> declaration (used in WinBUGS for data
assignment for the value of a stochastic node).</li>
<li>Multivariate nodes must appear with brackets, even if they are
empty. E.g., <code>x</code> cannot be multivariate but <code>x[]</code> or
<code>x[2:5]</code> can be.</li>
<li>NIMBLE generally determines the dimensionality and
sizes of variables from the BUGS code. However, when a variable
appears with blank indices, such as in <code>x.sum &lt;- sum(x[])</code>,
and if the dimensions of the variable are not clearly defined in
other declarations, NIMBLE currently requires that the dimensions of
x be provided when the model object is created (via <code>nimbleModel</code>).</li>
<li>Use of non-sequential indexes in the definition of a for loop. JAGS allows syntax such as <code>for(i in expr)</code> when <code>expr</code> evaluates to an integer vector. In NIMBLE one can use the work-around of defining a constant vector, say <code>k</code>, and using <code>k[i]</code> in the body of the for loop.</li>
<li>Use of non-sequential indexes to subset variables. JAGS allows syntax such as <code>sum(mu[expr])</code> when <code>expr</code> evaluates to an integer vector. In NIMBLE one can use the work-around of defining a nimbleFunction that takes <code>mu</code> and the index vector as arguments and does the calculation of interest.</li>
</ol>
</div>
</div>
<div id="writing-models" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Writing models<a href="cha-writing-models.html#writing-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here we introduce NIMBLE’s version of BUGS. The WinBUGS, OpenBUGS and
JAGS manuals are also useful resources for writing BUGS models,
including many examples.</p>
<div id="declaring-stochastic-and-deterministic-nodes" class="section level3 hasAnchor" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Declaring stochastic and deterministic nodes<a href="cha-writing-models.html#declaring-stochastic-and-deterministic-nodes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>BUGS is a declarative language for graphical (or hierarchical) models.
Most programming languages are imperative, which means a series of
commands will be executed in the order they are written. A
declarative language like BUGS is more like building a machine before
using it. Each line declares that a component should be plugged into
the machine, but it doesn’t matter in what order they are declared as
long as all the right components are plugged in by the end of the code.</p>
<p>The machine in this case is a graphical model<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>. A <em>node</em> (sometimes called
a <em>vertex</em>) holds one value, which may be a scalar or a vector.
<em>Edges</em> define the relationships between nodes. A huge variety
of statistical models can be thought of as graphs.</p>
<p>Here is the code to define and create a simple linear regression model with four observations.</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="cha-writing-models.html#cb76-1" tabindex="-1"></a><span class="fu">library</span>(nimble)</span>
<span id="cb76-2"><a href="cha-writing-models.html#cb76-2" tabindex="-1"></a>mc <span class="ot">&lt;-</span> <span class="fu">nimbleCode</span>({</span>
<span id="cb76-3"><a href="cha-writing-models.html#cb76-3" tabindex="-1"></a>    intercept <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1000</span>)</span>
<span id="cb76-4"><a href="cha-writing-models.html#cb76-4" tabindex="-1"></a>    slope <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1000</span>)</span>
<span id="cb76-5"><a href="cha-writing-models.html#cb76-5" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb76-6"><a href="cha-writing-models.html#cb76-6" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb76-7"><a href="cha-writing-models.html#cb76-7" tabindex="-1"></a>        predicted.y[i] <span class="ot">&lt;-</span> intercept <span class="sc">+</span> slope <span class="sc">*</span> x[i]</span>
<span id="cb76-8"><a href="cha-writing-models.html#cb76-8" tabindex="-1"></a>        y[i] <span class="sc">~</span> <span class="fu">dnorm</span>(predicted.y[i], <span class="at">sd =</span> sigma)</span>
<span id="cb76-9"><a href="cha-writing-models.html#cb76-9" tabindex="-1"></a>    }</span>
<span id="cb76-10"><a href="cha-writing-models.html#cb76-10" tabindex="-1"></a>})</span>
<span id="cb76-11"><a href="cha-writing-models.html#cb76-11" tabindex="-1"></a></span>
<span id="cb76-12"><a href="cha-writing-models.html#cb76-12" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">nimbleModel</span>(mc, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">4</span>)))</span>
<span id="cb76-13"><a href="cha-writing-models.html#cb76-13" tabindex="-1"></a></span>
<span id="cb76-14"><a href="cha-writing-models.html#cb76-14" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb76-15"><a href="cha-writing-models.html#cb76-15" tabindex="-1"></a></span>
<span id="cb76-16"><a href="cha-writing-models.html#cb76-16" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>,</span>
<span id="cb76-17"><a href="cha-writing-models.html#cb76-17" tabindex="-1"></a>   <span class="co"># These seem to be rescaled to fit in the plot area,</span></span>
<span id="cb76-18"><a href="cha-writing-models.html#cb76-18" tabindex="-1"></a>   <span class="co"># so I&#39;ll just use 0-100 as the scale</span></span>
<span id="cb76-19"><a href="cha-writing-models.html#cb76-19" tabindex="-1"></a>                 <span class="at">data =</span> <span class="fu">c</span>(<span class="dv">33</span>, <span class="dv">100</span>,</span>
<span id="cb76-20"><a href="cha-writing-models.html#cb76-20" tabindex="-1"></a>                          <span class="dv">66</span>, <span class="dv">100</span>,</span>
<span id="cb76-21"><a href="cha-writing-models.html#cb76-21" tabindex="-1"></a>                          <span class="dv">50</span>, <span class="dv">0</span>, <span class="co"># first three are parameters</span></span>
<span id="cb76-22"><a href="cha-writing-models.html#cb76-22" tabindex="-1"></a>                          <span class="dv">15</span>, <span class="dv">50</span>, <span class="dv">35</span>, <span class="dv">50</span>, <span class="dv">55</span>, <span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">50</span>, <span class="co"># x&#39;s</span></span>
<span id="cb76-23"><a href="cha-writing-models.html#cb76-23" tabindex="-1"></a>                          <span class="dv">20</span>, <span class="dv">75</span>, <span class="dv">40</span>, <span class="dv">75</span>, <span class="dv">60</span>, <span class="dv">75</span>, <span class="dv">80</span>, <span class="dv">75</span>, <span class="co"># predicted.y&#39;s</span></span>
<span id="cb76-24"><a href="cha-writing-models.html#cb76-24" tabindex="-1"></a>                          <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">45</span>, <span class="dv">25</span>, <span class="dv">65</span>, <span class="dv">25</span>, <span class="dv">85</span>, <span class="dv">25</span>) <span class="co"># y&#39;s</span></span>
<span id="cb76-25"><a href="cha-writing-models.html#cb76-25" tabindex="-1"></a>                 )</span>
<span id="cb76-26"><a href="cha-writing-models.html#cb76-26" tabindex="-1"></a></span>
<span id="cb76-27"><a href="cha-writing-models.html#cb76-27" tabindex="-1"></a>sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">45</span>, <span class="dv">30</span>, <span class="dv">30</span>,</span>
<span id="cb76-28"><a href="cha-writing-models.html#cb76-28" tabindex="-1"></a>           <span class="fu">rep</span>(<span class="dv">20</span>, <span class="dv">4</span>),</span>
<span id="cb76-29"><a href="cha-writing-models.html#cb76-29" tabindex="-1"></a>           <span class="fu">rep</span>(<span class="dv">50</span>, <span class="dv">4</span>),</span>
<span id="cb76-30"><a href="cha-writing-models.html#cb76-30" tabindex="-1"></a>           <span class="fu">rep</span>(<span class="dv">20</span>, <span class="dv">4</span>))</span>
<span id="cb76-31"><a href="cha-writing-models.html#cb76-31" tabindex="-1"></a></span>
<span id="cb76-32"><a href="cha-writing-models.html#cb76-32" tabindex="-1"></a>edge.color <span class="ot">&lt;-</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb76-33"><a href="cha-writing-models.html#cb76-33" tabindex="-1"></a>    <span class="co"># c(</span></span>
<span id="cb76-34"><a href="cha-writing-models.html#cb76-34" tabindex="-1"></a>    <span class="co"># rep(&quot;green&quot;, 8),</span></span>
<span id="cb76-35"><a href="cha-writing-models.html#cb76-35" tabindex="-1"></a>    <span class="co"># rep(&quot;red&quot;, 4),</span></span>
<span id="cb76-36"><a href="cha-writing-models.html#cb76-36" tabindex="-1"></a>    <span class="co"># rep(&quot;blue&quot;, 4),</span></span>
<span id="cb76-37"><a href="cha-writing-models.html#cb76-37" tabindex="-1"></a>    <span class="co"># rep(&quot;purple&quot;, 4))</span></span>
<span id="cb76-38"><a href="cha-writing-models.html#cb76-38" tabindex="-1"></a>stoch.color <span class="ot">&lt;-</span> <span class="st">&quot;deepskyblue2&quot;</span></span>
<span id="cb76-39"><a href="cha-writing-models.html#cb76-39" tabindex="-1"></a>det.color <span class="ot">&lt;-</span> <span class="st">&quot;orchid3&quot;</span></span>
<span id="cb76-40"><a href="cha-writing-models.html#cb76-40" tabindex="-1"></a>rhs.color <span class="ot">&lt;-</span> <span class="st">&quot;gray73&quot;</span></span>
<span id="cb76-41"><a href="cha-writing-models.html#cb76-41" tabindex="-1"></a>fill.color <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb76-42"><a href="cha-writing-models.html#cb76-42" tabindex="-1"></a>    <span class="fu">rep</span>(stoch.color, <span class="dv">3</span>),</span>
<span id="cb76-43"><a href="cha-writing-models.html#cb76-43" tabindex="-1"></a>    <span class="fu">rep</span>(rhs.color, <span class="dv">4</span>),</span>
<span id="cb76-44"><a href="cha-writing-models.html#cb76-44" tabindex="-1"></a>    <span class="fu">rep</span>(det.color, <span class="dv">4</span>),</span>
<span id="cb76-45"><a href="cha-writing-models.html#cb76-45" tabindex="-1"></a>    <span class="fu">rep</span>(stoch.color, <span class="dv">4</span>)</span>
<span id="cb76-46"><a href="cha-writing-models.html#cb76-46" tabindex="-1"></a>)</span>
<span id="cb76-47"><a href="cha-writing-models.html#cb76-47" tabindex="-1"></a></span>
<span id="cb76-48"><a href="cha-writing-models.html#cb76-48" tabindex="-1"></a></span>
<span id="cb76-49"><a href="cha-writing-models.html#cb76-49" tabindex="-1"></a><span class="fu">plot</span>(model<span class="sc">$</span>graph, <span class="at">vertex.shape =</span> <span class="st">&quot;crectangle&quot;</span>,</span>
<span id="cb76-50"><a href="cha-writing-models.html#cb76-50" tabindex="-1"></a>     <span class="at">vertex.size =</span> sizes,</span>
<span id="cb76-51"><a href="cha-writing-models.html#cb76-51" tabindex="-1"></a>     <span class="at">vertex.size2 =</span> <span class="dv">20</span>,</span>
<span id="cb76-52"><a href="cha-writing-models.html#cb76-52" tabindex="-1"></a>     <span class="at">layout =</span> layout,</span>
<span id="cb76-53"><a href="cha-writing-models.html#cb76-53" tabindex="-1"></a>     <span class="at">vertex.label.cex =</span> <span class="fl">3.0</span>,</span>
<span id="cb76-54"><a href="cha-writing-models.html#cb76-54" tabindex="-1"></a>     <span class="at">vertex.color =</span> fill.color,</span>
<span id="cb76-55"><a href="cha-writing-models.html#cb76-55" tabindex="-1"></a>     <span class="at">edge.width =</span> <span class="dv">3</span>,</span>
<span id="cb76-56"><a href="cha-writing-models.html#cb76-56" tabindex="-1"></a>     <span class="at">asp =</span> <span class="fl">0.5</span>,</span>
<span id="cb76-57"><a href="cha-writing-models.html#cb76-57" tabindex="-1"></a>     <span class="at">edge.color =</span> edge.color)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:linearRegressionGraph"></span>
<img src="NimbleUserManual_files/figure-html/linearRegressionGraph-1.png" alt="Graph of a linear regression model" width="1920" />
<p class="caption">
Figure 5.1: Graph of a linear regression model
</p>
</div>
<p>The graph representing the model is
shown in Figure <a href="cha-writing-models.html#fig:linearRegressionGraph">5.1</a>. Each observation,
<code>y[i]</code>, is a node whose edges say that it follows a normal
distribution depending on a predicted value, <code>predicted.y[i]</code>, and
standard deviation, <code>sigma</code>, which are each nodes. Each predicted
value is a node whose edges say how it is calculated from <code>slope</code>,
<code>intercept</code>, and one value of an explanatory variable, <code>x[i]</code>,
which are each nodes.</p>
<p>This graph is created from the following BUGS code:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="cha-writing-models.html#cb77-1" tabindex="-1"></a>{</span>
<span id="cb77-2"><a href="cha-writing-models.html#cb77-2" tabindex="-1"></a>    intercept <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1000</span>)</span>
<span id="cb77-3"><a href="cha-writing-models.html#cb77-3" tabindex="-1"></a>    slope <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1000</span>)</span>
<span id="cb77-4"><a href="cha-writing-models.html#cb77-4" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb77-5"><a href="cha-writing-models.html#cb77-5" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb77-6"><a href="cha-writing-models.html#cb77-6" tabindex="-1"></a>        predicted.y[i] <span class="ot">&lt;-</span> intercept <span class="sc">+</span> slope <span class="sc">*</span> x[i]</span>
<span id="cb77-7"><a href="cha-writing-models.html#cb77-7" tabindex="-1"></a>        y[i] <span class="sc">~</span> <span class="fu">dnorm</span>(predicted.y[i], <span class="at">sd =</span> sigma)</span>
<span id="cb77-8"><a href="cha-writing-models.html#cb77-8" tabindex="-1"></a>    }</span>
<span id="cb77-9"><a href="cha-writing-models.html#cb77-9" tabindex="-1"></a>}</span></code></pre></div>
<p>In this code, stochastic relationships are declared with ‘<span class="math inline">\(\sim\)</span>’
and deterministic relationships are declared with ‘<code>&lt;-</code>’. For
example, each <code>y[i]</code> follows a normal distribution with mean
<code>predicted.y[i]</code> and standard deviation
<code>sigma</code>. Each
<code>predicted.y[i]</code> is the result of <code>intercept + slope * x[i]</code>.
The for-loop yields the equivalent of writing four lines of code, each
with a different value of <code>i</code>. It does not matter in what order
the nodes are declared. Imagine that each line of code draws part of
Figure <a href="cha-writing-models.html#fig:linearRegressionGraph">5.1</a>, and all that matters is that
the everything gets drawn in the end. Available distributions, default and alternative
parameterizations, and functions are listed in Section <a href="cha-writing-models.html#subsec:dists-and-functions">5.2.4</a>.</p>
<p>An equivalent graph can be created by this BUGS code:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="cha-writing-models.html#cb78-1" tabindex="-1"></a>{</span>
<span id="cb78-2"><a href="cha-writing-models.html#cb78-2" tabindex="-1"></a>    intercept <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1000</span>)</span>
<span id="cb78-3"><a href="cha-writing-models.html#cb78-3" tabindex="-1"></a>    slope <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1000</span>)</span>
<span id="cb78-4"><a href="cha-writing-models.html#cb78-4" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb78-5"><a href="cha-writing-models.html#cb78-5" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) {</span>
<span id="cb78-6"><a href="cha-writing-models.html#cb78-6" tabindex="-1"></a>        y[i] <span class="sc">~</span> <span class="fu">dnorm</span>(intercept <span class="sc">+</span> slope <span class="sc">*</span> x[i], <span class="at">sd =</span> sigma)</span>
<span id="cb78-7"><a href="cha-writing-models.html#cb78-7" tabindex="-1"></a>    }</span>
<span id="cb78-8"><a href="cha-writing-models.html#cb78-8" tabindex="-1"></a>}</span></code></pre></div>
<p>In this case, the <code>predicted.y[i]</code> nodes in Figure
<a href="cha-writing-models.html#fig:linearRegressionGraph">5.1</a> will be created automatically by
NIMBLE and will have a different name, generated by NIMBLE.</p>
</div>
<div id="sec:more-kinds-bugs" class="section level3 hasAnchor" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> More kinds of BUGS declarations<a href="cha-writing-models.html#sec:more-kinds-bugs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here are some examples of valid lines of BUGS code. This code does
not describe a sensible or complete model, and it includes some
arbitrary indices (e.g. <code>mvx[8:10, i]</code>) to illustrate flexibility.
Instead the purpose of each line is to illustrate a feature of
NIMBLE’s version of BUGS.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="cha-writing-models.html#cb79-1" tabindex="-1"></a>{</span>
<span id="cb79-2"><a href="cha-writing-models.html#cb79-2" tabindex="-1"></a>    <span class="co"># 1. normal distribution with BUGS parameter order</span></span>
<span id="cb79-3"><a href="cha-writing-models.html#cb79-3" tabindex="-1"></a>    x <span class="sc">~</span> <span class="fu">dnorm</span>(a <span class="sc">+</span> b <span class="sc">*</span> c, tau) </span>
<span id="cb79-4"><a href="cha-writing-models.html#cb79-4" tabindex="-1"></a>    <span class="co"># 2. normal distribution with a named parameter</span></span>
<span id="cb79-5"><a href="cha-writing-models.html#cb79-5" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>(a <span class="sc">+</span> b <span class="sc">*</span> c, <span class="at">sd =</span> sigma) </span>
<span id="cb79-6"><a href="cha-writing-models.html#cb79-6" tabindex="-1"></a>    <span class="co"># 3. For-loop and nested indexing</span></span>
<span id="cb79-7"><a href="cha-writing-models.html#cb79-7" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N) {</span>
<span id="cb79-8"><a href="cha-writing-models.html#cb79-8" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>M[i]) {</span>
<span id="cb79-9"><a href="cha-writing-models.html#cb79-9" tabindex="-1"></a>            z[i,j] <span class="sc">~</span> <span class="fu">dexp</span>(r[ blockID[i] ]) </span>
<span id="cb79-10"><a href="cha-writing-models.html#cb79-10" tabindex="-1"></a>        }</span>
<span id="cb79-11"><a href="cha-writing-models.html#cb79-11" tabindex="-1"></a>    }</span>
<span id="cb79-12"><a href="cha-writing-models.html#cb79-12" tabindex="-1"></a>    <span class="co"># 4. multivariate distribution with arbitrary indexing</span></span>
<span id="cb79-13"><a href="cha-writing-models.html#cb79-13" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) </span>
<span id="cb79-14"><a href="cha-writing-models.html#cb79-14" tabindex="-1"></a>        mvx[<span class="dv">8</span><span class="sc">:</span><span class="dv">10</span>, i] <span class="sc">~</span> <span class="fu">dmnorm</span>(mvMean[<span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>], <span class="at">cov =</span> mvCov[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, i])</span>
<span id="cb79-15"><a href="cha-writing-models.html#cb79-15" tabindex="-1"></a>    <span class="co"># 5. User-provided distribution</span></span>
<span id="cb79-16"><a href="cha-writing-models.html#cb79-16" tabindex="-1"></a>    w <span class="sc">~</span> <span class="fu">dMyDistribution</span>(<span class="at">hello =</span> x, <span class="at">world =</span> y) </span>
<span id="cb79-17"><a href="cha-writing-models.html#cb79-17" tabindex="-1"></a>    <span class="co"># 6. Simple deterministic node</span></span>
<span id="cb79-18"><a href="cha-writing-models.html#cb79-18" tabindex="-1"></a>    d1 <span class="ot">&lt;-</span> a <span class="sc">+</span> b</span>
<span id="cb79-19"><a href="cha-writing-models.html#cb79-19" tabindex="-1"></a>    <span class="co"># 7. Vector deterministic node with matrix multiplication</span></span>
<span id="cb79-20"><a href="cha-writing-models.html#cb79-20" tabindex="-1"></a>    d2[] <span class="ot">&lt;-</span> A[ , ] <span class="sc">%*%</span> mvMean[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] </span>
<span id="cb79-21"><a href="cha-writing-models.html#cb79-21" tabindex="-1"></a>    <span class="co"># 8. Deterministic node with user-provided function</span></span>
<span id="cb79-22"><a href="cha-writing-models.html#cb79-22" tabindex="-1"></a>    d3 <span class="ot">&lt;-</span> <span class="fu">foo</span>(x, <span class="at">hooray =</span> y) </span>
<span id="cb79-23"><a href="cha-writing-models.html#cb79-23" tabindex="-1"></a>}</span></code></pre></div>
<p>When a variable appears only on the right-hand side, it can be provided via <code>constants</code> (in which case it can never be changed) or via <code>data</code> or <code>inits</code>, as discussed in Chapter <a href="cha-building-models.html#cha-building-models">6</a>.</p>
<p>Notes on the comment-numbered lines are:</p>
<ol style="list-style-type: decimal">
<li><code>x</code> follows a normal distribution with mean <code>a + b*c</code> and precision <code>tau</code> (default BUGS second parameter for <code>dnorm</code>).</li>
<li><code>y</code> follows a normal distribution with the same mean as <code>x</code> but a named standard deviation parameter instead of a precision parameter (sd = 1/sqrt(precision)).</li>
<li><code>z[i, j]</code> follows an exponential distribution with parameter
<code>r[ blockID[i] ]</code>. This shows how for-loops can be used for indexing of variables containing
multiple nodes. Variables that define for-loop indices (<code>N</code> and <code>M</code>) must also be provided as constants.<br />
</li>
<li>The arbitrary block <code>mvx[8:10, i]</code> follows a multivariate
normal distribution, with a named covariance matrix instead of BUGS’
default of a precision matrix. As in R, curly braces for for-loop
contents are only needed if there is more than one line.</li>
<li><code>w</code> follows a user-defined distribution. See Chapter <a href="cha-user-defined.html#cha-user-defined">12</a>.</li>
<li><code>d1</code> is a scalar deterministic node that, when calculated, will be
set to <code>a + b</code>.</li>
<li><code>d2</code> is a vector deterministic node using matrix
multiplication in R’s syntax.</li>
<li><code>d3</code> is a deterministic node using a user-provided
function. See Chapter <a href="cha-user-defined.html#cha-user-defined">12</a>.</li>
</ol>
<div id="sec:indexing" class="section level4 hasAnchor" number="5.2.2.1">
<h4><span class="header-section-number">5.2.2.1</span> More about indexing<a href="cha-writing-models.html#sec:indexing" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Examples of allowed indexing include:</p>
<ul>
<li><code>x[i]</code> # a single index</li>
<li><code>x[i:j]</code> # a range of indices</li>
<li><code>x[i:j,k:l]</code> # multiple single indices or ranges for higher-dimensional arrays</li>
<li><code>x[i:j, ]</code> # blank indices indicating the full range</li>
<li><code>x[3*i+7]</code> # computed indices</li>
<li><code>x[(3*i):(5*i+1)]</code> # computed lower and upper ends of an index range</li>
<li><code>x[k[i]+1]</code> # a dynamic (and computed) index</li>
<li><code>x[k[j[i]]]</code> # nested dynamic indexes</li>
<li><code>x[k[i], 1:3]</code> # nested indexing of rows or columns</li>
</ul>
<p>NIMBLE does not allow multivariate nodes to be used without
square brackets, which is an incompatibility with JAGS. Therefore a statement like <code>xbar &lt;- mean(x)</code> in JAGS must be converted to
<code>xbar &lt;- mean(x[])</code> (if <code>x</code> is a vector) or <code>xbar &lt;-  mean(x[,])</code> (if <code>x</code> is a matrix) for NIMBLE<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a>. Section <a href="cha-building-models.html#sec:provide-dimensions">6.1.1.5</a> discusses how to provide NIMBLE with dimensions of <code>x</code> when needed.</p>
<p>One cannot provide a vector of indices that are not constant. For example, <code>x[start[i]:end[i]]</code> is allowed only if <code>start</code> and <code>end</code> are provided as constants. Also, one cannot provide a vector, or expression evaluating to a vector (apart from use of <code>:</code>) as an index. For example, <code>x[inds]</code> is not allowed. Often one can write a nimbleFunction to achieve the desired result, such as definining a nimbleFunction that takes <code>x</code>, <code>start[i]</code>, and <code>end[i]</code> or takes <code>x</code> and <code>inds</code> as arguments and does the subsetting (possibly in combination with some other calculation). Note that <code>x[L:U]</code> and <code>x[inds]</code> are allowed in nimbleFunction code.</p>
<p>Generally NIMBLE supports R-like linear algebra expressions and attempts to follow the same rules as R about
dimensions (although in some cases this is not possible). For
example, <code>x[1:3] %*% y[1:3]</code> converts <code>x[1:3]</code> into a row
vector and thus computes the inner product, which is returned as a <span class="math inline">\(1 \times 1\)</span>
matrix (use <code>inprod</code> to get it as a scalar, which it typically easier). Like in R,
a scalar index will result in dropping a dimension unless the argument
<code>drop=FALSE</code> is provided. For example, <code>mymatrix[i, 1:3]</code> will
be a vector of length 3, but <code>mymatrix[i, 1:3, drop=FALSE]</code> will be
a <span class="math inline">\(1 \times 3\)</span> matrix. More about indexing and dimensions is
discussed in Section <a href="cha-RCfunctions.html#sec:manag-dimens-sizes">11.3.2.7</a>.</p>
</div>
</div>
<div id="subsec:vectorized-versus-scalar-declarations" class="section level3 hasAnchor" number="5.2.3">
<h3><span class="header-section-number">5.2.3</span> Vectorized versus scalar declarations<a href="cha-writing-models.html#subsec:vectorized-versus-scalar-declarations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose you need nodes <code>logY[i]</code> that should be the log of the
corresponding <code>Y[i]</code>, say for <code>i</code> from 1 to 10. Conventionally
this would be created with a for loop:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="cha-writing-models.html#cb80-1" tabindex="-1"></a>{</span>
<span id="cb80-2"><a href="cha-writing-models.html#cb80-2" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) {</span>
<span id="cb80-3"><a href="cha-writing-models.html#cb80-3" tabindex="-1"></a>        logY[i] <span class="ot">&lt;-</span> <span class="fu">log</span>(Y[i])</span>
<span id="cb80-4"><a href="cha-writing-models.html#cb80-4" tabindex="-1"></a>    }</span>
<span id="cb80-5"><a href="cha-writing-models.html#cb80-5" tabindex="-1"></a>}</span></code></pre></div>
<p>Since NIMBLE supports R-like algebraic expressions, an alternative in
NIMBLE’s dialect of BUGS is to use a vectorized declaration like this:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="cha-writing-models.html#cb81-1" tabindex="-1"></a>{</span>
<span id="cb81-2"><a href="cha-writing-models.html#cb81-2" tabindex="-1"></a>    logY[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="ot">&lt;-</span> <span class="fu">log</span>(Y[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb81-3"><a href="cha-writing-models.html#cb81-3" tabindex="-1"></a>}</span></code></pre></div>
<p>There is an important difference between the models that are created by the
above two methods. The first creates 10 scalar nodes, <code>logY[1]</code>
<span class="math inline">\(,\ldots,\)</span> <code>logY[10]</code>. The second creates one vector node,
<code>logY[1:10]</code>. If each <code>logY[i]</code> is used separately by an algorithm, it may be more efficient computationally if they are declared as scalars. If they are all used together,
it will often make sense to declare them as a vector.</p>
</div>
<div id="subsec:dists-and-functions" class="section level3 hasAnchor" number="5.2.4">
<h3><span class="header-section-number">5.2.4</span> Available distributions<a href="cha-writing-models.html#subsec:dists-and-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="subsec:distributions" class="section level4 hasAnchor" number="5.2.4.1">
<h4><span class="header-section-number">5.2.4.1</span> Distributions<a href="cha-writing-models.html#subsec:distributions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>NIMBLE supports most of the distributions allowed in BUGS and
JAGS. Table <a href="cha-writing-models.html#tab:distributions">5.1</a> lists the distributions that are
currently supported, with their default parameterizations, which match
those of BUGS<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a>. NIMBLE also allows one to use alternative
parameterizations for a variety of distributions as described next.
See Section <a href="cha-user-defined.html#sec:user-distributions">12.2</a> to learn how to write new distributions using nimbleFunctions.</p>
<table>
<caption><span id="tab:distributions">Table 5.1: </span> Distributions with their default order of parameters. The value of the random variable
is given by <span class="math inline">\(x\)</span>.</caption>
<thead>
<tr class="header">
<th align="left">Name</th>
<th align="left">Usage</th>
<th align="left">Density</th>
<th>Lower</th>
<th>Upper</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Bernoulli</td>
<td align="left"><code>dbern(prob = p)</code></td>
<td align="left"><span class="math inline">\(p^x (1 - p)^{1 -x}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td><span class="math inline">\(1\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(0 &lt; p &lt; 1\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Beta</td>
<td align="left"><code>dbeta(shape1 = a,</code></td>
<td align="left"><span class="math inline">\(\frac{x^{a-1}(1-x)^{b-1}}{\beta(a,b)}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td><span class="math inline">\(1\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>shape2 = b)</code>, <span class="math inline">\(a &gt; 0\)</span>, <span class="math inline">\(b &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Binomial</td>
<td align="left"><code>dbin(prob = p, size = n)</code></td>
<td align="left"><span class="math inline">\({n \choose x} p^x (1-p)^{n-x}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td><span class="math inline">\(n\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(0 &lt; p &lt; 1\)</span>, <span class="math inline">\(n \in \mathbb{N}^*\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">CAR</td>
<td align="left"><code>dcar_normal(adj, weights,</code></td>
<td align="left">see chapter <a href="cha-spatial.html#cha-spatial">9</a> for details</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">(intrinsic)</td>
<td align="left"><code>num, tau, c, zero_mean)</code></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">CAR</td>
<td align="left"><code>dcar_proper(mu, C, adj,</code></td>
<td align="left">see chapter <a href="cha-spatial.html#cha-spatial">9</a> for details</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">(proper)</td>
<td align="left"><code>num, M, tau, gamma)</code></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Categorical</td>
<td align="left"><code>dcat(prob = p)</code></td>
<td align="left"><span class="math inline">\(\frac{p_x}{\sum_i p_i}\)</span></td>
<td><span class="math inline">\(1\)</span></td>
<td><span class="math inline">\(N\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(p \in (\mathbb{R}^+)^N\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Chi-square</td>
<td align="left"><code>dchisq(df = k)</code>, <span class="math inline">\(k &gt; 0\)</span></td>
<td align="left"><span class="math inline">\(\frac{x^{\frac{k}{2}-1} \exp(-x/2)}{2^{\frac{k}{2}} \Gamma(\frac{k}{2})}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Double</td>
<td align="left"><code>ddexp(location =</code> <span class="math inline">\(\mu\)</span>,</td>
<td align="left"><span class="math inline">\(\frac{\tau}{2} \exp(-\tau |x - \mu|)\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">exponential</td>
<td align="left"><code>rate =</code> <span class="math inline">\(\tau\)</span><code>),</code><span class="math inline">\(\tau &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Dirichlet</td>
<td align="left"><code>ddirch(alpha =</code> <span class="math inline">\(\alpha\)</span><code>)</code></td>
<td align="left"><span class="math inline">\(\Gamma(\sum_j \alpha_j) \prod_j \frac{ x_j^{\alpha_j - 1}}{ \Gamma(\alpha_j)}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"><span class="math inline">\(\alpha_j \geq 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Exponential</td>
<td align="left"><code>dexp(rate =</code> <span class="math inline">\(\lambda\)</span><code>)</code>, <span class="math inline">\(\lambda &gt; 0\)</span></td>
<td align="left"><span class="math inline">\(\lambda \exp(-\lambda x)\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Flat</td>
<td align="left"><code>dflat()</code></td>
<td align="left"><span class="math inline">\(\propto 1\)</span> (improper)</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Gamma</td>
<td align="left"><code>dgamma(shape = r, rate =</code> <span class="math inline">\(\lambda\)</span><code>)</code></td>
<td align="left"><span class="math inline">\(\frac{ \lambda^r x^{r - 1} \exp(-\lambda x)}{ \Gamma(r)}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"><span class="math inline">\(\lambda &gt; 0\)</span>, <span class="math inline">\(r &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Half flat</td>
<td align="left"><code>dhalfflat()</code></td>
<td align="left"><span class="math inline">\(\propto 1\)</span> (improper)</td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Inverse</td>
<td align="left"><code>dinvgamma(shape = r, scale =</code> <span class="math inline">\(\lambda\)</span><code>)</code></td>
<td align="left"><span class="math inline">\(\frac{ \lambda^r x^{-(r + 1)} \exp(-\lambda / x)}{ \Gamma(r)}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="even">
<td align="left">gamma</td>
<td align="left"><span class="math inline">\(\lambda &gt; 0\)</span>, <span class="math inline">\(r &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">LKJ Correl’n</td>
<td align="left"><code>dlkj_corr_cholesky(eta =</code> <span class="math inline">\(\eta\)</span><code>,</code></td>
<td align="left"><span class="math inline">\(\prod_{i=2}^{p} x_{ii}^{p - i + 2\eta -2}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Cholesky</td>
<td align="left"><code>size = p),</code> <span class="math inline">\(\eta &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Logistic</td>
<td align="left"><code>dlogis(location =</code> <span class="math inline">\(\mu\)</span>,</td>
<td align="left"><span class="math inline">\(\frac{ \tau \exp\{(x - \mu) \tau\}}{\left[1 + \exp\{(x - \mu) \tau\}\right]^2}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>rate =</code> <span class="math inline">\(\tau\)</span><code>),</code><span class="math inline">\(\tau &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Log-normal</td>
<td align="left"><code>dlnorm(meanlog =</code> <span class="math inline">\(\mu\)</span>,</td>
<td align="left"><span class="math inline">\(\left(\frac{\tau}{2\pi}\right)^{\frac{1}{2}} x^{-1} \exp \left\{-\tau (\log(x) - \mu)^2 / 2 \right\}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>taulog =</code> <span class="math inline">\(\tau\)</span><code>),</code> <span class="math inline">\(\tau &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Multinomial</td>
<td align="left"><code>dmulti(prob = p, size = n)</code></td>
<td align="left"><span class="math inline">\(n! \prod_j \frac{ p_j^{x_j}}{ x_j!}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(\sum_j x_j = n\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Multivariate</td>
<td align="left"><code>dmnorm(mean =</code> <span class="math inline">\(\mu\)</span><code>, prec =</code> <span class="math inline">\(\Lambda\)</span><code>)</code></td>
<td align="left"><span class="math inline">\((2\pi)^{-\frac{d}{2}}|\Lambda|^{\frac{1}{2}} \exp\{-\frac{(x-\mu)^T \Lambda (x-\mu)}{2}\}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">normal</td>
<td align="left"><span class="math inline">\(\Lambda\)</span> positive definite</td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Multivariate</td>
<td align="left"><code>dmvt(mu =</code> <span class="math inline">\(\mu\)</span><code>, prec =</code> <span class="math inline">\(\Lambda\)</span>,</td>
<td align="left"><span class="math inline">\(\frac{\Gamma(\frac{\nu+d}{2})}{\Gamma(\frac{\nu}{2})(\nu\pi)^{d/2}}|\Lambda|^{1/2}(1+\frac{(x-\mu)^T\Lambda(x-\mu)}{\nu})^{-\frac{\nu+d}{2}}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Student t</td>
<td align="left"><code>df =</code> <span class="math inline">\(\nu\)</span><code>),</code> <span class="math inline">\(\Lambda\)</span> positive def.</td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Negative</td>
<td align="left"><code>dnegbin(prob = p, size = r)</code></td>
<td align="left"><span class="math inline">\({x + r -1 \choose x} p^r (1-p)^x\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="even">
<td align="left">binomial</td>
<td align="left"><span class="math inline">\(0 &lt; p \leq 1\)</span>, <span class="math inline">\(r \geq 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Normal</td>
<td align="left"><code>dnorm(mean =</code> <span class="math inline">\(\mu\)</span><code>, tau =</code> <span class="math inline">\(\tau\)</span><code>)</code></td>
<td align="left"><span class="math inline">\(\left(\frac{\tau}{2\pi}\right)^{\frac{1}{2}} \exp\{- \tau (x - \mu)^2 / 2\}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(\tau &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Poisson</td>
<td align="left"><code>dpois(lambda =</code> <span class="math inline">\(\lambda\)</span><code>)</code></td>
<td align="left"><span class="math inline">\(\frac{ \exp(-\lambda)\lambda^x}{ x!}\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(\lambda &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Student t</td>
<td align="left"><code>dt(mu =</code> <span class="math inline">\(\mu\)</span><code>, tau =</code> <span class="math inline">\(\tau\)</span><code>, df = k)</code></td>
<td align="left"><span class="math inline">\(\frac{\Gamma(\frac{k+1}{2})}{\Gamma(\frac{k}{2})}\left(\frac{\tau}{k\pi}\right)^{\frac{1}{2}}\left\{1+\frac{\tau(x-\mu)^2}{k} \right\}^{-\frac{(k+1)}{2}}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(\tau &gt; 0\)</span>, <span class="math inline">\(k &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Uniform</td>
<td align="left"><code>dunif(min = a, max = b)</code></td>
<td align="left"><span class="math inline">\(\frac{ 1}{ b - a}\)</span></td>
<td><span class="math inline">\(a\)</span></td>
<td><span class="math inline">\(b\)</span></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(a &lt; b\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Weibull</td>
<td align="left"><code>dweib(shape = v, lambda =</code> <span class="math inline">\(\lambda\)</span><code>)</code></td>
<td align="left"><span class="math inline">\(v  \lambda  x^{v - 1} \exp (- \lambda x^v)\)</span></td>
<td><span class="math inline">\(0\)</span></td>
<td></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><span class="math inline">\(v &gt; 0\)</span>, <span class="math inline">\(\lambda &gt; 0\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Wishart</td>
<td align="left"><code>dwish(R = R, df = k)</code></td>
<td align="left"><span class="math inline">\(\frac{ |x|^{(k-p-1)/2} |R|^{k/2} \exp\{-\text{tr}(Rx)/2\}}{ 2^{pk/2} \pi^{p(p-1)/4} \prod_{i=1}^{p} \Gamma((k+1-i)/2)}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>R</code> <span class="math inline">\(p \times p\)</span> pos. def., <span class="math inline">\(k \geq p\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left">Inverse</td>
<td align="left"><code>dinvwish(S = S, df = k)</code></td>
<td align="left"><span class="math inline">\(\frac{ |x|^{-(k+p+1)/2} |S|^{k/2} \exp\{-\text{tr}(Sx^{-1})/2\}}{ 2^{pk/2} \pi^{p(p-1)/4} \prod_{i=1}^{p} \Gamma((k+1-i)/2)}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left">Wishart</td>
<td align="left"><code>S</code> <span class="math inline">\(p \times p\)</span> pos. def., <span class="math inline">\(k \geq p\)</span></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div id="improper-distributions" class="section level5 hasAnchor" number="5.2.4.1.1">
<h5><span class="header-section-number">5.2.4.1.1</span> Improper distributions<a href="cha-writing-models.html#improper-distributions" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Note that <code>dcar_normal</code>, <code>dflat</code> and <code>dhalfflat</code> specify improper prior distributions
and should only be used when the posterior distribution of the model is known to be proper.
Also for these distributions, the density function returns the unnormalized density
and the simulation function returns <code>NaN</code> so these distributions
are not appropriate for algorithms that need to simulate from the
prior or require proper (normalized) densities.</p>
</div>
<div id="lkj-distribution-for-correlation-matrices" class="section level5 hasAnchor" number="5.2.4.1.2">
<h5><span class="header-section-number">5.2.4.1.2</span> LKJ distribution for correlation matrices<a href="cha-writing-models.html#lkj-distribution-for-correlation-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>NIMBLE provides the LKJ distribution via <code>dlkj_corr_cholesky</code>
for correlation matrices, discussed in Section 24 of <span class="citation">Stan Development Team (<a href="references.html#ref-Stan_Lang_Fun_2021">2021a</a>)</span> and based on
<span class="citation">Lewandowski, Kurowicka, and Joe (<a href="references.html#ref-Lewandowski_etal_2009">2009</a>)</span>. This distribution has various advantages (both from a modeling perspective and an
MCMC fitting perspective) over other prior distributions for correlation
or covariance matrices such as the inverse Wishart distribution.</p>
<p>For computational efficiency, the distribution is on the Cholesky factor
of the correlation matrix rather than the correlation matrix itself. As a result using this distribution
in a model involves a bit of care, including efficiently creating a covariance matrix from the
correlation matrix and a set of standard deviations.</p>
<p>Here is some example code illustrating how to use the distribution in a model.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="cha-writing-models.html#cb82-1" tabindex="-1"></a>code <span class="ot">&lt;-</span> <span class="fu">nimbleCode</span>({</span>
<span id="cb82-2"><a href="cha-writing-models.html#cb82-2" tabindex="-1"></a>    Ustar[<span class="dv">1</span><span class="sc">:</span>p,<span class="dv">1</span><span class="sc">:</span>p] <span class="sc">~</span> <span class="fu">dlkj_corr_cholesky</span>(<span class="fl">1.3</span>, p)</span>
<span id="cb82-3"><a href="cha-writing-models.html#cb82-3" tabindex="-1"></a>    U[<span class="dv">1</span><span class="sc">:</span>p,<span class="dv">1</span><span class="sc">:</span>p] <span class="ot">&lt;-</span> <span class="fu">uppertri_mult_diag</span>(Ustar[<span class="dv">1</span><span class="sc">:</span>p, <span class="dv">1</span><span class="sc">:</span>p], sds[<span class="dv">1</span><span class="sc">:</span>p])</span>
<span id="cb82-4"><a href="cha-writing-models.html#cb82-4" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n)  </span>
<span id="cb82-5"><a href="cha-writing-models.html#cb82-5" tabindex="-1"></a>        y[i, <span class="dv">1</span><span class="sc">:</span>p] <span class="sc">~</span> <span class="fu">dmnorm</span>(mu[<span class="dv">1</span><span class="sc">:</span>p], <span class="at">cholesky =</span> U[<span class="dv">1</span><span class="sc">:</span>p, <span class="dv">1</span><span class="sc">:</span>p], <span class="at">prec_param =</span> <span class="dv">0</span>)</span>
<span id="cb82-6"><a href="cha-writing-models.html#cb82-6" tabindex="-1"></a>})</span></code></pre></div>
<p>Note that we need to take the upper triangular Cholesky factor (<code>Ustar</code>) of the correlation matrix
and convert it to the upper triangular Cholesky factor (<code>U</code>) of a covariance matrix, based on a vector of
standard deviations (<code>sds</code>), and use that in the parameterization of
<code>dmnorm</code> that directly (and therefore efficiently) uses the Cholesky of the covariance.</p>
<p>Other approaches are possible, but unless care is taken they are likely to be less
computationally efficient than the template above.</p>
<p>The template above uses a user-defined nimbleFunction to efficiently combine the
Cholesky of the correlation matrix with a vector of standard deviations to produce the
Cholesky of the covariance matrix. That function is given here:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="cha-writing-models.html#cb83-1" tabindex="-1"></a>uppertri_mult_diag <span class="ot">&lt;-</span> <span class="fu">nimbleFunction</span>(</span>
<span id="cb83-2"><a href="cha-writing-models.html#cb83-2" tabindex="-1"></a>    <span class="at">run =</span> <span class="cf">function</span>(<span class="at">mat =</span> <span class="fu">double</span>(<span class="dv">2</span>), <span class="at">vec =</span> <span class="fu">double</span>(<span class="dv">1</span>)) {</span>
<span id="cb83-3"><a href="cha-writing-models.html#cb83-3" tabindex="-1"></a>        <span class="fu">returnType</span>(<span class="fu">double</span>(<span class="dv">2</span>))</span>
<span id="cb83-4"><a href="cha-writing-models.html#cb83-4" tabindex="-1"></a>        p <span class="ot">&lt;-</span> <span class="fu">length</span>(vec)</span>
<span id="cb83-5"><a href="cha-writing-models.html#cb83-5" tabindex="-1"></a>        out <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow =</span> p, <span class="at">ncol =</span> p, <span class="at">init =</span> <span class="cn">FALSE</span>)</span>
<span id="cb83-6"><a href="cha-writing-models.html#cb83-6" tabindex="-1"></a>        <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>p)</span>
<span id="cb83-7"><a href="cha-writing-models.html#cb83-7" tabindex="-1"></a>            out[ , i] <span class="ot">&lt;-</span> mat[ , i] <span class="sc">*</span> vec[i]</span>
<span id="cb83-8"><a href="cha-writing-models.html#cb83-8" tabindex="-1"></a>        <span class="fu">return</span>(out)</span>
<span id="cb83-9"><a href="cha-writing-models.html#cb83-9" tabindex="-1"></a>    })</span></code></pre></div>
<p>Note that NIMBLE ignores the lower triangle of the Cholesky factor of the correlation matrix;
the values are taken to be zero. It also ignores the <code>[1,1]</code> element, which is taken to be one.
Any initial values for these elements will be ignored and simply repeated in the MCMC samples.</p>
<p>Assuming the <code>[1,1]</code> element is one and the lower triangle is filled with zeroes in the MCMC samples, one can
reconstruct a sample, here for the <code>s</code>th sample, of the correlation matrix as follows using the matrix of MCMC samples:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="cha-writing-models.html#cb84-1" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;^Ustar&quot;</span>,<span class="fu">colnames</span>(samples))</span>
<span id="cb84-2"><a href="cha-writing-models.html#cb84-2" tabindex="-1"></a>Ustar_sample <span class="ot">&lt;-</span> <span class="fu">matrix</span>(samples[s, cols], p, p)</span>
<span id="cb84-3"><a href="cha-writing-models.html#cb84-3" tabindex="-1"></a>corrMatrix_sample <span class="ot">&lt;-</span> <span class="fu">crossprod</span>(Ustar_sample)  <span class="do">## i.e., t(Ustar_sample) %*% Ustar_sample</span></span></code></pre></div>
</div>
</div>
<div id="subsec:alternative-params" class="section level4 hasAnchor" number="5.2.4.2">
<h4><span class="header-section-number">5.2.4.2</span> Alternative parameterizations for distributions<a href="cha-writing-models.html#subsec:alternative-params" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>NIMBLE allows one to specify distributions in model code using a
variety of parameterizations, including the BUGS
parameterizations. Available parameterizations are listed in Table <a href="cha-writing-models.html#tab:parameterizations">5.2</a>.
To understand how NIMBLE handles alternative parameterizations, it is
useful to distinguish three cases, using the <code>gamma</code> distribution
as an example:</p>
<ol style="list-style-type: decimal">
<li>A <em>canonical</em> parameterization is used directly for
computations<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a>. For
<code>gamma</code>, this is (shape, scale).<br />
</li>
<li>The BUGS parameterization is the one defined in the
original BUGS language. In general this is the parameterization for which conjugate MCMC samplers can be executed most efficiently. For <code>dgamma</code>, this is (shape, rate).</li>
<li>An <em>alternative</em> parameterization is one that must be
converted into the <em>canonical</em> parameterization. For <code>dgamma</code>,
NIMBLE provides both (shape, rate) and (mean, sd) parameterization
and creates nodes to calculate (shape, scale) from either (shape,
rate) or (mean, sd). In the case of <code>dgamma</code>, the BUGS
parameterization is also an <em>alternative</em> parameterization.</li>
</ol>
<p>Since NIMBLE provides compatibility with existing BUGS and JAGS
code, the order of parameters places the BUGS parameterization
first. For example, the order of parameters for <code>dgamma</code> is <code>dgamma(shape, rate, scale, mean, sd)</code>. Like R, if
parameter names are not given, they are taken in order, so that (shape,
rate) is the default. This happens to match R’s order of parameters,
but it need not. If names are given, they can be given in any
order. NIMBLE knows that rate is an alternative to scale and that
(mean, sd) are an alternative to (shape, scale or rate).</p>
<table>
<caption><span id="tab:parameterizations">Table 5.2: </span> Distribution parameterizations allowed in NIMBLE. The first column
indicates the supported parameterizations for
distributions given in Table <a href="cha-writing-models.html#tab:distributions">5.1</a>. The second
column indicates the
relationship to the <em>canonical</em> parameterization used in NIMBLE.</caption>
<thead>
<tr class="header">
<th align="left">Parameterization</th>
<th align="left">NIMBLE re-parameterization</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>dbern(prob)</code></td>
<td align="left"><code>dbin(size = 1, prob)</code></td>
</tr>
<tr class="even">
<td align="left"><code>dbeta(shape1, shape2)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dbeta(mean, sd)</code></td>
<td align="left"><code>dbeta(shape1 = mean^2 * (1-mean) / sd^2 - mean,</code></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left"><code>shape2 = mean * (1 - mean)^2 / sd^2 + mean - 1)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dbin(prob, size)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>dcat(prob)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dchisq(df)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>ddexp(location, scale)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>ddexp(location, rate)</code></td>
<td align="left"><code>ddexp(location, scale = 1 / rate)</code></td>
</tr>
<tr class="even">
<td align="left"><code>ddexp(location, var)</code></td>
<td align="left"><code>ddexp(location, scale = sqrt(var / 2))</code></td>
</tr>
<tr class="odd">
<td align="left"><code>ddirch(alpha)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>dexp(rate)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dexp(scale)</code></td>
<td align="left"><code>dexp(rate = 1/scale)</code></td>
</tr>
<tr class="even">
<td align="left"><code>dgamma(shape, scale)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dgamma(shape, rate)</code></td>
<td align="left"><code>dgamma(shape, scale = 1 / rate)</code></td>
</tr>
<tr class="even">
<td align="left"><code>dgamma(mean, sd)</code></td>
<td align="left"><code>dgamma(shape = mean^2/sd^2, scale = sd^2/mean)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dinvgamma(shape, rate)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>dinvgamma(shape, scale)</code></td>
<td align="left"><code>dgamma(shape, rate = 1 / scale)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dlkj_corr_cholesky(eta)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>dlogis(location, scale)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dlogis(location, rate)</code></td>
<td align="left"><code>dlogis(location, scale = 1 / rate)</code></td>
</tr>
<tr class="even">
<td align="left"><code>dlnorm(meanlog, sdlog)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dlnorm(meanlog, taulog)</code></td>
<td align="left"><code>dlnorm(meanlog, sdlog = 1 / sqrt(taulog))</code></td>
</tr>
<tr class="even">
<td align="left"><code>dlnorm(meanlog, varlog)</code></td>
<td align="left"><code>dlnorm(meanlog, sdlog = sqrt(varlog))</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dmulti(prob, size)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>dmnorm(mean, cholesky,</code></td>
<td align="left">canonical (precision)</td>
</tr>
<tr class="odd">
<td align="left"><code>...prec_param=1)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dmnorm(mean, cholesky,</code></td>
<td align="left">canonical (covariance)</td>
</tr>
<tr class="odd">
<td align="left"><code>...prec_param=0)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dmnorm(mean, prec)</code></td>
<td align="left"><code>dmnorm(mean, cholesky = chol(prec), prec_param=1)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dmnorm(mean, cov)</code></td>
<td align="left"><code>dmnorm(mean, cholesky = chol(cov), prec_param=0)</code></td>
</tr>
<tr class="even">
<td align="left"><code>dmvt(mu, cholesky, df,</code></td>
<td align="left">canonical (precision/inverse scale)</td>
</tr>
<tr class="odd">
<td align="left"><code>...prec_param=1)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dmvt(mu, cholesky, df,</code></td>
<td align="left">canonical (scale)</td>
</tr>
<tr class="odd">
<td align="left"><code>...prec_param=0)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dmvt(mu, prec, df)</code></td>
<td align="left"><code>dmvt(mu, cholesky = chol(prec), df, prec_param=1)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dmvt(mu, scale, df)</code></td>
<td align="left"><code>dmvt(mu, cholesky = chol(scale), df, prec_param=0)</code></td>
</tr>
<tr class="even">
<td align="left"><code>dlkj_corr_cholesky(</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>...shape, size)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dnegbin(prob, size)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dnorm(mean, sd)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>dnorm(mean, tau)</code></td>
<td align="left"><code>dnorm(mean, sd = 1 / sqrt(var))</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dnorm(mean, var)</code></td>
<td align="left"><code>dnorm(mean, sd = sqrt(var))</code></td>
</tr>
<tr class="even">
<td align="left"><code>dpois(lambda)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dt(mu, sigma, df)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>dt(mu, tau, df)</code></td>
<td align="left"><code>dt(mu, sigma = 1 / sqrt(tau), df)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dt(mu, sigma2, df)</code></td>
<td align="left"><code>dt(mu, sigma = sqrt(sigma2), df)</code></td>
</tr>
<tr class="even">
<td align="left"><code>dunif(min, max)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="odd">
<td align="left"><code>dweib(shape, scale)</code></td>
<td align="left">canonical</td>
</tr>
<tr class="even">
<td align="left"><code>dweib(shape, rate)</code></td>
<td align="left"><code>dweib(shape, scale = 1 / rate)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dweib(shape, lambda)</code></td>
<td align="left"><code>dweib(shape, scale = lambda^(- 1 / shape))</code></td>
</tr>
<tr class="even">
<td align="left"><code>dwish(cholesky, df,</code></td>
<td align="left">canonical (scale)</td>
</tr>
<tr class="odd">
<td align="left"><code>...scale_param=1)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dwish(cholesky, df,</code></td>
<td align="left">canonical (inverse scale)</td>
</tr>
<tr class="odd">
<td align="left"><code>...scale_param=0)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dwish(R, df)</code></td>
<td align="left"><code>dwish(cholesky = chol(R), df, scale_param = 0)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dwish(S, df)</code></td>
<td align="left"><code>dwish(cholesky = chol(S), df, scale_param = 1)</code></td>
</tr>
<tr class="even">
<td align="left"><code>dinvwish(cholesky, df,</code></td>
<td align="left">canonical (scale)</td>
</tr>
<tr class="odd">
<td align="left"><code>...scale_param=1)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dinvwish(cholesky, df,</code></td>
<td align="left">canonical (inverse scale)</td>
</tr>
<tr class="odd">
<td align="left"><code>...scale_param=0)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>dinvwish(R, df)</code></td>
<td align="left"><code>dinvwish(cholesky = chol(R), df, scale_param = 0)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>dinvwish(S, df)</code></td>
<td align="left"><code>dinvwish(cholesky = chol(S), df, scale_param = 1)</code></td>
</tr>
</tbody>
</table>
<p>Note that for multivariate normal, multivariate t, Wishart, and Inverse Wishart, the canonical
parameterization uses the Cholesky decomposition of one of the
precision/inverse scale or covariance/scale matrix. For example, for the multivariate normal, if <code>prec_param=TRUE</code>, the <code>cholesky</code> argument is treated as the Cholesky
decomposition of a precision matrix. Otherwise it is treated as the
Cholesky decomposition of a covariance matrix.
<!---  In some cases it may be more efficient to use that parameterization 
directly.  % PdV removed this because it is obtuse: In what cases?
Doesn't lifting of the cholesky computation take care of inefficiency? 
% What does "use that parameterization directly" mean, when there is
no meaning of "indirect" use of a parameterization?   --></p>
<p>In addition, NIMBLE supports alternative distribution names, known as aliases, as in JAGS, as specified in Table <a href="cha-writing-models.html#tab:densityAliases">5.3</a>.</p>
<table>
<caption><span id="tab:densityAliases">Table 5.3: </span> Distributions with alternative names (aliases)</caption>
<thead>
<tr class="header">
<th align="left">Distribution</th>
<th align="left">Canonical name</th>
<th align="left">Alias</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Binomial</td>
<td align="left">dbin</td>
<td align="left">dbinom</td>
</tr>
<tr class="even">
<td align="left">Chi-square</td>
<td align="left">dchisq</td>
<td align="left">dchisqr</td>
</tr>
<tr class="odd">
<td align="left">Double exponential</td>
<td align="left">ddexp</td>
<td align="left">dlaplace</td>
</tr>
<tr class="even">
<td align="left">Dirichlet</td>
<td align="left">ddirch</td>
<td align="left">ddirich</td>
</tr>
<tr class="odd">
<td align="left">Multinomial</td>
<td align="left">dmulti</td>
<td align="left">dmultinom</td>
</tr>
<tr class="even">
<td align="left">Negative binomial</td>
<td align="left">dnegbin</td>
<td align="left">dnbinom</td>
</tr>
<tr class="odd">
<td align="left">Weibull</td>
<td align="left">dweib</td>
<td align="left">dweibull</td>
</tr>
<tr class="even">
<td align="left">Wishart</td>
<td align="left">dwish</td>
<td align="left">dwishart</td>
</tr>
</tbody>
</table>
<!--- TODO: WHAT IS THE STATUS OF THE NEXT STATEMENT?: I've added inverse gamma in 0.6-4 and will do inverse wishart in 0.6-5. Hopefully will get to some others as well soon-ish - CJP. -->
<p>We plan to, but do not currently, include the following distributions as part of core NIMBLE: beta-binomial, Dirichlet-multinomial, F, Pareto, or forms of the multivariate t other than the standard one provided.
<!---  [F is easy to add as it has R functions] --></p>
</div>
</div>
<div id="subsec:BUGS-lang-fxns" class="section level3 hasAnchor" number="5.2.5">
<h3><span class="header-section-number">5.2.5</span> Available BUGS language functions<a href="cha-writing-models.html#subsec:BUGS-lang-fxns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Tables <a href="cha-writing-models.html#tab:functions">5.4</a>-<a href="cha-writing-models.html#tab:functionsMatrix">5.5</a> show the available operators and functions.
<!---\@ref(tab:functions)-\@ref(tab:functionsMatrix) 
Hard-coding these as not clear how to have tables here and in Chapter 11 use same source files but numbered distinctly
-->
<!---  These are also available for `nimbleFunction` programming (see Chapter \@ref(cha-progr-with-models)).  In fact, BUGS model nodes are implemented as `nimbleFunction`s that are custom-generated from BUGS declarations, so it would be more correct to say that functions and operators available for `nimbleFunction`s are also available for the model declarations. -->
Support for more general R expressions
is covered in Chapter <a href="cha-RCfunctions.html#cha-RCfunctions">11</a> about programming
with nimbleFunctions.</p>
<p>For the most part NIMBLE supports the functions used in BUGS and JAGS,
with exceptions indicated in the table. Additional functions provided
by NIMBLE are also listed. Note that we provide distribution functions
for use in calculations, namely the ‘p’, ‘q’, and ‘d’ functions.
See Section <a href="cha-RCfunctions.html#sec:nimble-dist-funs">11.2.4</a> for details on the syntax for using distribution functions as functions in deterministic calculations, as only some parameterizations are allowed and the names of some distributions differ from those used to define stochastic nodes in a model.
<!---  TODO: CJP moved this material to Chap 9 - that's where it is most relevant  
% so I thought it best to go into the caveats there -->
<!--- Currently 'r' functions only return one random 
%draw at a time, and the first argument must always be 1.  For -->
<!--- multivariate distribution functions the `prec_param` or 
%`scale_param` argument must be provided, indicating when a -->
<!--- covariance or precision matrix has been given.  In a future release we 
%will provide a variety of distribution functions, including density, -->
<!--- cumulative distribution and quantile functions, using the same syntax 
%as `dnorm`, `pnorm`, `qnorm`.  We will also extend the -->
<!--- alternative parameterizations with named parameters to 
%`nimbleFunctions`. --></p>
<table>
<caption><span id="tab:functions">Table 5.4: </span> Functions operating on scalars, many of which can operate on each element (component-wise) of
vectors and matrices. Status column indicates if the function is currently provided in NIMBLE. Vector input column
indicates if the function can take a vector as an argument (i.e., if the function is vectorized).</caption>
<thead>
<tr class="header">
<th align="left">Usage</th>
<th align="left">Description</th>
<th align="left">Comments</th>
<th>Status</th>
<th>Vector input</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>x | y</code>, <code>x &amp; y</code></td>
<td align="left">logical OR (<span class="math inline">\(|\)</span>) and AND(&amp;)</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>!x</code></td>
<td align="left">logical not</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>x &gt; y, x &gt;= y</code></td>
<td align="left">greater than (and or equal to)</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>x &lt; y, x &lt;= y</code></td>
<td align="left">less than (and or equal to)</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>x != y, x == y</code></td>
<td align="left">(not) equals</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>x + y, x - y, x * y</code></td>
<td align="left">component-wise operators</td>
<td align="left">mix of scalar and vector</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>x / y</code></td>
<td align="left">component-wise division</td>
<td align="left">vector <span class="math inline">\(x\)</span> and scalar <span class="math inline">\(y\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>x^y, pow(x, y)</code></td>
<td align="left">power</td>
<td align="left"><span class="math inline">\(x^y\)</span>; vector <span class="math inline">\(x\)</span>,scalar <span class="math inline">\(y\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>x %% y</code></td>
<td align="left">modulo (remainder)</td>
<td align="left"></td>
<td>yes</td>
<td>no</td>
</tr>
<tr class="even">
<td align="left"><code>min(x1, x2),</code></td>
<td align="left">min. (max.) of two scalars</td>
<td align="left"></td>
<td>yes</td>
<td>See <code>pmin</code>,</td>
</tr>
<tr class="odd">
<td align="left"><code>max(x1, x2)</code></td>
<td align="left"></td>
<td align="left"></td>
<td></td>
<td><code>pmax</code></td>
</tr>
<tr class="even">
<td align="left"><code>exp(x)</code></td>
<td align="left">exponential</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>log(x)</code></td>
<td align="left">natural logarithm</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>sqrt(x)</code></td>
<td align="left">square root</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>abs(x)</code></td>
<td align="left">absolute value</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>step(x)</code></td>
<td align="left">step function at 0</td>
<td align="left">0 if <span class="math inline">\(x&lt;0\)</span>, 1 if <span class="math inline">\(x&gt;=0\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>equals(x, y)</code></td>
<td align="left">equality of two scalars</td>
<td align="left">1 if <span class="math inline">\(x==y\)</span>, 0 if <span class="math inline">\(x != y\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>cube(x)</code></td>
<td align="left">third power</td>
<td align="left"><span class="math inline">\(x^3\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>sin(x), cos(x),</code></td>
<td align="left">trigonometric functions</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>tan(x)</code></td>
<td align="left"></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>asin(x), acos(x),</code></td>
<td align="left">inverse trigonometric functions</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>atan(x)</code></td>
<td align="left"></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>asinh(x), acosh(x),</code></td>
<td align="left">inv. hyperbolic trig. functions</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>atanh(x)</code></td>
<td align="left"></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>logit(x)</code></td>
<td align="left">logit</td>
<td align="left"><span class="math inline">\(\log(x/(1-x))\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>ilogit(x), expit(x)</code></td>
<td align="left">inverse logit</td>
<td align="left"><span class="math inline">\(\exp(x)/(1 + \exp(x))\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>probit(x)</code></td>
<td align="left">probit (Gaussian quantile)</td>
<td align="left"><span class="math inline">\(\Phi^{-1}(x)\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>iprobit(x), phi(x)</code></td>
<td align="left">inverse probit (Gaussian CDF)</td>
<td align="left"><span class="math inline">\(\Phi(x)\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>cloglog(x)</code></td>
<td align="left">complementary log log</td>
<td align="left"><span class="math inline">\(\log(-\log(1-x))\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>icloglog(x)</code></td>
<td align="left">inverse complementary log log</td>
<td align="left"><span class="math inline">\(1 - \exp(-\exp(x))\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>ceiling(x)</code></td>
<td align="left">ceiling function</td>
<td align="left"><span class="math inline">\(\lceil(x)\rceil\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>floor(x)</code></td>
<td align="left">floor function</td>
<td align="left"><span class="math inline">\(\lfloor(x)\rfloor\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>round(x)</code></td>
<td align="left">round to integer</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>trunc(x)</code></td>
<td align="left">truncation to integer</td>
<td align="left"></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>lgamma(x), loggam(x)</code></td>
<td align="left">log gamma function</td>
<td align="left"><span class="math inline">\(\log \Gamma(x)\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>besselK(x, nu,</code></td>
<td align="left">modified bessel function</td>
<td align="left">returns vector even if</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>...expon.scaled)</code></td>
<td align="left">of the second kind</td>
<td align="left"><span class="math inline">\(x\)</span> a matrix/array</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>log1p(x)</code></td>
<td align="left">log of 1 + x</td>
<td align="left"><span class="math inline">\(\log(1+x)\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>lfactorial(x),</code></td>
<td align="left">log factorial</td>
<td align="left"><span class="math inline">\(\log x!\)</span></td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>logfact(x)</code></td>
<td align="left"></td>
<td align="left"></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>qDIST(x, PARAMS)</code></td>
<td align="left">“q” distribution functions</td>
<td align="left">canonical parameterization</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>pDIST(x, PARAMS)</code></td>
<td align="left">“p” distribution functions</td>
<td align="left">canonical parameterization</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>rDIST(x, PARAMS)</code></td>
<td align="left">“r” distribution functions</td>
<td align="left">canonical parameterization</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>dDIST(x, PARAMS)</code></td>
<td align="left">“d” distribution functions</td>
<td align="left">canonical parameterization</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>sort(x)</code></td>
<td align="left"></td>
<td align="left"></td>
<td>no</td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>rank(x, s)</code></td>
<td align="left"></td>
<td align="left"></td>
<td>no</td>
<td></td>
</tr>
<tr class="odd">
<td align="left"><code>ranked(x, s)</code></td>
<td align="left"></td>
<td align="left"></td>
<td>no</td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>order(x)</code></td>
<td align="left"></td>
<td align="left"></td>
<td>no</td>
<td></td>
</tr>
</tbody>
</table>
<table>
<caption><span id="tab:functionsMatrix">Table 5.5: </span> Functions operating on vectors and matrices. Status column indicates if the function is currently
provided in NIMBLE.</caption>
<thead>
<tr class="header">
<th align="left">Usage</th>
<th align="left">Description</th>
<th align="left">Comments</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>inverse(x)</code></td>
<td align="left">matrix inverse</td>
<td align="left"><span class="math inline">\(x\)</span> symmetric, positive def.</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>chol(x)</code></td>
<td align="left">matrix Cholesky factorization</td>
<td align="left"><span class="math inline">\(x\)</span> symmetric, positive def.</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"></td>
<td align="left">returns upper triang. matrix</td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>t(x)</code></td>
<td align="left">matrix transpose</td>
<td align="left"><span class="math inline">\(x^\top\)</span></td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>x%*%y</code></td>
<td align="left">matrix multiply</td>
<td align="left"><span class="math inline">\(xy\)</span>; <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span> conformant</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>inprod(x, y)</code></td>
<td align="left">dot product</td>
<td align="left"><span class="math inline">\(x^\top y\)</span>; <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> vectors</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>solve(x,y)</code></td>
<td align="left">solve system of equations</td>
<td align="left"><span class="math inline">\(x^{-1} y\)</span>; <span class="math inline">\(y\)</span> matrix or vector</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>forwardsolve(x, y)</code></td>
<td align="left">solve lower-triangular system of equations</td>
<td align="left"><span class="math inline">\(x^{-1} y\)</span>; <span class="math inline">\(x\)</span> lower-triangular</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>backsolve(x, y)</code></td>
<td align="left">solve upper-triangular system of equations</td>
<td align="left"><span class="math inline">\(x^{-1} y\)</span>; <span class="math inline">\(x\)</span> upper-triangular</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>logdet(x)</code></td>
<td align="left">log matrix determinant</td>
<td align="left"><span class="math inline">\(\log|x|\)</span></td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>asRow(x)</code></td>
<td align="left">convert vector to 1-row matrix</td>
<td align="left">sometimes automatic</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>asCol(x)</code></td>
<td align="left">convert vector to 1-column matrix</td>
<td align="left">sometimes automatic</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>sum(x)</code></td>
<td align="left">sum of elements of <code>x</code></td>
<td align="left"></td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>mean(x)</code></td>
<td align="left">mean of elements of <code>x</code></td>
<td align="left"></td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>sd(x)</code></td>
<td align="left">standard deviation of elements of <code>x</code></td>
<td align="left"></td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>prod(x)</code></td>
<td align="left">product of elements of <code>x</code></td>
<td align="left"></td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>min(x), max(x)</code></td>
<td align="left">min. (max.) of elements of <code>x</code></td>
<td align="left"></td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>pmin(x, y), pmax(x,y)</code></td>
<td align="left">vector of mins (maxs) of elements of</td>
<td align="left"></td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left"><code>x</code> and <code>y</code></td>
<td align="left"></td>
<td></td>
</tr>
<tr class="even">
<td align="left"><code>interp.lin(x, v1, v2)</code></td>
<td align="left">linear interpolation</td>
<td align="left"></td>
<td>no</td>
</tr>
<tr class="odd">
<td align="left"><code>eigen(x)$values</code></td>
<td align="left">matrix eigenvalues</td>
<td align="left"><span class="math inline">\(x\)</span> symmetric</td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>eigen(x)$vectors</code></td>
<td align="left">matrix eigenvectors</td>
<td align="left"><span class="math inline">\(x\)</span> symmetric</td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>svd(x)$d</code></td>
<td align="left">matrix singular values</td>
<td align="left"></td>
<td>yes</td>
</tr>
<tr class="even">
<td align="left"><code>svd(x)$u</code></td>
<td align="left">matrix left singular vectors</td>
<td align="left"></td>
<td>yes</td>
</tr>
<tr class="odd">
<td align="left"><code>svd(x)$v</code></td>
<td align="left">matrix right singular vectors</td>
<td align="left"></td>
<td>yes</td>
</tr>
</tbody>
</table>
<!---  [NOTE: JAGS source package has the Tex files for Martyn's manual, so we can copy the table formatting - s doc/manual/jags_user_manual.md] -->
<p>See Section <a href="cha-user-defined.html#sec:user-functions">12.1</a> to learn how to use nimbleFunctions to write new functions for use in BUGS code.</p>
</div>
<div id="subsec:BUGS-link" class="section level3 hasAnchor" number="5.2.6">
<h3><span class="header-section-number">5.2.6</span> Available link functions<a href="cha-writing-models.html#subsec:BUGS-link" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>NIMBLE allows the link functions listed in Table <a href="cha-writing-models.html#tab:links">5.6</a>.</p>
<table>
<caption><span id="tab:links">Table 5.6: </span> Link functions.</caption>
<thead>
<tr class="header">
<th align="left">Link function</th>
<th align="left">Description</th>
<th align="left">Range</th>
<th align="left">Inverse</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>cloglog(y) &lt;- x</code></td>
<td align="left">Complementary log log</td>
<td align="left"><span class="math inline">\(0 &lt; y &lt; 1\)</span></td>
<td align="left"><code>y &lt;- icloglog(x)</code></td>
</tr>
<tr class="even">
<td align="left"><code>log(y) &lt;- x</code></td>
<td align="left">Log</td>
<td align="left"><span class="math inline">\(0 &lt; y\)</span></td>
<td align="left"><code>y &lt;- exp(x)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>logit(y) &lt;- x</code></td>
<td align="left">Logit</td>
<td align="left"><span class="math inline">\(0 &lt; y &lt; 1\)</span></td>
<td align="left"><code>y &lt;- expit(x)</code></td>
</tr>
<tr class="even">
<td align="left"><code>probit(y) &lt;- x</code></td>
<td align="left">Probit</td>
<td align="left"><span class="math inline">\(0 &lt; y &lt; 1\)</span></td>
<td align="left"><code>y &lt;- iprobit(x)</code></td>
</tr>
</tbody>
</table>
<p>Link functions are specified as functions applied to a node on the
left hand side of a BUGS expression. To handle link functions in
deterministic declarations, NIMBLE converts the declaration into an
equivalent inverse declaration. For example, <code>log(y) &lt;- x</code> is
converted into <code>y &lt;- exp(x)</code>. In other words, the link function is
just a simple variant for conceptual clarity.</p>
<p>To handle link functions in a stochastic declaration, NIMBLE
does some processing that inserts an additional node into the model.
For example, the declaration <code>logit(p[i]) ~ dnorm(mu[i],1)</code>, is equivalent
to the following two declarations:</p>
<ul>
<li><code>logit_p[i] ~ dnorm(mu[i], 1)</code>,</li>
<li><code>p[i] &lt;- expit(logit_p[i])</code></li>
</ul>
<p>where <code>expit</code> is the inverse of <code>logit</code>.</p>
<p>Note that NIMBLE does not provide an automatic way of initializing the additional node (<code>logit_p[i]</code> in this case), which is a parent node of the explicit node (<code>p[i]</code>), without explicitly referring to the additional node by the name that NIMBLE generates.</p>
</div>
<div id="subsec:trunc" class="section level3 hasAnchor" number="5.2.7">
<h3><span class="header-section-number">5.2.7</span> Truncation, censoring, and constraints<a href="cha-writing-models.html#subsec:trunc" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>NIMBLE provides three ways to declare boundaries on the value of a variable, each for different situations. We introduce these and comment on their relationships to related features of JAGS and BUGS. The three methods are:</p>
<div id="truncation" class="section level4 hasAnchor" number="5.2.7.1">
<h4><span class="header-section-number">5.2.7.1</span> Truncation<a href="cha-writing-models.html#truncation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Either of the following forms,</p>
<pre><code>x ~ dnorm(0, sd = 10) T(0, a)
x ~ T(dnorm(0, sd = 10), 0, a)</code></pre>
<p>declares that <code>x</code> follows a normal distribution between 0 and
<code>a</code> (inclusive of 0 and <code>a</code>). Either boundary may be omitted or may be another node, such as <code>a</code> in this example. The first form is compatible with JAGS, but in NIMBLE it can only be used when reading code from a text file. When writing model code in R, the second version must be used.</p>
<p>Truncation means the possible values of <code>x</code> are limited a priori, hence the probability density of <code>x</code> must be normalized<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>. In this example it would be the normal probability density divided by its integral from 0 to <code>a</code>. Like JAGS, NIMBLE also provides <code>I</code> as a synonym for <code>T</code> to accommodate older BUGS code, but <code>T</code> is preferred because it disambiguates multiple usages of <code>I</code> in BUGS.</p>
</div>
<div id="censoring" class="section level4 hasAnchor" number="5.2.7.2">
<h4><span class="header-section-number">5.2.7.2</span> Censoring<a href="cha-writing-models.html#censoring" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Censoring refers to the situation where one datum gives the lower or upper bound on an unobserved random variable. This is common in survival analysis, when for an individual still surviving at the end of a study, the age of death is not known and hence is ‘censored’ (right-censoring). NIMBLE adopts JAGS syntax for censoring, as follows:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="cha-writing-models.html#cb86-1" tabindex="-1"></a>censored[i] <span class="sc">~</span> <span class="fu">dinterval</span>(t[i], c[i])</span>
<span id="cb86-2"><a href="cha-writing-models.html#cb86-2" tabindex="-1"></a>t[i] <span class="sc">~</span> <span class="fu">dweib</span>(r, mu[i])</span></code></pre></div>
<p>In the case of right-censoring, <code>censored[i]</code> should be given as <code>data</code> with a value of 1 if
<code>t[i]</code> is right-censored (<code>t[i] &gt; c[i]</code>) and 0 if it is
observed. The data vector for <code>t</code> should have <code>NA</code> (indicating
missing data) for any censored <code>t[i]</code> entries. (As a result, these
nodes will be sampled in an MCMC.) The vector for <code>c</code> should
give the censoring times corresponding to censored entries and a value
above the observed times for uncensored entries (e.g., <code>Inf</code>). The values for <code>c</code>
can be provided via <code>constants</code>, <code>inits</code>, or <code>data</code>. We recommend providing
via <code>constants</code> for values that are fixed and via <code>inits</code> for values that are
to be estimated or might be changed for some reason.</p>
<p>Left-censored observations would be specified by setting <code>censored[i]</code> to 0
and <code>t[i]</code> to <code>NA</code>.</p>
<p>Important: The value of <code>t[i]</code> corresponding to each censored data point should be given a
valid initial value (via <code>inits</code>) that is consistent with <code>censored[i]</code>. Otherwise, NIMBLE will initialize
from the prior, which may not produce a valid initial value.</p>
<p>The <code>dinterval</code> is not really a distribution but rather a trick: in the above example when <code>censored[i] = 1</code> it gives a ‘probability’ of 1 if <code>t[i] &gt; c[i]</code> and 0 otherwise. This means that <code>t[i] &lt;= c[i]</code> is treated as impossible. More generally than simple right- or left-censoring, <code>censored[i] ~ dinterval(t[i], c[i, ])</code> is defined such that for a vector of increasing cutpoints, <code>c[i, ]</code>, <code>t[i]</code> is enforced to fall within the <code>censored[i]</code>-th cutpoint interval. This is done by setting data <code>censored[i]</code> as follows:</p>
<p><code>censored[i] = 0</code> if <code>t[i]</code> &lt;= <code>c[i, 1]</code></p>
<p><code>censored[i] = m</code> if <code>c[i, m] &lt; t[i]</code> &lt;= <code>c[i, m+1]</code> for <span class="math inline">\(1 \leq m \leq M\)</span></p>
<p><code>censored[i] = M</code> if <code>c[i, M] &lt; t[i]</code></p>
<p>(The <code>i</code> index is provided only for consistency with the previous example.) The most common uses of <code>dinterval</code> will be for left- and right-censored data, in which case <code>c[i,]</code> will be a single value (and typically given as simply <code>c[i]</code>), and for interval-censored data, in which case <code>c[i,]</code> will be a vector of two values.<br />
<!---  TODO: Next line removed by CJP as I thought it was confusing: 
% or `x[i] ~ dinterval(c[i], t[i])` with `x[i]` set to 1. -->
<!---  WHY - our dinterval code treats the 2nd arg as possibly a vector - the above presumably works for scalars but I think it is clearer if we always use the first arg as the data value and the 2nd as the interval points --></p>
<p>Nodes following a <code>dinterval</code> distribution should normally be set
as <code>data</code> with known values. Otherwise, the node may be simulated during initialization in some algorithms (e.g., MCMC) and thereby establish a permanent, perhaps unintended, constraint.</p>
<p>Censoring differs from truncation because censoring an observation involves bounds on a random variable that could have taken any value, while in truncation we know a priori that a datum could not have occurred outside the truncation range.</p>
</div>
<div id="constraints-and-ordering" class="section level4 hasAnchor" number="5.2.7.3">
<h4><span class="header-section-number">5.2.7.3</span> Constraints and ordering<a href="cha-writing-models.html#constraints-and-ordering" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>NIMBLE provides a more general way to enforce constraints using <code>dconstraint(cond)</code>. For example, we could specify that the sum of <code>mu1</code> and <code>mu2</code> must be positive like this:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="cha-writing-models.html#cb87-1" tabindex="-1"></a>mu1 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>) </span>
<span id="cb87-2"><a href="cha-writing-models.html#cb87-2" tabindex="-1"></a>mu2 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>) </span>
<span id="cb87-3"><a href="cha-writing-models.html#cb87-3" tabindex="-1"></a>constraint_data <span class="sc">~</span> <span class="fu">dconstraint</span>( mu1 <span class="sc">+</span> mu2 <span class="sc">&gt;</span> <span class="dv">0</span> )</span></code></pre></div>
<p>with <code>constraint_data</code> set (as <code>data</code>) to 1. This is
equivalent to a half-normal distribution on the half-plane <span class="math inline">\(\mu_1 +
\mu_2 &gt; 0\)</span>. Nodes following <code>dconstraint</code> should be provided as data for the same reason of avoiding unintended initialization described above for <code>dinterval</code>.
<!--- If one simulates from the model using the `simulate` functions and the condition is not satisfied, then `const` will be 0 and the log probability of `const` (and therefore of the model as whole) will be $-\infty$. --></p>
<p>Important: the model should be initialized so that the constraints are satisfied. Otherwise, NIMBLE will initialize from the prior, which may not produce a valid initial value and may cause algorithms (particularly) MCMC to fail.</p>
<p>Formally, <code>dconstraint(cond)</code> is a probability distribution on <span class="math inline">\(\left\{ 0, 1 \right\}\)</span> such that <span class="math inline">\(P(1) = 1\)</span> if <code>cond</code> is <code>TRUE</code> and <span class="math inline">\(P(0) = 1\)</span> if <code>cond</code> is <code>FALSE</code>.
<!---  TODO: Chris thought this wording is confusing: 
%Like `dinterval`, `dconstraint` results in distributions that are not normalized (e.g. for (`mu1`, `mu2`)), which makes most sense if the constraint is observed rather than established a priori. --></p>
<p>Of course, in many cases, parameterizing the model so that the
constraints are automatically respected may be a better strategy than
using <code>dconstraint</code>. One should be cautious about constraints that
would make it hard for an MCMC or optimization to move through the
parameter space (such as equality constraints that involve two or more
parameters). For such restrictive constraints, general purpose
algorithms that are not tailored to the constraints may fail or be inefficient. If constraints are used, it will generally be wise to ensure the model is initialized with values that satisfy them.</p>
<div id="ordering" class="section level5 hasAnchor" number="5.2.7.3.1">
<h5><span class="header-section-number">5.2.7.3.1</span> Ordering<a href="cha-writing-models.html#ordering" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>To specify an ordering of parameters, such as <span class="math inline">\(\alpha_1 &lt;= \alpha_2 &lt;= \alpha_3\)</span> one can use <code>dconstraint</code> as follows:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="cha-writing-models.html#cb88-1" tabindex="-1"></a>constraint_data <span class="sc">~</span> <span class="fu">dconstraint</span>( alpha1 <span class="sc">&lt;=</span> alpha2 <span class="sc">&amp;</span> alpha2 <span class="sc">&lt;=</span> alpha3 )</span></code></pre></div>
<p>Note that unlike in BUGS, one cannot specify prior ordering using syntax such as</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="cha-writing-models.html#cb89-1" tabindex="-1"></a>alpha[<span class="dv">1</span>] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="fu">I</span>(, alpha[<span class="dv">2</span>])</span>
<span id="cb89-2"><a href="cha-writing-models.html#cb89-2" tabindex="-1"></a>alpha[<span class="dv">2</span>] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="fu">I</span>(alpha[<span class="dv">1</span>], alpha[<span class="dv">3</span>])</span>
<span id="cb89-3"><a href="cha-writing-models.html#cb89-3" tabindex="-1"></a>alpha[<span class="dv">3</span>] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="fu">I</span>(alpha[<span class="dv">2</span>], )</span></code></pre></div>
<p>as this does not represent a directed acyclic graph.
<!---  TODO: CHRIS, WOULDN'T THIS WORK WITH `alpha[1] $\sim$ dnorm(0, 1)`?  DOES BUGS REALLY ALLOW THIS NON-DAG? 
% PERRY, JAGS manual indicates the above is allowed in BUGS. Are you asking if it would work in NIMBLE with alpha1~dnorm(0,1) -- no because alpha2 still depends on alpha3 and vice versa --></p>
<p>Also note that specifying prior ordering using <code>T(,)</code> can result in possibly unexpected results. For example:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="cha-writing-models.html#cb90-1" tabindex="-1"></a>alpha1 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb90-2"><a href="cha-writing-models.html#cb90-2" tabindex="-1"></a>alpha2 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="fu">T</span>(alpha1, )</span>
<span id="cb90-3"><a href="cha-writing-models.html#cb90-3" tabindex="-1"></a>alpha3 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="fu">T</span>(alpha2, )</span></code></pre></div>
<p>will enforce <code>alpha1</code> <span class="math inline">\(\le\)</span> <code>alpha2</code> <span class="math inline">\(\le\)</span> <code>alpha3</code>, but it does not treat the three parameters symmetrically. Instead it puts a marginal prior on <code>alpha1</code> that is standard normal and then constrains <code>alpha2</code> and <code>alpha3</code> to follow truncated normal distributions. This is not equivalent to a symmetric prior on the three <code>alpha</code>s that assigns zero probability density when values are not in order.</p>
<p>NIMBLE does not support the JAGS <code>sort</code> syntax.</p>

<!--- % See http://yihui.name/knitr/demo/child/ for documentation on the parent/child document system of knitr -->
</div>
</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="10">
<li id="fn10"><p>NIMBLE calls non-stochastic nodes ‘deterministic’, whereas BUGS calls them ‘logical’. NIMBLE uses ‘logical’ in the way R does, to refer to boolean (TRUE/FALSE) variables.<a href="cha-writing-models.html#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>But beware of the possibility of needing to set values for ‘lifted’ nodes created by NIMBLE.<a href="cha-writing-models.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>In some cases, one can write a nimbleFunction to achieve the desired result, such as replacing <code>sum(mu[start[i]:end[i]])</code> with a nimbleFunction that takes <code>mu</code>, <code>start[i]</code>, and <code>end[i]</code> as arguments and does the needed summation.<a href="cha-writing-models.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>Technically, a
<em>directed acyclic graph</em><a href="cha-writing-models.html#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>In <code>nimbleFunctions</code>, as
explained in later chapters, square brackets with blank indices are
not necessary for multivariate objects.<a href="cha-writing-models.html#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>Note that the same distributions are available
for writing <code>nimbleFunction</code>s, but in that case the default
parameterizations and function names match R’s when possible. Please
see Section <a href="cha-RCfunctions.html#sec:nimble-dist-funs">11.2.4</a> for how to use distributions
in <code>nimbleFunctions</code>.<a href="cha-writing-models.html#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>Usually this is the parameterization in the
<code>Rmath</code> header of R’s C implementation of distributions.<a href="cha-writing-models.html#fnref16" class="footnote-back">↩︎</a></p></li>
<li id="fn17"><p>NIMBLE uses the CDF and inverse CDF (quantile) functions of a distribution to do this; in some cases if one uses truncation to include only the extreme tail of a distribution, numerical difficulties can arise.<a href="cha-writing-models.html#fnref17" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cha-installing-nimble.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cha-building-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["NimbleUserManual.pdf", "NimbleUserManual.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 3
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
