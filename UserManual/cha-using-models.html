<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title></title>
  <meta name="description" content="This is the NIMBLE User Manual." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="nimble-icon.png" />
  <meta property="og:description" content="This is the NIMBLE User Manual." />
  <meta name="github-repo" content="nimble-dev/nimble" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  <meta name="twitter:description" content="This is the NIMBLE User Manual." />
  <meta name="twitter:image" content="nimble-icon.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cha-user-defined.html">
<link rel="next" href="cha-data-structures.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<img src="./nimble-icon.png"
     width=100>
<li><a href="./">NIMBLE User Manual, Version 0.9.0</a></li>
<li><a href="https://github.com/nimble-dev/nimble">NIMBLE Development Team</a></li>
<li><a href="https://R-nimble.org">https://R-nimble.org</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html"><i class="fa fa-check"></i><b>1</b> Welcome to NIMBLE</a><ul>
<li class="chapter" data-level="1.1" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html#sec:what-is-nimble"><i class="fa fa-check"></i><b>1.1</b> What does NIMBLE do?</a></li>
<li class="chapter" data-level="1.2" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html#how-to-use-this-manual"><i class="fa fa-check"></i><b>1.2</b> How to use this manual</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html"><i class="fa fa-check"></i><b>2</b> Lightning introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:brief-example"><i class="fa fa-check"></i><b>2.1</b> A brief example</a></li>
<li class="chapter" data-level="2.2" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-model"><i class="fa fa-check"></i><b>2.2</b> Creating a model</a></li>
<li class="chapter" data-level="2.3" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:compiling-model"><i class="fa fa-check"></i><b>2.3</b> Compiling the model</a></li>
<li class="chapter" data-level="2.4" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:intro-runMCMC"><i class="fa fa-check"></i><b>2.4</b> One-line invocation of MCMC</a></li>
<li class="chapter" data-level="2.5" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-mcmc"><i class="fa fa-check"></i><b>2.5</b> Creating, compiling and running a basic MCMC configuration</a></li>
<li class="chapter" data-level="2.6" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:customizing-mcmc"><i class="fa fa-check"></i><b>2.6</b> Customizing the MCMC</a></li>
<li class="chapter" data-level="2.7" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:running-mcem"><i class="fa fa-check"></i><b>2.7</b> Running MCEM</a></li>
<li class="chapter" data-level="2.8" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-your-own"><i class="fa fa-check"></i><b>2.8</b> Creating your own functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html"><i class="fa fa-check"></i><b>3</b> More introduction</a><ul>
<li class="chapter" data-level="3.1" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#nimble-adopts-and-extends-the-bugs-language-for-specifying-models"><i class="fa fa-check"></i><b>3.1</b> NIMBLE adopts and extends the BUGS language for specifying models</a></li>
<li class="chapter" data-level="3.2" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#sec:nimble-lang-writ"><i class="fa fa-check"></i><b>3.2</b> nimbleFunctions for writing algorithms</a></li>
<li class="chapter" data-level="3.3" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#sec:nimble-algor-libr"><i class="fa fa-check"></i><b>3.3</b> The NIMBLE algorithm library</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html"><i class="fa fa-check"></i><b>4</b> Installing NIMBLE</a><ul>
<li class="chapter" data-level="4.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:requ-run-nimble"><i class="fa fa-check"></i><b>4.1</b> Requirements to run NIMBLE</a></li>
<li class="chapter" data-level="4.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:compiler"><i class="fa fa-check"></i><b>4.2</b> Installing a C++ compiler for NIMBLE to use</a><ul>
<li class="chapter" data-level="4.2.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#macos"><i class="fa fa-check"></i><b>4.2.1</b> MacOS</a></li>
<li class="chapter" data-level="4.2.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#linux"><i class="fa fa-check"></i><b>4.2.2</b> Linux</a></li>
<li class="chapter" data-level="4.2.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#windows"><i class="fa fa-check"></i><b>4.2.3</b> Windows</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#installing-the-nimble-package"><i class="fa fa-check"></i><b>4.3</b> Installing the NIMBLE package</a></li>
<li class="chapter" data-level="4.4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#troubleshooting-installation-problems"><i class="fa fa-check"></i><b>4.4</b> Troubleshooting installation problems</a></li>
<li class="chapter" data-level="4.5" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#customizing-your-installation"><i class="fa fa-check"></i><b>4.5</b> Customizing your installation</a><ul>
<li class="chapter" data-level="4.5.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#using-your-own-copy-of-eigen"><i class="fa fa-check"></i><b>4.5.1</b> Using your own copy of Eigen</a></li>
<li class="chapter" data-level="4.5.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#using-libnimble"><i class="fa fa-check"></i><b>4.5.2</b> Using libnimble</a></li>
<li class="chapter" data-level="4.5.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:blas"><i class="fa fa-check"></i><b>4.5.3</b> BLAS and LAPACK</a></li>
<li class="chapter" data-level="4.5.4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#customizing-compilation-of-the-nimble-generated-c"><i class="fa fa-check"></i><b>4.5.4</b> Customizing compilation of the NIMBLE-generated C++</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Models in NIMBLE</b></span></li>
<li class="chapter" data-level="5" data-path="cha-writing-models.html"><a href="cha-writing-models.html"><i class="fa fa-check"></i><b>5</b> Writing models in NIMBLE’s dialect of BUGS</a><ul>
<li class="chapter" data-level="5.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:supp-feat-bugs"><i class="fa fa-check"></i><b>5.1</b> Comparison to BUGS dialects supported by WinBUGS, OpenBUGS and JAGS</a><ul>
<li class="chapter" data-level="5.1.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#supported-features-of-bugs-and-jags"><i class="fa fa-check"></i><b>5.1.1</b> Supported features of BUGS and JAGS</a></li>
<li class="chapter" data-level="5.1.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:extensions-bugs"><i class="fa fa-check"></i><b>5.1.2</b> NIMBLE’s Extensions to BUGS and JAGS</a></li>
<li class="chapter" data-level="5.1.3" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:not-yet-supported"><i class="fa fa-check"></i><b>5.1.3</b> Not-yet-supported features of BUGS and JAGS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#writing-models"><i class="fa fa-check"></i><b>5.2</b> Writing models</a><ul>
<li class="chapter" data-level="5.2.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#declaring-stochastic-and-deterministic-nodes"><i class="fa fa-check"></i><b>5.2.1</b> Declaring stochastic and deterministic nodes</a></li>
<li class="chapter" data-level="5.2.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:more-kinds-bugs"><i class="fa fa-check"></i><b>5.2.2</b> More kinds of BUGS declarations</a></li>
<li class="chapter" data-level="5.2.3" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:vectorized-versus-scalar-declarations"><i class="fa fa-check"></i><b>5.2.3</b> Vectorized versus scalar declarations</a></li>
<li class="chapter" data-level="5.2.4" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:dists-and-functions"><i class="fa fa-check"></i><b>5.2.4</b> Available distributions</a></li>
<li class="chapter" data-level="5.2.5" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:BUGS-lang-fxns"><i class="fa fa-check"></i><b>5.2.5</b> Available BUGS language functions</a></li>
<li class="chapter" data-level="5.2.6" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:BUGS-link"><i class="fa fa-check"></i><b>5.2.6</b> Available link functions</a></li>
<li class="chapter" data-level="5.2.7" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:trunc"><i class="fa fa-check"></i><b>5.2.7</b> Truncation, censoring, and constraints</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cha-building-models.html"><a href="cha-building-models.html"><i class="fa fa-check"></i><b>6</b> Building and using models</a><ul>
<li class="chapter" data-level="6.1" data-path="cha-building-models.html"><a href="cha-building-models.html#creating-model-objects"><i class="fa fa-check"></i><b>6.1</b> Creating model objects</a><ul>
<li class="chapter" data-level="6.1.1" data-path="cha-building-models.html"><a href="cha-building-models.html#using-nimblemodel-to-create-a-model"><i class="fa fa-check"></i><b>6.1.1</b> Using <em>nimbleModel</em> to create a model</a></li>
<li class="chapter" data-level="6.1.2" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:readBUGSmodel"><i class="fa fa-check"></i><b>6.1.2</b> Creating a model from standard BUGS and JAGS input files</a></li>
<li class="chapter" data-level="6.1.3" data-path="cha-building-models.html"><a href="cha-building-models.html#sub:multiple-instances"><i class="fa fa-check"></i><b>6.1.3</b> Making multiple instances from the same model definition</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:nodes-and-variables"><i class="fa fa-check"></i><b>6.2</b> NIMBLE models are objects you can query and manipulate</a><ul>
<li class="chapter" data-level="6.2.1" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:what-are-nodes-and-variables"><i class="fa fa-check"></i><b>6.2.1</b> What are variables and nodes?</a></li>
<li class="chapter" data-level="6.2.2" data-path="cha-building-models.html"><a href="cha-building-models.html#determining-the-nodes-and-variables-in-a-model"><i class="fa fa-check"></i><b>6.2.2</b> Determining the nodes and variables in a model</a></li>
<li class="chapter" data-level="6.2.3" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:accessing-nodes"><i class="fa fa-check"></i><b>6.2.3</b> Accessing nodes</a></li>
<li class="chapter" data-level="6.2.4" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:how-nodes-are"><i class="fa fa-check"></i><b>6.2.4</b> How nodes are named</a></li>
<li class="chapter" data-level="6.2.5" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:why-use-node"><i class="fa fa-check"></i><b>6.2.5</b> Why use node names?</a></li>
<li class="chapter" data-level="6.2.6" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:cdisdata"><i class="fa fa-check"></i><b>6.2.6</b> Checking if a node holds data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="cha-building-models.html"><a href="cha-building-models.html#using-models-in-parallel"><i class="fa fa-check"></i><b>6.3</b> Using models in parallel</a></li>
</ul></li>
<li class="part"><span><b>III Algorithms in NIMBLE</b></span></li>
<li class="chapter" data-level="7" data-path="cha-mcmc.html"><a href="cha-mcmc.html"><i class="fa fa-check"></i><b>7</b> MCMC</a><ul>
<li class="chapter" data-level="7.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:nimbleMCMC"><i class="fa fa-check"></i><b>7.1</b> One-line invocation of MCMC: <em>nimbleMCMC</em></a></li>
<li class="chapter" data-level="7.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-configuration"><i class="fa fa-check"></i><b>7.2</b> The MCMC configuration</a><ul>
<li class="chapter" data-level="7.2.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:default-mcmc-conf"><i class="fa fa-check"></i><b>7.2.1</b> Default MCMC configuration</a></li>
<li class="chapter" data-level="7.2.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:customizing-mcmc-conf"><i class="fa fa-check"></i><b>7.2.2</b> Customizing the MCMC configuration</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:build-compile-mcmc"><i class="fa fa-check"></i><b>7.3</b> Building and compiling the MCMC</a></li>
<li class="chapter" data-level="7.4" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:runMCMC"><i class="fa fa-check"></i><b>7.4</b> User-friendly execution of MCMC algorithms: <em>runMCMC</em></a></li>
<li class="chapter" data-level="7.5" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:executing-the-mcmc-algorithm"><i class="fa fa-check"></i><b>7.5</b> Running the MCMC</a><ul>
<li class="chapter" data-level="7.5.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:sampler-time"><i class="fa fa-check"></i><b>7.5.1</b> Measuring sampler computation times: <em>getTimes</em></a></li>
<li class="chapter" data-level="7.5.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#assessing-the-adaption-process-of-rw-and-rw_block-samplers"><i class="fa fa-check"></i><b>7.5.2</b> Assessing the adaption process of <em>RW</em> and <em>RW_block</em> samplers</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:extracting-samples"><i class="fa fa-check"></i><b>7.6</b> Extracting MCMC samples</a></li>
<li class="chapter" data-level="7.7" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:WAIC"><i class="fa fa-check"></i><b>7.7</b> Calculating WAIC</a></li>
<li class="chapter" data-level="7.8" data-path="cha-mcmc.html"><a href="cha-mcmc.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>7.8</b> k-fold cross-validation</a></li>
<li class="chapter" data-level="7.9" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc"><i class="fa fa-check"></i><b>7.9</b> Variable selection using Reversible Jump MCMC</a><ul>
<li class="chapter" data-level="7.9.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc-indicator"><i class="fa fa-check"></i><b>7.9.1</b> Using indicator variables</a></li>
<li class="chapter" data-level="7.9.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc-no-indicator"><i class="fa fa-check"></i><b>7.9.2</b> Without indicator variables</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:samplers-provided"><i class="fa fa-check"></i><b>7.10</b> Samplers provided with NIMBLE</a><ul>
<li class="chapter" data-level="7.10.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#conjugate-gibbs-samplers"><i class="fa fa-check"></i><b>7.10.1</b> Conjugate (‘Gibbs’) samplers</a></li>
<li class="chapter" data-level="7.10.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#customized-log-likelihood-evaluations-rw_llfunction-sampler"><i class="fa fa-check"></i><b>7.10.2</b> Customized log-likelihood evaluations: <em>RW_llFunction sampler</em></a></li>
<li class="chapter" data-level="7.10.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#particle-mcmc-sampler"><i class="fa fa-check"></i><b>7.10.3</b> Particle MCMC sampler</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-example-litters"><i class="fa fa-check"></i><b>7.11</b> Detailed MCMC example: <em>litters</em></a></li>
<li class="chapter" data-level="7.12" data-path="cha-mcmc.html"><a href="cha-mcmc.html#mcmc-suite-compare-mcmcs"><i class="fa fa-check"></i><b>7.12</b> Comparing different MCMCs with <em>MCMCsuite</em> and <em>compareMCMCs</em></a></li>
<li class="chapter" data-level="7.13" data-path="cha-mcmc.html"><a href="cha-mcmc.html#running-mcmc-chains-in-parallel"><i class="fa fa-check"></i><b>7.13</b> Running MCMC chains in parallel</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html"><i class="fa fa-check"></i><b>8</b> Sequential Monte Carlo, Particle MCMC, Iterated Filtering, and MCEM</a><ul>
<li class="chapter" data-level="8.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#particle-filters-sequential-monte-carlo-and-iterated-filtering"><i class="fa fa-check"></i><b>8.1</b> Particle filters / sequential Monte Carlo and iterated filtering</a><ul>
<li class="chapter" data-level="8.1.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#filtering-algorithms"><i class="fa fa-check"></i><b>8.1.1</b> Filtering algorithms</a></li>
<li class="chapter" data-level="8.1.2" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#sec:particle-mcmc"><i class="fa fa-check"></i><b>8.1.2</b> Particle MCMC (PMCMC)</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#monte-carlo-expectation-maximization-mcem"><i class="fa fa-check"></i><b>8.2</b> Monte Carlo Expectation Maximization (MCEM)</a><ul>
<li class="chapter" data-level="8.2.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#sec:estimate-mcem-cov"><i class="fa fa-check"></i><b>8.2.1</b> Estimating the asymptotic covariance From MCEM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cha-spatial.html"><a href="cha-spatial.html"><i class="fa fa-check"></i><b>9</b> Spatial models</a><ul>
<li class="chapter" data-level="9.1" data-path="cha-spatial.html"><a href="cha-spatial.html#intrinsic-gaussian-car-model-dcar_normal"><i class="fa fa-check"></i><b>9.1</b> Intrinsic Gaussian CAR model: <em>dcar_normal</em></a><ul>
<li class="chapter" data-level="9.1.1" data-path="cha-spatial.html"><a href="cha-spatial.html#specification-and-density"><i class="fa fa-check"></i><b>9.1.1</b> Specification and density</a></li>
<li class="chapter" data-level="9.1.2" data-path="cha-spatial.html"><a href="cha-spatial.html#example"><i class="fa fa-check"></i><b>9.1.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cha-spatial.html"><a href="cha-spatial.html#proper-gaussian-car-model-dcar_proper"><i class="fa fa-check"></i><b>9.2</b> Proper Gaussian CAR model: <em>dcar_proper</em></a><ul>
<li class="chapter" data-level="9.2.1" data-path="cha-spatial.html"><a href="cha-spatial.html#specification-and-density-1"><i class="fa fa-check"></i><b>9.2.1</b> Specification and density</a></li>
<li class="chapter" data-level="9.2.2" data-path="cha-spatial.html"><a href="cha-spatial.html#example-1"><i class="fa fa-check"></i><b>9.2.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cha-spatial.html"><a href="cha-spatial.html#sec:spatial-mcmc-sampling-car"><i class="fa fa-check"></i><b>9.3</b> MCMC Sampling of CAR models</a><ul>
<li class="chapter" data-level="9.3.1" data-path="cha-spatial.html"><a href="cha-spatial.html#initial-values"><i class="fa fa-check"></i><b>9.3.1</b> Initial values</a></li>
<li class="chapter" data-level="9.3.2" data-path="cha-spatial.html"><a href="cha-spatial.html#zero-neighbor-regions"><i class="fa fa-check"></i><b>9.3.2</b> Zero-neighbor regions</a></li>
<li class="chapter" data-level="9.3.3" data-path="cha-spatial.html"><a href="cha-spatial.html#zero-mean-constraint"><i class="fa fa-check"></i><b>9.3.3</b> Zero-mean constraint</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cha-bnp.html"><a href="cha-bnp.html"><i class="fa fa-check"></i><b>10</b> Bayesian nonparametric models</a><ul>
<li class="chapter" data-level="10.1" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:bnpmixtures"><i class="fa fa-check"></i><b>10.1</b> Bayesian nonparametric mixture models</a></li>
<li class="chapter" data-level="10.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:crp"><i class="fa fa-check"></i><b>10.2</b> Chinese Restaurant Process model</a><ul>
<li class="chapter" data-level="10.2.1" data-path="cha-bnp.html"><a href="cha-bnp.html#specification-and-density-2"><i class="fa fa-check"></i><b>10.2.1</b> Specification and density</a></li>
<li class="chapter" data-level="10.2.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:excrp"><i class="fa fa-check"></i><b>10.2.2</b> Example</a></li>
<li class="chapter" data-level="10.2.3" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:extensionscrp"><i class="fa fa-check"></i><b>10.2.3</b> Extensions</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:sb"><i class="fa fa-check"></i><b>10.3</b> Stick-breaking model</a><ul>
<li class="chapter" data-level="10.3.1" data-path="cha-bnp.html"><a href="cha-bnp.html#specification-and-function"><i class="fa fa-check"></i><b>10.3.1</b> Specification and function</a></li>
<li class="chapter" data-level="10.3.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:exsb"><i class="fa fa-check"></i><b>10.3.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="cha-bnp.html"><a href="cha-bnp.html#mcmc-sampling-of-bnp-models"><i class="fa fa-check"></i><b>10.4</b> MCMC sampling of BNP models</a><ul>
<li class="chapter" data-level="10.4.1" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:mcmcdcrp"><i class="fa fa-check"></i><b>10.4.1</b> Sampling CRP models</a></li>
<li class="chapter" data-level="10.4.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:mcmcsb"><i class="fa fa-check"></i><b>10.4.2</b> Sampling stick-breaking models</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Programming with NIMBLE</b></span></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="11" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html"><i class="fa fa-check"></i><b>11</b> Writing simple nimbleFunctions</a><ul>
<li class="chapter" data-level="11.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:RC-intro"><i class="fa fa-check"></i><b>11.1</b> Introduction to simple nimbleFunctions</a></li>
<li class="chapter" data-level="11.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:r-fiunctions-implemented"><i class="fa fa-check"></i><b>11.2</b> R functions (or variants) implemented in NIMBLE</a><ul>
<li class="chapter" data-level="11.2.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#finding-help-for-nimbles-versions-of-r-functions"><i class="fa fa-check"></i><b>11.2.1</b> Finding help for NIMBLE’s versions of R functions</a></li>
<li class="chapter" data-level="11.2.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#basic-operations"><i class="fa fa-check"></i><b>11.2.2</b> Basic operations</a></li>
<li class="chapter" data-level="11.2.3" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:basic-math-linear"><i class="fa fa-check"></i><b>11.2.3</b> Math and linear algebra</a></li>
<li class="chapter" data-level="11.2.4" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:nimble-dist-funs"><i class="fa fa-check"></i><b>11.2.4</b> Distribution functions</a></li>
<li class="chapter" data-level="11.2.5" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:basic-flow-control"><i class="fa fa-check"></i><b>11.2.5</b> Flow control: <em>if-then-else</em>, <em>for</em>, <em>while</em>, and <em>stop</em></a></li>
<li class="chapter" data-level="11.2.6" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:print"><i class="fa fa-check"></i><b>11.2.6</b> <em>print</em> and <em>cat</em></a></li>
<li class="chapter" data-level="11.2.7" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:check-user-interr"><i class="fa fa-check"></i><b>11.2.7</b> Checking for user interrupts: <em>checkInterrupt</em></a></li>
<li class="chapter" data-level="11.2.8" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#optimization-optim-and-nimoptim"><i class="fa fa-check"></i><b>11.2.8</b> Optimization: <em>optim</em> and <em>nimOptim</em></a></li>
<li class="chapter" data-level="11.2.9" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:altern-keyw-some"><i class="fa fa-check"></i><b>11.2.9</b> ‘nim’ synonyms for some functions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:how-nimble-handles"><i class="fa fa-check"></i><b>11.3</b> How NIMBLE handles types of variables</a><ul>
<li class="chapter" data-level="11.3.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:nimbleList-RCFuns"><i class="fa fa-check"></i><b>11.3.1</b> nimbleList data structures</a></li>
<li class="chapter" data-level="11.3.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:how-types-work"><i class="fa fa-check"></i><b>11.3.2</b> How numeric types work</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:decl-argum-return"><i class="fa fa-check"></i><b>11.4</b> Declaring argument and return types</a></li>
<li class="chapter" data-level="11.5" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:comp-nimbl-pass"><i class="fa fa-check"></i><b>11.5</b> Compiled nimbleFunctions pass arguments by reference</a></li>
<li class="chapter" data-level="11.6" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:calling-external-code"><i class="fa fa-check"></i><b>11.6</b> Calling external compiled code</a></li>
<li class="chapter" data-level="11.7" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:calling-R-code"><i class="fa fa-check"></i><b>11.7</b> Calling uncompiled R functions from compiled nimbleFunctions</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="cha-user-defined.html"><a href="cha-user-defined.html"><i class="fa fa-check"></i><b>12</b> Creating user-defined BUGS distributions and functions</a><ul>
<li class="chapter" data-level="12.1" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:user-functions"><i class="fa fa-check"></i><b>12.1</b> User-defined functions</a></li>
<li class="chapter" data-level="12.2" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:user-distributions"><i class="fa fa-check"></i><b>12.2</b> User-defined distributions</a><ul>
<li class="chapter" data-level="12.2.1" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:registerDistributions"><i class="fa fa-check"></i><b>12.2.1</b> Using <em>registerDistributions</em> for alternative parameterizations and providing other information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cha-using-models.html"><a href="cha-using-models.html"><i class="fa fa-check"></i><b>13</b> Working with NIMBLE models</a><ul>
<li class="chapter" data-level="13.1" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:accessing-variables"><i class="fa fa-check"></i><b>13.1</b> The variables and nodes in a NIMBLE model</a><ul>
<li class="chapter" data-level="13.1.1" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:get-nodes"><i class="fa fa-check"></i><b>13.1.1</b> Determining the nodes in a model</a></li>
<li class="chapter" data-level="13.1.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:introduced-nodes"><i class="fa fa-check"></i><b>13.1.2</b> Understanding lifted nodes</a></li>
<li class="chapter" data-level="13.1.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdgetdependencies"><i class="fa fa-check"></i><b>13.1.3</b> Determining dependencies in a model</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:nodeInfo"><i class="fa fa-check"></i><b>13.2</b> Accessing information about nodes and variables</a><ul>
<li class="chapter" data-level="13.2.1" data-path="cha-using-models.html"><a href="cha-using-models.html#getting-distributional-information-about-a-node"><i class="fa fa-check"></i><b>13.2.1</b> Getting distributional information about a node</a></li>
<li class="chapter" data-level="13.2.2" data-path="cha-using-models.html"><a href="cha-using-models.html#getting-information-about-a-distribution"><i class="fa fa-check"></i><b>13.2.2</b> Getting information about a distribution</a></li>
<li class="chapter" data-level="13.2.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:getParam"><i class="fa fa-check"></i><b>13.2.3</b> Getting distribution parameter values for a node</a></li>
<li class="chapter" data-level="13.2.4" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:getBound"><i class="fa fa-check"></i><b>13.2.4</b> Getting distribution bounds for a node</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdcalc-cdsim-cdgetl"><i class="fa fa-check"></i><b>13.3</b> Carrying out model calculations</a><ul>
<li class="chapter" data-level="13.3.1" data-path="cha-using-models.html"><a href="cha-using-models.html#core-model-operations-calculation-and-simulation"><i class="fa fa-check"></i><b>13.3.1</b> Core model operations: calculation and simulation</a></li>
<li class="chapter" data-level="13.3.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdsimn-cdcalcn-cdget"><i class="fa fa-check"></i><b>13.3.2</b> Pre-defined nimbleFunctions for operating on model nodes: <em>simNodes</em>, <em>calcNodes</em>, and <em>getLogProbNodes</em></a></li>
<li class="chapter" data-level="13.3.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:access-log-prob"><i class="fa fa-check"></i><b>13.3.3</b> Accessing log probabilities via <em>logProb</em> variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="cha-data-structures.html"><a href="cha-data-structures.html"><i class="fa fa-check"></i><b>14</b> Data structures in NIMBLE</a><ul>
<li class="chapter" data-level="14.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:modelValues-struct"><i class="fa fa-check"></i><b>14.1</b> The modelValues data structure</a><ul>
<li class="chapter" data-level="14.1.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#creating-modelvalues-objects"><i class="fa fa-check"></i><b>14.1.1</b> Creating modelValues objects</a></li>
<li class="chapter" data-level="14.1.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:access-cont-modelv"><i class="fa fa-check"></i><b>14.1.2</b> Accessing contents of modelValues</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:nimbleLists"><i class="fa fa-check"></i><b>14.2</b> The nimbleList data structure</a><ul>
<li class="chapter" data-level="14.2.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:eigen-nimFunctions"><i class="fa fa-check"></i><b>14.2.1</b> Using <em>eigen</em> and <em>svd</em> in nimbleFunctions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html"><i class="fa fa-check"></i><b>15</b> Writing nimbleFunctions to interact with models</a><ul>
<li class="chapter" data-level="15.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:writ-nimble-funct"><i class="fa fa-check"></i><b>15.1</b> Overview</a></li>
<li class="chapter" data-level="15.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-comp-nimbl"><i class="fa fa-check"></i><b>15.2</b> Using and compiling nimbleFunctions</a></li>
<li class="chapter" data-level="15.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#writing-setup-code"><i class="fa fa-check"></i><b>15.3</b> Writing setup code</a><ul>
<li class="chapter" data-level="15.3.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#useful-tools-for-setup-functions"><i class="fa fa-check"></i><b>15.3.1</b> Useful tools for setup functions</a></li>
<li class="chapter" data-level="15.3.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:access-modify-numer"><i class="fa fa-check"></i><b>15.3.2</b> Accessing and modifying numeric values from setup</a></li>
<li class="chapter" data-level="15.3.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#determining-numeric-types-in-nimblefunctions"><i class="fa fa-check"></i><b>15.3.3</b> Determining numeric types in nimbleFunctions</a></li>
<li class="chapter" data-level="15.3.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:determ-pers-texttts"><i class="fa fa-check"></i><b>15.3.4</b> Control of setup outputs</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:nimble-lang-comp"><i class="fa fa-check"></i><b>15.4</b> Writing run code</a><ul>
<li class="chapter" data-level="15.4.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:driv-models:-calc"><i class="fa fa-check"></i><b>15.4.1</b> Driving models: <em>calculate</em>, <em>calculateDiff</em>, <em>simulate</em>, <em>getLogProb</em></a></li>
<li class="chapter" data-level="15.4.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#getting-and-setting-variable-and-node-values"><i class="fa fa-check"></i><b>15.4.2</b> Getting and setting variable and node values</a></li>
<li class="chapter" data-level="15.4.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#getting-parameter-values-and-node-bounds"><i class="fa fa-check"></i><b>15.4.3</b> Getting parameter values and node bounds</a></li>
<li class="chapter" data-level="15.4.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:access-model-modelv"><i class="fa fa-check"></i><b>15.4.4</b> Using modelValues objects</a></li>
<li class="chapter" data-level="15.4.5" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-model-variable"><i class="fa fa-check"></i><b>15.4.5</b> Using model variables and modelValues in expressions</a></li>
<li class="chapter" data-level="15.4.6" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:incl-other-meth"><i class="fa fa-check"></i><b>15.4.6</b> Including other methods in a nimbleFunction</a></li>
<li class="chapter" data-level="15.4.7" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-other-nimbl"><i class="fa fa-check"></i><b>15.4.7</b> Using other nimbleFunctions</a></li>
<li class="chapter" data-level="15.4.8" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:virt-nimbl-nimbl"><i class="fa fa-check"></i><b>15.4.8</b> Virtual nimbleFunctions and nimbleFunctionLists</a></li>
<li class="chapter" data-level="15.4.9" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#character-objects"><i class="fa fa-check"></i><b>15.4.9</b> Character objects</a></li>
<li class="chapter" data-level="15.4.10" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:user-defined-data"><i class="fa fa-check"></i><b>15.4.10</b> User-defined data structures</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:user-samplers"><i class="fa fa-check"></i><b>15.5</b> Example: writing user-defined samplers to extend NIMBLE’s MCMC engine</a></li>
<li class="chapter" data-level="15.6" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#copying-nimblefunctions-and-nimble-models"><i class="fa fa-check"></i><b>15.6</b> Copying nimbleFunctions (and NIMBLE models)</a></li>
<li class="chapter" data-level="15.7" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:debugging"><i class="fa fa-check"></i><b>15.7</b> Debugging nimbleFunctions</a></li>
<li class="chapter" data-level="15.8" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#timing-nimblefunctions-with-run.time"><i class="fa fa-check"></i><b>15.8</b> Timing nimbleFunctions with <em>run.time</em></a></li>
<li class="chapter" data-level="15.9" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#clearing-and-unloading-compiled-objects"><i class="fa fa-check"></i><b>15.9</b> Clearing and unloading compiled objects</a></li>
<li class="chapter" data-level="15.10" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#reducing-memory-usage"><i class="fa fa-check"></i><b>15.10</b> Reducing memory usage</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>16</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cha:using-models" class="section level1">
<h1><span class="header-section-number">Chapter 13</span> Working with NIMBLE models</h1>
<p>Here we describe how one can get information about NIMBLE models and carry out operations on a model. While all of this functionality can be used from R, its primary use occurs when writing nimbleFunctions (see Chapter <a href="cha-progr-with-models.html#cha:progr-with-models">15</a>). Information about node types, distributions, and dimensions can be used to determine algorithm behavior in <em>setup</em> code of nimbleFunctions. Information about node or variable values or the parameter and bound values of a node would generally be used for algorithm calculations in <em>run</em> code of nimbleFunctions. Similarly, carrying out numerical operations on a model, including setting node or variable values, would generally be done in run code.</p>
<div id="sec:accessing-variables" class="section level2">
<h2><span class="header-section-number">13.1</span> The variables and nodes in a NIMBLE model</h2>
<p>Section <a href="cha-building-models.html#sec:nodes-and-variables">6.2</a> defines what we mean by variables and nodes in a NIMBLE model and discusses how to determine and access the nodes in a model and their dependency relationships. Here we’ll review and go into more detail on the topics of determining the nodes and node dependencies in a model.</p>
<div id="sec:get-nodes" class="section level3">
<h3><span class="header-section-number">13.1.1</span> Determining the nodes in a model</h3>
<p>One can determine the variables in a model using <code>getVarNames</code> and the nodes in a model using <code>getNodeNames</code>, with optional arguments allowing you to select only certain types of nodes. We illustrate here with the pump model from Chapter <a href="cha-lightning-intro.html#cha:lightning-intro">2</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getVarNames</span>()</code></pre></div>
<pre><code>## [1] &quot;lifted_d1_over_beta&quot; &quot;theta&quot;               &quot;lambda&quot;             
## [4] &quot;x&quot;                   &quot;alpha&quot;               &quot;beta&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getNodeNames</span>()</code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;               &quot;beta&quot;                &quot;lifted_d1_over_beta&quot;
##  [4] &quot;theta[1]&quot;            &quot;theta[2]&quot;            &quot;theta[3]&quot;           
##  [7] &quot;theta[4]&quot;            &quot;theta[5]&quot;            &quot;theta[6]&quot;           
## [10] &quot;theta[7]&quot;            &quot;theta[8]&quot;            &quot;theta[9]&quot;           
## [13] &quot;theta[10]&quot;           &quot;lambda[1]&quot;           &quot;lambda[2]&quot;          
## [16] &quot;lambda[3]&quot;           &quot;lambda[4]&quot;           &quot;lambda[5]&quot;          
## [19] &quot;lambda[6]&quot;           &quot;lambda[7]&quot;           &quot;lambda[8]&quot;          
## [22] &quot;lambda[9]&quot;           &quot;lambda[10]&quot;          &quot;x[1]&quot;               
## [25] &quot;x[2]&quot;                &quot;x[3]&quot;                &quot;x[4]&quot;               
## [28] &quot;x[5]&quot;                &quot;x[6]&quot;                &quot;x[7]&quot;               
## [31] &quot;x[8]&quot;                &quot;x[9]&quot;                &quot;x[10]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getNodeNames</span>(<span class="dt">determOnly =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;lifted_d1_over_beta&quot; &quot;lambda[1]&quot;           &quot;lambda[2]&quot;          
##  [4] &quot;lambda[3]&quot;           &quot;lambda[4]&quot;           &quot;lambda[5]&quot;          
##  [7] &quot;lambda[6]&quot;           &quot;lambda[7]&quot;           &quot;lambda[8]&quot;          
## [10] &quot;lambda[9]&quot;           &quot;lambda[10]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getNodeNames</span>(<span class="dt">stochOnly =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;     &quot;beta&quot;      &quot;theta[1]&quot;  &quot;theta[2]&quot;  &quot;theta[3]&quot; 
##  [6] &quot;theta[4]&quot;  &quot;theta[5]&quot;  &quot;theta[6]&quot;  &quot;theta[7]&quot;  &quot;theta[8]&quot; 
## [11] &quot;theta[9]&quot;  &quot;theta[10]&quot; &quot;x[1]&quot;      &quot;x[2]&quot;      &quot;x[3]&quot;     
## [16] &quot;x[4]&quot;      &quot;x[5]&quot;      &quot;x[6]&quot;      &quot;x[7]&quot;      &quot;x[8]&quot;     
## [21] &quot;x[9]&quot;      &quot;x[10]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getNodeNames</span>(<span class="dt">dataOnly =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;x[1]&quot;  &quot;x[2]&quot;  &quot;x[3]&quot;  &quot;x[4]&quot;  &quot;x[5]&quot;  &quot;x[6]&quot;  &quot;x[7]&quot;  &quot;x[8]&quot; 
##  [9] &quot;x[9]&quot;  &quot;x[10]&quot;</code></pre>
<p>You can see one lifted node (see next section), <code>lifted_d1_over_beta</code>, involved in a reparameterization to NIMBLE’s canonical parameterization of the gamma distribution for the <code>theta</code> nodes.</p>
<p>We can determine the set of nodes contained in one or more nodes or variables using <code>expandNodeNames</code>, illustrated here for an example with multivariate nodes. The <code>returnScalarComponents</code> argument also allows us to return all of the scalar elements of multivariate nodes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multiVarCode2 &lt;-<span class="st"> </span><span class="kw">nimbleCode</span>({
    X[<span class="dv">1</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] <span class="op">~</span><span class="st"> </span><span class="kw">dmnorm</span>(mu[], cov[,])
    X[<span class="dv">6</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">3</span>] <span class="op">~</span><span class="st"> </span><span class="kw">dmnorm</span>(mu[], cov[,])
    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) 
        Y[i] <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(mn, <span class="dv">1</span>)
})

multiVarModel2 &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(multiVarCode2,
                              <span class="dt">dimensions =</span> <span class="kw">list</span>(<span class="dt">mu =</span> <span class="dv">5</span>, <span class="dt">cov =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>)),
                             <span class="dt">calculate =</span> <span class="ot">FALSE</span>)


multiVarModel2<span class="op">$</span><span class="kw">expandNodeNames</span>(<span class="st">&quot;Y&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;Y[1]&quot; &quot;Y[2]&quot; &quot;Y[3]&quot; &quot;Y[4]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multiVarModel2<span class="op">$</span><span class="kw">expandNodeNames</span>(<span class="kw">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>), <span class="dt">returnScalarComponents =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;X[1, 1]&quot;  &quot;X[1, 2]&quot;  &quot;X[1, 3]&quot;  &quot;X[6, 3]&quot;  &quot;X[7, 3]&quot;  &quot;X[8, 3]&quot; 
##  [7] &quot;X[9, 3]&quot;  &quot;X[10, 3]&quot; &quot;X[1, 4]&quot;  &quot;X[1, 5]&quot;  &quot;Y[1]&quot;     &quot;Y[2]&quot;    
## [13] &quot;Y[3]&quot;     &quot;Y[4]&quot;</code></pre>
<p>As discussed in Section <a href="cha-building-models.html#sec:cdisdata">6.2.6</a>, you can determine whether a node is flagged as data using <code>isData</code>.</p>
</div>
<div id="sec:introduced-nodes" class="section level3">
<h3><span class="header-section-number">13.1.2</span> Understanding lifted nodes</h3>
<p>In some cases, NIMBLE introduces new nodes into the model that were not specified in the BUGS code for the model, such as the <code>lifted_d1_over_beta</code> node in the introductory example. For this reason, it is important that programs written to adapt to different model structures use NIMBLE’s systems for querying the model graph. For example, a call to <code>pump$getDependencies(&quot;beta&quot;)</code> will correctly include <code>lifted_d1_over_beta</code> in the results. If one skips this step and assumes the nodes are only those that appear in the BUGS code, one may not get correct results.</p>
<p>It can be helpful to know the situations in which lifted nodes are generated. These include:</p>
<ol style="list-style-type: decimal">
<li>When distribution parameters are expressions, NIMBLE creates a new deterministic node that contains the expression for a given parameter. The node is then a direct descendant of the new deterministic node. This is an optional feature, but it is currently enabled in all cases.</li>
<li>As discussed in Section <a href="cha-writing-models.html#subsec:BUGS-link">5.2.6</a>, the use of link functions causes new nodes to be introduced. This requires care if you need to initialize values in stochastic declarations with link functions.</li>
<li>Use of alternative parameterizations of distributions, described in Section <a href="cha-writing-models.html#subsec:dists-and-functions">5.2.4</a> causes new nodes to be introduced. For example when a user provides the precision of a normal distribution as <code>tau</code>, NIMBLE creates a new node <code>sd &lt;- 1/sqrt(tau)</code> and uses <code>sd</code> as a parameter in the normal distribution. If many nodes use the same <code>tau</code>, only one new <code>sd</code> node will be created, so the computation <code>1/sqrt(tau)</code> will not be repeated redundantly.</li>
</ol>
</div>
<div id="sec:cdgetdependencies" class="section level3">
<h3><span class="header-section-number">13.1.3</span> Determining dependencies in a model</h3>
<p>Next we’ll see how to determine the node dependencies (or ‘descendants’) in a model. There are a variety of arguments to <code>getDependencies</code> that allow one to specify whether to include the node itself, whether to include deterministic or stochastic or data dependents, etc. By default <code>getDependencies</code> returns descendants up to the next stochastic node on all edges emanating from the node(s) specified as input. This is what would be needed to calculate a Metropolis-Hastings acceptance probability in MCMC, for example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getDependencies</span>(<span class="st">&quot;alpha&quot;</span>)</code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;     &quot;theta[1]&quot;  &quot;theta[2]&quot;  &quot;theta[3]&quot;  &quot;theta[4]&quot; 
##  [6] &quot;theta[5]&quot;  &quot;theta[6]&quot;  &quot;theta[7]&quot;  &quot;theta[8]&quot;  &quot;theta[9]&quot; 
## [11] &quot;theta[10]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getDependencies</span>(<span class="kw">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>))</code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;               &quot;beta&quot;                &quot;lifted_d1_over_beta&quot;
##  [4] &quot;theta[1]&quot;            &quot;theta[2]&quot;            &quot;theta[3]&quot;           
##  [7] &quot;theta[4]&quot;            &quot;theta[5]&quot;            &quot;theta[6]&quot;           
## [10] &quot;theta[7]&quot;            &quot;theta[8]&quot;            &quot;theta[9]&quot;           
## [13] &quot;theta[10]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getDependencies</span>(<span class="st">&quot;theta[1:3]&quot;</span>, <span class="dt">self =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## [1] &quot;lambda[1]&quot; &quot;lambda[2]&quot; &quot;lambda[3]&quot; &quot;x[1]&quot;      &quot;x[2]&quot;      &quot;x[3]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getDependencies</span>(<span class="st">&quot;theta[1:3]&quot;</span>, <span class="dt">stochOnly =</span> <span class="ot">TRUE</span>, <span class="dt">self =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## [1] &quot;x[1]&quot; &quot;x[2]&quot; &quot;x[3]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get all dependencies, not just the direct descendants</span>
pump<span class="op">$</span><span class="kw">getDependencies</span>(<span class="st">&quot;alpha&quot;</span>, <span class="dt">downstream =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;      &quot;theta[1]&quot;   &quot;theta[2]&quot;   &quot;theta[3]&quot;   &quot;theta[4]&quot;  
##  [6] &quot;theta[5]&quot;   &quot;theta[6]&quot;   &quot;theta[7]&quot;   &quot;theta[8]&quot;   &quot;theta[9]&quot;  
## [11] &quot;theta[10]&quot;  &quot;lambda[1]&quot;  &quot;lambda[2]&quot;  &quot;lambda[3]&quot;  &quot;lambda[4]&quot; 
## [16] &quot;lambda[5]&quot;  &quot;lambda[6]&quot;  &quot;lambda[7]&quot;  &quot;lambda[8]&quot;  &quot;lambda[9]&quot; 
## [21] &quot;lambda[10]&quot; &quot;x[1]&quot;       &quot;x[2]&quot;       &quot;x[3]&quot;       &quot;x[4]&quot;      
## [26] &quot;x[5]&quot;       &quot;x[6]&quot;       &quot;x[7]&quot;       &quot;x[8]&quot;       &quot;x[9]&quot;      
## [31] &quot;x[10]&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pump<span class="op">$</span><span class="kw">getDependencies</span>(<span class="st">&quot;alpha&quot;</span>, <span class="dt">downstream =</span> <span class="ot">TRUE</span>, <span class="dt">dataOnly =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##  [1] &quot;x[1]&quot;  &quot;x[2]&quot;  &quot;x[3]&quot;  &quot;x[4]&quot;  &quot;x[5]&quot;  &quot;x[6]&quot;  &quot;x[7]&quot;  &quot;x[8]&quot; 
##  [9] &quot;x[9]&quot;  &quot;x[10]&quot;</code></pre>
</div>
</div>
<div id="sec:nodeInfo" class="section level2">
<h2><span class="header-section-number">13.2</span> Accessing information about nodes and variables</h2>
<div id="getting-distributional-information-about-a-node" class="section level3">
<h3><span class="header-section-number">13.2.1</span> Getting distributional information about a node</h3>
<p>We briefly demonstrate some of the functionality for information about a node here, but refer readers to the R help on <code>modelBaseClass</code> for full details.</p>
<p>Here is an example model, with use of various functions to determine information about nodes or variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">code &lt;-<span class="st"> </span><span class="kw">nimbleCode</span>({
    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>) 
        y[i] <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(mu, <span class="dt">sd =</span> sigma)
    mu <span class="op">~</span><span class="st"> </span><span class="kw">T</span>(<span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dv">-20</span>, <span class="dv">20</span>)
    sigma <span class="op">~</span><span class="st"> </span><span class="kw">dunif</span>(<span class="dv">0</span>, <span class="dv">10</span>)
    })
m &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(code, <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">4</span>)),
                           <span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">mu =</span> <span class="dv">0</span>, <span class="dt">sigma =</span> <span class="dv">1</span>))
m<span class="op">$</span><span class="kw">isEndNode</span>(<span class="st">&#39;y&#39;</span>)</code></pre></div>
<pre><code>## y[1] y[2] y[3] y[4] 
## TRUE TRUE TRUE TRUE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m<span class="op">$</span><span class="kw">getDistribution</span>(<span class="st">&#39;sigma&#39;</span>)</code></pre></div>
<pre><code>##   sigma 
## &quot;dunif&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m<span class="op">$</span><span class="kw">isDiscrete</span>(<span class="kw">c</span>(<span class="st">&#39;y&#39;</span>, <span class="st">&#39;mu&#39;</span>, <span class="st">&#39;sigma&#39;</span>))</code></pre></div>
<pre><code>##  y[1]  y[2]  y[3]  y[4]    mu sigma 
## FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m<span class="op">$</span><span class="kw">isDeterm</span>(<span class="st">&#39;mu&#39;</span>)</code></pre></div>
<pre><code>##    mu 
## FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m<span class="op">$</span><span class="kw">getDimension</span>(<span class="st">&#39;mu&#39;</span>)</code></pre></div>
<pre><code>## value 
##     0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">m<span class="op">$</span><span class="kw">getDimension</span>(<span class="st">&#39;mu&#39;</span>, <span class="dt">includeParams =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## value  mean    sd   tau   var 
##     0     0     0     0     0</code></pre>
<p>Note that any variables provided to these functions are expanded into their constituent node names, so the length of results may not be the same length as the input vector of node and variable names. However the order of the results should be preserved relative to the order of the inputs, once the expansion is accounted for.</p>
</div>
<div id="getting-information-about-a-distribution" class="section level3">
<h3><span class="header-section-number">13.2.2</span> Getting information about a distribution</h3>
<p>One can also get generic information about a distribution based on the name of the distribution using the function <code>getDistributionInfo</code>. In particular, one can determine whether a distribution was provided by the user (<code>isUserDefined</code>), whether a distribution provides CDF and quantile functions (<code>pqDefined</code>), whether a distribution is a discrete distribution (<code>isDiscrete</code>), the parameter names (include alternative parameterizations) for a distribution (<code>getParamNames</code>), and the dimension of the distribution and its parameters (<code>getDimension</code>). For more extensive information, please see the R help for <code>getDistributionInfo</code>.</p>
</div>
<div id="sec:getParam" class="section level3">
<h3><span class="header-section-number">13.2.3</span> Getting distribution parameter values for a node</h3>
<p>The function <code>getParam</code> provides access to values of the parameters of a node’s distribution. <code>getParam</code> can be used as global function taking a model as the first argument, or it can be used as a model member function. The next two arguments must be the name of one (stochastic) node and the name of a parameter for the distribution followed by that node. The parameter does not have to be one of the parameters used when the node was declared. Alternative parameterization values can also be obtained. See Section <a href="cha-writing-models.html#subsec:distributions">5.2.4.1</a> for available parameterizations. (These can also be seen in <code>nimble:::distributionsInputList</code>.)</p>
<p>Here is an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gammaModel &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(
    <span class="kw">nimbleCode</span>({
        a <span class="op">~</span><span class="st"> </span><span class="kw">dlnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>)
        x <span class="op">~</span><span class="st"> </span><span class="kw">dgamma</span>(<span class="dt">shape =</span> <span class="dv">2</span>, <span class="dt">scale =</span> a)
    }), <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="fl">2.4</span>), <span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">1.2</span>))
<span class="kw">getParam</span>(gammaModel, <span class="st">&#39;x&#39;</span>, <span class="st">&#39;scale&#39;</span>)</code></pre></div>
<pre><code>## [1] 1.2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getParam</span>(gammaModel, <span class="st">&#39;x&#39;</span>, <span class="st">&#39;rate&#39;</span>)</code></pre></div>
<pre><code>## [1] 0.8333333</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">gammaModel<span class="op">$</span><span class="kw">getParam</span>(<span class="st">&#39;x&#39;</span>,<span class="st">&#39;rate&#39;</span>)</code></pre></div>
<pre><code>## [1] 0.8333333</code></pre>
<p><code>getParam</code> is part of the NIMBLE language, so it can be used in run code of nimbleFunctions.</p>
</div>
<div id="sec:getBound" class="section level3">
<h3><span class="header-section-number">13.2.4</span> Getting distribution bounds for a node</h3>
<p>The function <code>getBound</code> provides access to the lower and upper bounds of the distribution for a node. In most cases these bounds will be fixed based on the distribution, but for the uniform distribution the bounds are the parameters of the distribution, and when truncation is used (Section <a href="cha-writing-models.html#subsec:trunc">5.2.7</a>), the bounds will be determined by the truncation. Like the functions described in the previous section, <code>getBound</code> can be used as global function taking a model as the first argument, or it can be used as a model member function. The next two arguments must be the name of one (stochastic) node and either <code>&quot;lower&quot;</code> or <code>&quot;upper&quot;</code> indicating whether the lower or upper bound is desired. For multivariate nodes the bound is a scalar that is the bound for all elements of the node, as we do not handle truncation for multivariate nodes.</p>
<p>Here is an example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exampleModel &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(
    <span class="kw">nimbleCode</span>({
        y <span class="op">~</span><span class="st"> </span><span class="kw">T</span>(<span class="kw">dnorm</span>(mu, <span class="dt">sd =</span> sig), a, <span class="ot">Inf</span>)
        a <span class="op">~</span><span class="st"> </span><span class="kw">dunif</span>(<span class="op">-</span><span class="dv">1</span>, b)
        b <span class="op">~</span><span class="st"> </span><span class="kw">dgamma</span>(<span class="dv">1</span>, <span class="dv">1</span>)
    }), <span class="dt">inits =</span> <span class="kw">list</span>(<span class="dt">a =</span> <span class="fl">-0.5</span>, <span class="dt">mu =</span> <span class="dv">1</span>, <span class="dt">sig =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">4</span>),
        <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> <span class="dv">4</span>))
<span class="kw">getBound</span>(exampleModel, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;lower&#39;</span>)</code></pre></div>
<pre><code>## [1] -0.5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getBound</span>(exampleModel, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;upper&#39;</span>)</code></pre></div>
<pre><code>## [1] Inf</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exampleModel<span class="op">$</span>b &lt;-<span class="st"> </span><span class="dv">3</span>
exampleModel<span class="op">$</span><span class="kw">calculate</span>(exampleModel<span class="op">$</span><span class="kw">getDependencies</span>(<span class="st">&#39;b&#39;</span>))</code></pre></div>
<pre><code>## [1] -4.386294</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getBound</span>(exampleModel, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;upper&#39;</span>)</code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exampleModel<span class="op">$</span><span class="kw">getBound</span>(<span class="st">&#39;b&#39;</span>,<span class="st">&#39;lower&#39;</span>)</code></pre></div>
<pre><code>## [1] 0</code></pre>
<p><code>getBound</code> is part of the NIMBLE language, so it can be used in run code of nimbleFunctions. In fact, we anticipate that most use of <code>getBound</code> will be for algorithms, such as for the reflection version of the random walk MCMC sampler.</p>
</div>
</div>
<div id="sec:cdcalc-cdsim-cdgetl" class="section level2">
<h2><span class="header-section-number">13.3</span> Carrying out model calculations</h2>
<div id="core-model-operations-calculation-and-simulation" class="section level3">
<h3><span class="header-section-number">13.3.1</span> Core model operations: calculation and simulation</h3>
<p>The four basic ways to operate a model are to calculate nodes, simulate into nodes, get the log probabilities (or probability densities) that have already been calculated, and compare the log probability of a new value to that of an old value. In more detail:</p>
<ul>
<li><strong>calculate</strong> For a stochastic node, <code>calculate</code> determines the log probability value, stores it in the appropriate <code>logProb</code> variable, and returns it. For a deterministic node, <code>calculate</code> executes the deterministic calculation and returns 0.</li>
<li><strong>simulate</strong> For a stochastic node, <code>simulate</code> generates a random draw. For deterministic nodes, <code>simulate</code> is equivalent to <code>calculate</code> without returning 0. <code>simulate</code> always returns <code>NULL</code> (or <code>void</code> in C++).</li>
<li><strong>getLogProb</strong> <code>getLogProb</code> simply returns the most recently calculated log probability value, or 0 for a deterministic node.</li>
<li><strong>calculateDiff</strong> <code>calculateDiff</code> is identical to <code>calculate</code>, but it returns the new log probability value minus the one that was previously stored. This is useful when one wants to change the value or values of node(s) in the model (e.g., by setting a value or <code>simulate</code>) and then determine the change in the log probability, such as needed for a Metropolis-Hastings acceptance probability.</li>
</ul>
<p>Each of these functions is accessed as a member function of a model object, taking a vector of node names as an argument<a href="#fn25" class="footnoteRef" id="fnref25"><sup>25</sup></a>. If there is more than one node name, <code>calculate</code> and <code>getLogProb</code> return the sum of the log probabilities from each node, while <code>calculateDiff</code> returns the sum of the new values minus the old values. Next we show an example using <code>simulate</code>.</p>
<div id="sec:arbitr-coll-nodes" class="section level4">
<h4><span class="header-section-number">13.3.1.1</span> Example: simulating arbitrary collections of nodes</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mc &lt;-<span class="st"> </span><span class="kw">nimbleCode</span>({
    a <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.001</span>)
    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>) {
        y[i] <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(a, <span class="fl">0.1</span>)
        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)
            z[i,j] <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(y[i], <span class="dt">sd =</span> <span class="fl">0.1</span>)
    }
    y.squared[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>] &lt;-<span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]<span class="op">^</span><span class="dv">2</span>
})

model &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(mc, <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">z =</span> <span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">15</span>), <span class="dt">nrow =</span> <span class="dv">5</span>)))

model<span class="op">$</span>a &lt;-<span class="st"> </span><span class="dv">1</span>
model<span class="op">$</span>y</code></pre></div>
<pre><code>## [1] NA NA NA NA NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span><span class="kw">simulate</span>(<span class="st">&quot;y[1:3]&quot;</span>)
<span class="co"># simulate(model, &quot;y[1:3]&quot;)</span>
model<span class="op">$</span>y</code></pre></div>
<pre><code>## [1] -4.3723097  1.7331821  0.6234022         NA         NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span><span class="kw">simulate</span>(<span class="st">&quot;y&quot;</span>)
model<span class="op">$</span>y</code></pre></div>
<pre><code>## [1]  6.6051146  2.0859962 -0.9702564 -0.3898915 -0.5978887</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span>z</code></pre></div>
<pre><code>##            [,1]       [,2]        [,3]
## [1,] -1.0314207 -0.9537793 -0.79453166
## [2,] -2.3710229 -0.3980044 -0.30881797
## [3,] -0.3245763 -0.3112171  0.36144477
## [4,] -0.9442988  0.7960927  1.39879110
## [5,] -0.7658900  0.9864283 -0.05607042</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span><span class="kw">simulate</span>(<span class="kw">c</span>(<span class="st">&quot;y[1:3]&quot;</span>, <span class="st">&quot;z[1:5, 1:3]&quot;</span>))
model<span class="op">$</span>y</code></pre></div>
<pre><code>## [1]  1.5882948  1.5578821  3.8961663 -0.3898915 -0.5978887</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span>z</code></pre></div>
<pre><code>##            [,1]       [,2]        [,3]
## [1,] -1.0314207 -0.9537793 -0.79453166
## [2,] -2.3710229 -0.3980044 -0.30881797
## [3,] -0.3245763 -0.3112171  0.36144477
## [4,] -0.9442988  0.7960927  1.39879110
## [5,] -0.7658900  0.9864283 -0.05607042</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span><span class="kw">simulate</span>(<span class="kw">c</span>(<span class="st">&quot;z[1:5, 1:3]&quot;</span>), <span class="dt">includeData =</span> <span class="ot">TRUE</span>)
model<span class="op">$</span>z</code></pre></div>
<pre><code>##            [,1]       [,2]       [,3]
## [1,]  1.6203124  1.5516260  1.4942336
## [2,]  1.6213524  1.5516332  1.5761658
## [3,]  4.0065304  4.0713699  3.8007847
## [4,] -0.2254835 -0.4765649 -0.3632563
## [5,] -0.5756517 -0.6255796 -0.4584634</code></pre>
<p>The example illustrates a number of features:</p>
<ol style="list-style-type: decimal">
<li><code>simulate(model, nodes)</code> is equivalent to <code>model$simulate(nodes)</code>. You can use either, but the latter is encouraged and the former may be deprecated inthe future.</li>
<li>Inputs like <code>&quot;y[1:3]&quot;</code> are automatically expanded into <code>c(&quot;y[1]&quot;, &quot;y[2]&quot;, &quot;y[3]&quot;)</code>. In fact, simply <code>&quot;y&quot;</code> will be expanded into all nodes within <code>y</code>.</li>
<li>An arbitrary number of nodes can be provided as a character vector.</li>
<li>Simulations will be done in the order provided, so in practice the nodes should often be obtained by functions such as <code>getDependencies</code>. These return nodes in topologically-sorted order, which means no node is manipulated before something it depends on.</li>
<li>The data nodes <code>z</code> were not simulated into until <code>includeData = TRUE</code> was used.</li>
</ol>
<p>Use of <code>calculate</code>, <code>calculateDiff</code> and <code>getLogProb</code> are similar to <code>simulate</code>, except that they return a value (described above) and they have no <code>includeData</code> argument.</p>
</div>
</div>
<div id="sec:cdsimn-cdcalcn-cdget" class="section level3">
<h3><span class="header-section-number">13.3.2</span> Pre-defined nimbleFunctions for operating on model nodes: <em>simNodes</em>, <em>calcNodes</em>, and <em>getLogProbNodes</em></h3>
<!---  Chris would still like to revisit this -- clarify when a user might use these and where to put this text. Main question is that if these are intended as building blocks, their only use is seemingly in R. If you use in run code, you might as well just put calculate()/simulate()/etc. directly in the run code since it will call the compiled nodeFunctions anyway. -->
<p><code>simNodes</code>, <code>calcNodes</code> and <code>getLogProbNodes</code> are basic nimbleFunctions that simulate, calculate, or get the log probabilities (densities), respectively, of the same set of nodes each time they are called. Each of these takes a model and a character string of node names as inputs. If <code>nodes</code> is left blank, then all the nodes of the model are used.</p>
<p>For <code>simNodes</code>, the nodes provided will be topologically sorted to simulate in the correct order. For <code>calcNodes</code> and <code>getLogProbNodes</code>, the nodes will be sorted and dependent nodes will be included. Recall that the calculations must be up to date (from a <code>calculate</code> call) for <code>getLogProbNodes</code> to return the values you are probably looking for.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">simpleModelCode &lt;-<span class="st"> </span><span class="kw">nimbleCode</span>({
  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>){
    x[i] <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>)
    y[i] <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(x[i], <span class="dv">1</span>) <span class="co"># y depends on x</span>
    z[i] <span class="op">~</span><span class="st"> </span><span class="kw">dnorm</span>(y[i], <span class="dv">1</span>) <span class="co"># z depends on y</span>
    <span class="co"># z conditionally independent of x</span>
  }
})

simpleModel &lt;-<span class="st"> </span><span class="kw">nimbleModel</span>(simpleModelCode, <span class="dt">check =</span> <span class="ot">FALSE</span>)
cSimpleModel &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(simpleModel)

<span class="co"># simulates all the x&#39;s and y&#39;s</span>
rSimXY &lt;-<span class="st"> </span><span class="kw">simNodes</span>(simpleModel, <span class="dt">nodes =</span> <span class="kw">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>) ) 

<span class="co"># calls calculate on x and its dependents (y, but not z)</span>
rCalcXDep &lt;-<span class="st"> </span><span class="kw">calcNodes</span>(simpleModel, <span class="dt">nodes =</span> <span class="st">&#39;x&#39;</span>)

<span class="co"># calls getLogProb on x&#39;s and y&#39;s</span>
rGetLogProbXDep &lt;-<span class="st"> </span><span class="kw">getLogProbNodes</span>(simpleModel,
                  <span class="dt">nodes =</span> <span class="st">&#39;x&#39;</span>)

<span class="co"># compiling the functions</span>
cSimXY &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(rSimXY, <span class="dt">project =</span> simpleModel)
cCalcXDep &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(rCalcXDep, <span class="dt">project =</span> simpleModel)
cGetLogProbXDep &lt;-<span class="st"> </span><span class="kw">compileNimble</span>(rGetLogProbXDep, <span class="dt">project =</span> simpleModel)

cSimpleModel<span class="op">$</span>x</code></pre></div>
<pre><code>## [1] NA NA NA NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cSimpleModel<span class="op">$</span>y</code></pre></div>
<pre><code>## [1] NA NA NA NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># simulating x and y</span>
cSimXY<span class="op">$</span><span class="kw">run</span>()</code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cSimpleModel<span class="op">$</span>x</code></pre></div>
<pre><code>## [1] -0.6589120  0.6605313 -0.0132557 -0.9314803</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cSimpleModel<span class="op">$</span>y</code></pre></div>
<pre><code>## [1]  0.5557771 -1.4278091 -0.5394082 -2.4728829</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cCalcXDep<span class="op">$</span><span class="kw">run</span>()</code></pre></div>
<pre><code>## [1] -12.46535</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># gives correct answer because logProbs</span>
<span class="co"># updated by &#39;calculate&#39; after simulation</span>
cGetLogProbXDep<span class="op">$</span><span class="kw">run</span>()</code></pre></div>
<pre><code>## [1] -12.46535</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cSimXY<span class="op">$</span><span class="kw">run</span>()</code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># gives old answer because logProbs</span>
<span class="co"># not updated after &#39;simulate&#39;</span>
cGetLogProbXDep<span class="op">$</span><span class="kw">run</span>()</code></pre></div>
<pre><code>## [1] -12.46535</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cCalcXDep<span class="op">$</span><span class="kw">run</span>()</code></pre></div>
<pre><code>## [1] -9.277808</code></pre>
</div>
<div id="sec:access-log-prob" class="section level3">
<h3><span class="header-section-number">13.3.3</span> Accessing log probabilities via <em>logProb</em> variables</h3>
<!---  at some point we might remove this as logProb variables might be viewed as private member data, but as PdV points out, these are genuinely useful to a user because they can be added as monitors separately from the associated variable -->
<p>For each variable that contains at least one stochastic node, NIMBLE generates a model variable with the prefix ‘logProb_’. In general users will not need to access these logProb variables directly but rather will use <code>getLogProb</code>. However, knowing they exist can be useful, in part because these variables can be monitored in an MCMC.</p>
<p>When the stochastic node is scalar, the <code>logProb</code> variable will have the same size. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span>logProb_y</code></pre></div>
<pre><code>## [1] NA NA NA NA NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span><span class="kw">calculate</span>(<span class="st">&quot;y&quot;</span>)</code></pre></div>
<pre><code>## [1] -11.02766</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model<span class="op">$</span>logProb_y</code></pre></div>
<pre><code>## [1] -2.087536 -2.085793 -2.489620 -2.166821 -2.197894</code></pre>
<p>Creation of <code>logProb</code> variables for stochastic multivariate nodes is trickier, because they can represent an arbitrary block of a larger variable. In general NIMBLE records the logProb values using the lowest possible indices. For example, if <code>x[5:10, 15:20]</code> follows a Wishart distribution, its log probability (density) value will be stored in <code>logProb_x[5, 15]</code>. When possible, NIMBLE will reduce the dimensions of the corresponding logProb variable. For example, in</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) x[i,] <span class="op">~</span><span class="st"> </span><span class="kw">dmnorm</span>(mu[], prec[,])</code></pre></div>
<p><code>x</code> may be <span class="math inline">\(10 \times 20\)</span> (dimensions must be provided), but <code>logProb_x</code> will be <span class="math inline">\(10 \times 1\)</span>. For the most part you do not need to worry about how NIMBLE is storing the log probability values, because you can always get them using <code>getLogProb</code>.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="25">
<li id="fn25"><p>Standard usage is <code>model$calculate(nodes)</code> but <code>calculate(model, nodes)</code> is synonymous.<a href="cha-using-models.html#fnref25">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cha-user-defined.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cha-data-structures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["NimbleUserManual.pdf", "NimbleUserManual.epub"],
"toc": {
"collapse": "subsection"
},
"toc_depth": 3
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
