<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 Working with NIMBLE models | NimbleUserManual.knit</title>
  <meta name="description" content="This is the NIMBLE User Manual." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 Working with NIMBLE models | NimbleUserManual.knit" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/nimble-icon.png" />
  <meta property="og:description" content="This is the NIMBLE User Manual." />
  <meta name="github-repo" content="nimble-dev/nimble" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 Working with NIMBLE models | NimbleUserManual.knit" />
  
  <meta name="twitter:description" content="This is the NIMBLE User Manual." />
  <meta name="twitter:image" content="/nimble-icon.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cha-user-defined.html"/>
<link rel="next" href="cha-data-structures.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<img src="./nimble-icon.png"
     width=100>
<li><a href="./cha-welcome-nimble.html">NIMBLE User Manual, Version 1.0.1</a></li>
<li><a href="https://github.com/nimble-dev/nimble">NIMBLE Development Team</a></li>
<li><a href="https://R-nimble.org">https://R-nimble.org</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html"><i class="fa fa-check"></i><b>1</b> Welcome to NIMBLE</a>
<ul>
<li class="chapter" data-level="1.1" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html#sec:what-is-nimble"><i class="fa fa-check"></i><b>1.1</b> What does NIMBLE do?</a></li>
<li class="chapter" data-level="1.2" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html#how-to-use-this-manual"><i class="fa fa-check"></i><b>1.2</b> How to use this manual</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html"><i class="fa fa-check"></i><b>2</b> Lightning introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:brief-example"><i class="fa fa-check"></i><b>2.1</b> A brief example</a></li>
<li class="chapter" data-level="2.2" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-model"><i class="fa fa-check"></i><b>2.2</b> Creating a model</a></li>
<li class="chapter" data-level="2.3" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:compiling-model"><i class="fa fa-check"></i><b>2.3</b> Compiling the model</a></li>
<li class="chapter" data-level="2.4" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:intro-runMCMC"><i class="fa fa-check"></i><b>2.4</b> One-line invocation of MCMC</a></li>
<li class="chapter" data-level="2.5" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-mcmc"><i class="fa fa-check"></i><b>2.5</b> Creating, compiling and running a basic MCMC configuration</a></li>
<li class="chapter" data-level="2.6" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:customizing-mcmc"><i class="fa fa-check"></i><b>2.6</b> Customizing the MCMC</a></li>
<li class="chapter" data-level="2.7" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:running-mcem"><i class="fa fa-check"></i><b>2.7</b> Running MCEM</a></li>
<li class="chapter" data-level="2.8" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-your-own"><i class="fa fa-check"></i><b>2.8</b> Creating your own functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html"><i class="fa fa-check"></i><b>3</b> More introduction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#nimble-adopts-and-extends-the-bugs-language-for-specifying-models"><i class="fa fa-check"></i><b>3.1</b> NIMBLE adopts and extends the BUGS language for specifying models</a></li>
<li class="chapter" data-level="3.2" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#sec:nimble-lang-writ"><i class="fa fa-check"></i><b>3.2</b> nimbleFunctions for writing algorithms</a></li>
<li class="chapter" data-level="3.3" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#sec:nimble-algor-libr"><i class="fa fa-check"></i><b>3.3</b> The NIMBLE algorithm library</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html"><i class="fa fa-check"></i><b>4</b> Installing NIMBLE</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:requ-run-nimble"><i class="fa fa-check"></i><b>4.1</b> Requirements to run NIMBLE</a></li>
<li class="chapter" data-level="4.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:compiler"><i class="fa fa-check"></i><b>4.2</b> Installing a C++ compiler for NIMBLE to use</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#macos"><i class="fa fa-check"></i><b>4.2.1</b> MacOS</a></li>
<li class="chapter" data-level="4.2.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#linux"><i class="fa fa-check"></i><b>4.2.2</b> Linux</a></li>
<li class="chapter" data-level="4.2.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#windows"><i class="fa fa-check"></i><b>4.2.3</b> Windows</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#installing-the-nimble-package"><i class="fa fa-check"></i><b>4.3</b> Installing the NIMBLE package</a></li>
<li class="chapter" data-level="4.4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#troubleshooting-installation-problems"><i class="fa fa-check"></i><b>4.4</b> Troubleshooting installation problems</a></li>
<li class="chapter" data-level="4.5" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#customizing-your-installation"><i class="fa fa-check"></i><b>4.5</b> Customizing your installation</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#using-your-own-copy-of-eigen"><i class="fa fa-check"></i><b>4.5.1</b> Using your own copy of Eigen</a></li>
<li class="chapter" data-level="4.5.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#using-libnimble"><i class="fa fa-check"></i><b>4.5.2</b> Using libnimble</a></li>
<li class="chapter" data-level="4.5.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:blas"><i class="fa fa-check"></i><b>4.5.3</b> BLAS and LAPACK</a></li>
<li class="chapter" data-level="4.5.4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#customizing-compilation-of-the-nimble-generated-c"><i class="fa fa-check"></i><b>4.5.4</b> Customizing compilation of the NIMBLE-generated C++</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Models in NIMBLE</b></span></li>
<li class="chapter" data-level="5" data-path="cha-writing-models.html"><a href="cha-writing-models.html"><i class="fa fa-check"></i><b>5</b> Writing models in NIMBLE’s dialect of BUGS</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:supp-feat-bugs"><i class="fa fa-check"></i><b>5.1</b> Comparison to BUGS dialects supported by WinBUGS, OpenBUGS and JAGS</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#supported-features-of-bugs-and-jags"><i class="fa fa-check"></i><b>5.1.1</b> Supported features of BUGS and JAGS</a></li>
<li class="chapter" data-level="5.1.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:extensions-bugs"><i class="fa fa-check"></i><b>5.1.2</b> NIMBLE’s Extensions to BUGS and JAGS</a></li>
<li class="chapter" data-level="5.1.3" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:not-yet-supported"><i class="fa fa-check"></i><b>5.1.3</b> Not-supported features of BUGS and JAGS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#writing-models"><i class="fa fa-check"></i><b>5.2</b> Writing models</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#declaring-stochastic-and-deterministic-nodes"><i class="fa fa-check"></i><b>5.2.1</b> Declaring stochastic and deterministic nodes</a></li>
<li class="chapter" data-level="5.2.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:more-kinds-bugs"><i class="fa fa-check"></i><b>5.2.2</b> More kinds of BUGS declarations</a></li>
<li class="chapter" data-level="5.2.3" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:vectorized-versus-scalar-declarations"><i class="fa fa-check"></i><b>5.2.3</b> Vectorized versus scalar declarations</a></li>
<li class="chapter" data-level="5.2.4" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:dists-and-functions"><i class="fa fa-check"></i><b>5.2.4</b> Available distributions</a></li>
<li class="chapter" data-level="5.2.5" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:BUGS-lang-fxns"><i class="fa fa-check"></i><b>5.2.5</b> Available BUGS language functions</a></li>
<li class="chapter" data-level="5.2.6" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:BUGS-link"><i class="fa fa-check"></i><b>5.2.6</b> Available link functions</a></li>
<li class="chapter" data-level="5.2.7" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:trunc"><i class="fa fa-check"></i><b>5.2.7</b> Truncation, censoring, and constraints</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cha-building-models.html"><a href="cha-building-models.html"><i class="fa fa-check"></i><b>6</b> Building and using models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cha-building-models.html"><a href="cha-building-models.html#creating-model-objects"><i class="fa fa-check"></i><b>6.1</b> Creating model objects</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cha-building-models.html"><a href="cha-building-models.html#using-nimblemodel-to-create-a-model"><i class="fa fa-check"></i><b>6.1.1</b> Using <em>nimbleModel</em> to create a model</a></li>
<li class="chapter" data-level="6.1.2" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:readBUGSmodel"><i class="fa fa-check"></i><b>6.1.2</b> Creating a model from standard BUGS and JAGS input files</a></li>
<li class="chapter" data-level="6.1.3" data-path="cha-building-models.html"><a href="cha-building-models.html#sub:multiple-instances"><i class="fa fa-check"></i><b>6.1.3</b> Making multiple instances from the same model definition</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:nodes-and-variables"><i class="fa fa-check"></i><b>6.2</b> NIMBLE models are objects you can query and manipulate</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:what-are-nodes-and-variables"><i class="fa fa-check"></i><b>6.2.1</b> What are variables and nodes?</a></li>
<li class="chapter" data-level="6.2.2" data-path="cha-building-models.html"><a href="cha-building-models.html#determining-the-nodes-and-variables-in-a-model"><i class="fa fa-check"></i><b>6.2.2</b> Determining the nodes and variables in a model</a></li>
<li class="chapter" data-level="6.2.3" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:accessing-nodes"><i class="fa fa-check"></i><b>6.2.3</b> Accessing nodes</a></li>
<li class="chapter" data-level="6.2.4" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:how-nodes-are"><i class="fa fa-check"></i><b>6.2.4</b> How nodes are named</a></li>
<li class="chapter" data-level="6.2.5" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:why-use-node"><i class="fa fa-check"></i><b>6.2.5</b> Why use node names?</a></li>
<li class="chapter" data-level="6.2.6" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:cdisdata"><i class="fa fa-check"></i><b>6.2.6</b> Checking if a node holds data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="cha-building-models.html"><a href="cha-building-models.html#using-models-in-parallel"><i class="fa fa-check"></i><b>6.3</b> Using models in parallel</a></li>
</ul></li>
<li class="part"><span><b>III Algorithms in NIMBLE</b></span></li>
<li class="chapter" data-level="7" data-path="cha-mcmc.html"><a href="cha-mcmc.html"><i class="fa fa-check"></i><b>7</b> MCMC</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:nimbleMCMC"><i class="fa fa-check"></i><b>7.1</b> One-line invocation of MCMC: <em>nimbleMCMC</em></a></li>
<li class="chapter" data-level="7.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-configuration"><i class="fa fa-check"></i><b>7.2</b> The MCMC configuration</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:default-mcmc-conf"><i class="fa fa-check"></i><b>7.2.1</b> Default MCMC configuration</a></li>
<li class="chapter" data-level="7.2.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:customizing-mcmc-conf"><i class="fa fa-check"></i><b>7.2.2</b> Customizing the MCMC configuration</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:build-compile-mcmc"><i class="fa fa-check"></i><b>7.3</b> Building and compiling the MCMC</a></li>
<li class="chapter" data-level="7.4" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:initMCMC"><i class="fa fa-check"></i><b>7.4</b> Initializing MCMC</a></li>
<li class="chapter" data-level="7.5" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:runMCMC"><i class="fa fa-check"></i><b>7.5</b> User-friendly execution of MCMC algorithms: <em>runMCMC</em></a></li>
<li class="chapter" data-level="7.6" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:executing-the-mcmc-algorithm"><i class="fa fa-check"></i><b>7.6</b> Running the MCMC</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-rerun"><i class="fa fa-check"></i><b>7.6.1</b> Rerunning versus restarting an MCMC</a></li>
<li class="chapter" data-level="7.6.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:sampler-time"><i class="fa fa-check"></i><b>7.6.2</b> Measuring sampler computation times: <em>getTimes</em></a></li>
<li class="chapter" data-level="7.6.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#assessing-the-adaption-process-of-rw-and-rw_block-samplers"><i class="fa fa-check"></i><b>7.6.3</b> Assessing the adaption process of <em>RW</em> and <em>RW_block</em> samplers</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:extracting-samples"><i class="fa fa-check"></i><b>7.7</b> Extracting MCMC samples</a></li>
<li class="chapter" data-level="7.8" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:WAIC"><i class="fa fa-check"></i><b>7.8</b> Calculating WAIC</a></li>
<li class="chapter" data-level="7.9" data-path="cha-mcmc.html"><a href="cha-mcmc.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>7.9</b> k-fold cross-validation</a></li>
<li class="chapter" data-level="7.10" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc"><i class="fa fa-check"></i><b>7.10</b> Variable selection using Reversible Jump MCMC</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc-indicator"><i class="fa fa-check"></i><b>7.10.1</b> Using indicator variables</a></li>
<li class="chapter" data-level="7.10.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc-no-indicator"><i class="fa fa-check"></i><b>7.10.2</b> Without indicator variables</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:samplers-provided"><i class="fa fa-check"></i><b>7.11</b> Samplers provided with NIMBLE</a>
<ul>
<li class="chapter" data-level="7.11.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#conjugate-gibbs-samplers"><i class="fa fa-check"></i><b>7.11.1</b> Conjugate (‘Gibbs’) samplers</a></li>
<li class="chapter" data-level="7.11.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#subsec:HMC"><i class="fa fa-check"></i><b>7.11.2</b> Hamiltonian Monte Carlo (HMC)</a></li>
<li class="chapter" data-level="7.11.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#customized-log-likelihood-evaluations-rw_llfunction-sampler"><i class="fa fa-check"></i><b>7.11.3</b> Customized log-likelihood evaluations: <em>RW_llFunction sampler</em></a></li>
<li class="chapter" data-level="7.11.4" data-path="cha-mcmc.html"><a href="cha-mcmc.html#particle-mcmc-sampler"><i class="fa fa-check"></i><b>7.11.4</b> Particle MCMC sampler</a></li>
</ul></li>
<li class="chapter" data-level="7.12" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-example-litters"><i class="fa fa-check"></i><b>7.12</b> Detailed MCMC example: <em>litters</em></a></li>
<li class="chapter" data-level="7.13" data-path="cha-mcmc.html"><a href="cha-mcmc.html#mcmc-suite-compare-mcmcs"><i class="fa fa-check"></i><b>7.13</b> Comparing different MCMCs with <em>MCMCsuite</em> and <em>compareMCMCs</em></a></li>
<li class="chapter" data-level="7.14" data-path="cha-mcmc.html"><a href="cha-mcmc.html#running-mcmc-chains-in-parallel"><i class="fa fa-check"></i><b>7.14</b> Running MCMC chains in parallel</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html"><i class="fa fa-check"></i><b>8</b> Sequential Monte Carlo, Particle MCMC, Iterated Filtering, and MCEM</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#particle-filters-sequential-monte-carlo-and-iterated-filtering"><i class="fa fa-check"></i><b>8.1</b> Particle filters / sequential Monte Carlo and iterated filtering</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#filtering-algorithms"><i class="fa fa-check"></i><b>8.1.1</b> Filtering algorithms</a></li>
<li class="chapter" data-level="8.1.2" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#sec:particle-mcmc"><i class="fa fa-check"></i><b>8.1.2</b> Particle MCMC (PMCMC)</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#monte-carlo-expectation-maximization-mcem"><i class="fa fa-check"></i><b>8.2</b> Monte Carlo Expectation Maximization (MCEM)</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#sec:estimate-mcem-cov"><i class="fa fa-check"></i><b>8.2.1</b> Estimating the asymptotic covariance From MCEM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cha-spatial.html"><a href="cha-spatial.html"><i class="fa fa-check"></i><b>9</b> Spatial models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cha-spatial.html"><a href="cha-spatial.html#intrinsic-gaussian-car-model-dcar_normal"><i class="fa fa-check"></i><b>9.1</b> Intrinsic Gaussian CAR model: <em>dcar_normal</em></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cha-spatial.html"><a href="cha-spatial.html#specification-and-density"><i class="fa fa-check"></i><b>9.1.1</b> Specification and density</a></li>
<li class="chapter" data-level="9.1.2" data-path="cha-spatial.html"><a href="cha-spatial.html#example"><i class="fa fa-check"></i><b>9.1.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cha-spatial.html"><a href="cha-spatial.html#proper-gaussian-car-model-dcar_proper"><i class="fa fa-check"></i><b>9.2</b> Proper Gaussian CAR model: <em>dcar_proper</em></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cha-spatial.html"><a href="cha-spatial.html#specification-and-density-1"><i class="fa fa-check"></i><b>9.2.1</b> Specification and density</a></li>
<li class="chapter" data-level="9.2.2" data-path="cha-spatial.html"><a href="cha-spatial.html#example-1"><i class="fa fa-check"></i><b>9.2.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cha-spatial.html"><a href="cha-spatial.html#sec:spatial-mcmc-sampling-car"><i class="fa fa-check"></i><b>9.3</b> MCMC Sampling of CAR models</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cha-spatial.html"><a href="cha-spatial.html#initial-values"><i class="fa fa-check"></i><b>9.3.1</b> Initial values</a></li>
<li class="chapter" data-level="9.3.2" data-path="cha-spatial.html"><a href="cha-spatial.html#zero-neighbor-regions"><i class="fa fa-check"></i><b>9.3.2</b> Zero-neighbor regions</a></li>
<li class="chapter" data-level="9.3.3" data-path="cha-spatial.html"><a href="cha-spatial.html#zero-mean-constraint"><i class="fa fa-check"></i><b>9.3.3</b> Zero-mean constraint</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cha-bnp.html"><a href="cha-bnp.html"><i class="fa fa-check"></i><b>10</b> Bayesian nonparametric models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:bnpmixtures"><i class="fa fa-check"></i><b>10.1</b> Bayesian nonparametric mixture models</a></li>
<li class="chapter" data-level="10.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:crp"><i class="fa fa-check"></i><b>10.2</b> Chinese Restaurant Process model</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="cha-bnp.html"><a href="cha-bnp.html#specification-and-density-2"><i class="fa fa-check"></i><b>10.2.1</b> Specification and density</a></li>
<li class="chapter" data-level="10.2.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:excrp"><i class="fa fa-check"></i><b>10.2.2</b> Example</a></li>
<li class="chapter" data-level="10.2.3" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:extensionscrp"><i class="fa fa-check"></i><b>10.2.3</b> Extensions</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:sb"><i class="fa fa-check"></i><b>10.3</b> Stick-breaking model</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="cha-bnp.html"><a href="cha-bnp.html#specification-and-function"><i class="fa fa-check"></i><b>10.3.1</b> Specification and function</a></li>
<li class="chapter" data-level="10.3.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:exsb"><i class="fa fa-check"></i><b>10.3.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="cha-bnp.html"><a href="cha-bnp.html#mcmc-sampling-of-bnp-models"><i class="fa fa-check"></i><b>10.4</b> MCMC sampling of BNP models</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:mcmcdcrp"><i class="fa fa-check"></i><b>10.4.1</b> Sampling CRP models</a></li>
<li class="chapter" data-level="10.4.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:mcmcsb"><i class="fa fa-check"></i><b>10.4.2</b> Sampling stick-breaking models</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Programming with NIMBLE</b></span></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="11" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html"><i class="fa fa-check"></i><b>11</b> Writing simple nimbleFunctions</a>
<ul>
<li class="chapter" data-level="11.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:RC-intro"><i class="fa fa-check"></i><b>11.1</b> Introduction to simple nimbleFunctions</a></li>
<li class="chapter" data-level="11.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:r-fiunctions-implemented"><i class="fa fa-check"></i><b>11.2</b> R functions (or variants) implemented in NIMBLE</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#finding-help-for-nimbles-versions-of-r-functions"><i class="fa fa-check"></i><b>11.2.1</b> Finding help for NIMBLE’s versions of R functions</a></li>
<li class="chapter" data-level="11.2.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#basic-operations"><i class="fa fa-check"></i><b>11.2.2</b> Basic operations</a></li>
<li class="chapter" data-level="11.2.3" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:basic-math-linear"><i class="fa fa-check"></i><b>11.2.3</b> Math and linear algebra</a></li>
<li class="chapter" data-level="11.2.4" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:nimble-dist-funs"><i class="fa fa-check"></i><b>11.2.4</b> Distribution functions</a></li>
<li class="chapter" data-level="11.2.5" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:basic-flow-control"><i class="fa fa-check"></i><b>11.2.5</b> Flow control: <em>if-then-else</em>, <em>for</em>, <em>while</em>, and <em>stop</em></a></li>
<li class="chapter" data-level="11.2.6" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:print"><i class="fa fa-check"></i><b>11.2.6</b> <em>print</em> and <em>cat</em></a></li>
<li class="chapter" data-level="11.2.7" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:check-user-interr"><i class="fa fa-check"></i><b>11.2.7</b> Checking for user interrupts: <em>checkInterrupt</em></a></li>
<li class="chapter" data-level="11.2.8" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#optimization-optim-and-nimoptim"><i class="fa fa-check"></i><b>11.2.8</b> Optimization: <em>optim</em> and <em>nimOptim</em></a></li>
<li class="chapter" data-level="11.2.9" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:altern-keyw-some"><i class="fa fa-check"></i><b>11.2.9</b> ‘nim’ synonyms for some functions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:how-nimble-handles"><i class="fa fa-check"></i><b>11.3</b> How NIMBLE handles types of variables</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:nimbleList-RCFuns"><i class="fa fa-check"></i><b>11.3.1</b> nimbleList data structures</a></li>
<li class="chapter" data-level="11.3.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:how-types-work"><i class="fa fa-check"></i><b>11.3.2</b> How numeric types work</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:decl-argum-return"><i class="fa fa-check"></i><b>11.4</b> Declaring argument and return types</a></li>
<li class="chapter" data-level="11.5" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:comp-nimbl-pass"><i class="fa fa-check"></i><b>11.5</b> Compiled nimbleFunctions pass arguments by reference</a></li>
<li class="chapter" data-level="11.6" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:calling-external-code"><i class="fa fa-check"></i><b>11.6</b> Calling external compiled code</a></li>
<li class="chapter" data-level="11.7" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:calling-R-code"><i class="fa fa-check"></i><b>11.7</b> Calling uncompiled R functions from compiled nimbleFunctions</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="cha-user-defined.html"><a href="cha-user-defined.html"><i class="fa fa-check"></i><b>12</b> Creating user-defined BUGS distributions and functions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:user-functions"><i class="fa fa-check"></i><b>12.1</b> User-defined functions</a></li>
<li class="chapter" data-level="12.2" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:user-distributions"><i class="fa fa-check"></i><b>12.2</b> User-defined distributions</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:registerDistributions"><i class="fa fa-check"></i><b>12.2.1</b> Using <em>registerDistributions</em> for alternative parameterizations and providing other information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cha-using-models.html"><a href="cha-using-models.html"><i class="fa fa-check"></i><b>13</b> Working with NIMBLE models</a>
<ul>
<li class="chapter" data-level="13.1" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:accessing-variables"><i class="fa fa-check"></i><b>13.1</b> The variables and nodes in a NIMBLE model</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:get-nodes"><i class="fa fa-check"></i><b>13.1.1</b> Determining the nodes in a model</a></li>
<li class="chapter" data-level="13.1.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:introduced-nodes"><i class="fa fa-check"></i><b>13.1.2</b> Understanding lifted nodes</a></li>
<li class="chapter" data-level="13.1.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdgetdependencies"><i class="fa fa-check"></i><b>13.1.3</b> Determining dependencies in a model</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:nodeInfo"><i class="fa fa-check"></i><b>13.2</b> Accessing information about nodes and variables</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="cha-using-models.html"><a href="cha-using-models.html#getting-distributional-information-about-a-node"><i class="fa fa-check"></i><b>13.2.1</b> Getting distributional information about a node</a></li>
<li class="chapter" data-level="13.2.2" data-path="cha-using-models.html"><a href="cha-using-models.html#getting-information-about-a-distribution"><i class="fa fa-check"></i><b>13.2.2</b> Getting information about a distribution</a></li>
<li class="chapter" data-level="13.2.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:getParam"><i class="fa fa-check"></i><b>13.2.3</b> Getting distribution parameter values for a node</a></li>
<li class="chapter" data-level="13.2.4" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:getBound"><i class="fa fa-check"></i><b>13.2.4</b> Getting distribution bounds for a node</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdcalc-cdsim-cdgetl"><i class="fa fa-check"></i><b>13.3</b> Carrying out model calculations</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="cha-using-models.html"><a href="cha-using-models.html#core-model-operations-calculation-and-simulation"><i class="fa fa-check"></i><b>13.3.1</b> Core model operations: calculation and simulation</a></li>
<li class="chapter" data-level="13.3.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdsimn-cdcalcn-cdget"><i class="fa fa-check"></i><b>13.3.2</b> Pre-defined nimbleFunctions for operating on model nodes: <em>simNodes</em>, <em>calcNodes</em>, and <em>getLogProbNodes</em></a></li>
<li class="chapter" data-level="13.3.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:access-log-prob"><i class="fa fa-check"></i><b>13.3.3</b> Accessing log probabilities via <em>logProb</em> variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="cha-data-structures.html"><a href="cha-data-structures.html"><i class="fa fa-check"></i><b>14</b> Data structures in NIMBLE</a>
<ul>
<li class="chapter" data-level="14.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:modelValues-struct"><i class="fa fa-check"></i><b>14.1</b> The modelValues data structure</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#creating-modelvalues-objects"><i class="fa fa-check"></i><b>14.1.1</b> Creating modelValues objects</a></li>
<li class="chapter" data-level="14.1.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:access-cont-modelv"><i class="fa fa-check"></i><b>14.1.2</b> Accessing contents of modelValues</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:nimbleLists"><i class="fa fa-check"></i><b>14.2</b> The nimbleList data structure</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:predef-nimbleLists"><i class="fa fa-check"></i><b>14.2.1</b> Pre-defined nimbleList types</a></li>
<li class="chapter" data-level="14.2.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:eigen-nimFunctions"><i class="fa fa-check"></i><b>14.2.2</b> Using <em>eigen</em> and <em>svd</em> in nimbleFunctions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html"><i class="fa fa-check"></i><b>15</b> Writing nimbleFunctions to interact with models</a>
<ul>
<li class="chapter" data-level="15.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:writ-nimble-funct"><i class="fa fa-check"></i><b>15.1</b> Overview</a></li>
<li class="chapter" data-level="15.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-comp-nimbl"><i class="fa fa-check"></i><b>15.2</b> Using and compiling nimbleFunctions</a></li>
<li class="chapter" data-level="15.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#writing-setup-code"><i class="fa fa-check"></i><b>15.3</b> Writing setup code</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#useful-tools-for-setup-functions"><i class="fa fa-check"></i><b>15.3.1</b> Useful tools for setup functions</a></li>
<li class="chapter" data-level="15.3.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:access-modify-numer"><i class="fa fa-check"></i><b>15.3.2</b> Accessing and modifying numeric values from setup</a></li>
<li class="chapter" data-level="15.3.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#determining-numeric-types-in-nimblefunctions"><i class="fa fa-check"></i><b>15.3.3</b> Determining numeric types in nimbleFunctions</a></li>
<li class="chapter" data-level="15.3.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:determ-pers-texttts"><i class="fa fa-check"></i><b>15.3.4</b> Control of setup outputs</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:nimble-lang-comp"><i class="fa fa-check"></i><b>15.4</b> Writing run code</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:driv-models:-calc"><i class="fa fa-check"></i><b>15.4.1</b> Driving models: <em>calculate</em>, <em>calculateDiff</em>, <em>simulate</em>, <em>getLogProb</em></a></li>
<li class="chapter" data-level="15.4.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#getting-and-setting-variable-and-node-values"><i class="fa fa-check"></i><b>15.4.2</b> Getting and setting variable and node values</a></li>
<li class="chapter" data-level="15.4.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#getting-parameter-values-and-node-bounds"><i class="fa fa-check"></i><b>15.4.3</b> Getting parameter values and node bounds</a></li>
<li class="chapter" data-level="15.4.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:access-model-modelv"><i class="fa fa-check"></i><b>15.4.4</b> Using modelValues objects</a></li>
<li class="chapter" data-level="15.4.5" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-model-variable"><i class="fa fa-check"></i><b>15.4.5</b> Using model variables and modelValues in expressions</a></li>
<li class="chapter" data-level="15.4.6" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:incl-other-meth"><i class="fa fa-check"></i><b>15.4.6</b> Including other methods in a nimbleFunction</a></li>
<li class="chapter" data-level="15.4.7" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-other-nimbl"><i class="fa fa-check"></i><b>15.4.7</b> Using other nimbleFunctions</a></li>
<li class="chapter" data-level="15.4.8" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:virt-nimbl-nimbl"><i class="fa fa-check"></i><b>15.4.8</b> Virtual nimbleFunctions and nimbleFunctionLists</a></li>
<li class="chapter" data-level="15.4.9" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#character-objects"><i class="fa fa-check"></i><b>15.4.9</b> Character objects</a></li>
<li class="chapter" data-level="15.4.10" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:user-defined-data"><i class="fa fa-check"></i><b>15.4.10</b> User-defined data structures</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:user-samplers"><i class="fa fa-check"></i><b>15.5</b> Example: writing user-defined samplers to extend NIMBLE’s MCMC engine</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#user-defined-samplers-and-posterior-predictive-nodes"><i class="fa fa-check"></i><b>15.5.1</b> User-defined samplers and posterior predictive nodes</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#copying-nimblefunctions-and-nimble-models"><i class="fa fa-check"></i><b>15.6</b> Copying nimbleFunctions (and NIMBLE models)</a></li>
<li class="chapter" data-level="15.7" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:debugging"><i class="fa fa-check"></i><b>15.7</b> Debugging nimbleFunctions</a></li>
<li class="chapter" data-level="15.8" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#timing-nimblefunctions-with-run.time"><i class="fa fa-check"></i><b>15.8</b> Timing nimbleFunctions with <em>run.time</em></a></li>
<li class="chapter" data-level="15.9" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#clearing-and-unloading-compiled-objects"><i class="fa fa-check"></i><b>15.9</b> Clearing and unloading compiled objects</a></li>
<li class="chapter" data-level="15.10" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#reducing-memory-usage"><i class="fa fa-check"></i><b>15.10</b> Reducing memory usage</a></li>
</ul></li>
<li class="part"><span><b>V Automatic Derivatives in NIMBLE</b></span></li>
<li class="chapter" data-level="16" data-path="cha-AD.html"><a href="cha-AD.html"><i class="fa fa-check"></i><b>16</b> Automatic Derivatives</a>
<ul>
<li class="chapter" data-level="16.1" data-path="cha-AD.html"><a href="cha-AD.html#sec:use-derivs"><i class="fa fa-check"></i><b>16.1</b> How to turn on derivatives in a model</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="cha-AD.html"><a href="cha-AD.html#finish-setting-up-the-glmm-example"><i class="fa fa-check"></i><b>16.1.1</b> Finish setting up the GLMM example</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="cha-AD.html"><a href="cha-AD.html#how-to-use-laplace-approximation"><i class="fa fa-check"></i><b>16.2</b> How to use Laplace approximation</a></li>
<li class="chapter" data-level="16.3" data-path="cha-AD.html"><a href="cha-AD.html#how-to-support-derivatives-in-user-defined-functions-and-distributions"><i class="fa fa-check"></i><b>16.3</b> How to support derivatives in user-defined functions and distributions</a></li>
<li class="chapter" data-level="16.4" data-path="cha-AD.html"><a href="cha-AD.html#what-operations-are-and-arent-supported-for-ad"><i class="fa fa-check"></i><b>16.4</b> What operations are and aren’t supported for AD</a></li>
<li class="chapter" data-level="16.5" data-path="cha-AD.html"><a href="cha-AD.html#basics-of-obtaining-derivatives-in-nimblefunctions"><i class="fa fa-check"></i><b>16.5</b> Basics of obtaining derivatives in <code>nimbleFunctions</code></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="cha-AD.html"><a href="cha-AD.html#checking-derivatives-with-uncompiled-execution"><i class="fa fa-check"></i><b>16.5.1</b> Checking derivatives with uncompiled execution</a></li>
<li class="chapter" data-level="16.5.2" data-path="cha-AD.html"><a href="cha-AD.html#holding-some-local-variables-out-of-derivative-tracking"><i class="fa fa-check"></i><b>16.5.2</b> Holding some local variables out of derivative tracking</a></li>
<li class="chapter" data-level="16.5.3" data-path="cha-AD.html"><a href="cha-AD.html#using-ad-with-multiple-nimblefunctions"><i class="fa fa-check"></i><b>16.5.3</b> Using AD with multiple nimbleFunctions</a></li>
<li class="chapter" data-level="16.5.4" data-path="cha-AD.html"><a href="cha-AD.html#understanding-more-about-how-ad-works-taping-of-operations"><i class="fa fa-check"></i><b>16.5.4</b> Understanding more about how AD works: <em>taping</em> of operations</a></li>
<li class="chapter" data-level="16.5.5" data-path="cha-AD.html"><a href="cha-AD.html#resetting-a-nimderivs-call"><i class="fa fa-check"></i><b>16.5.5</b> Resetting a <code>nimDerivs</code> call</a></li>
<li class="chapter" data-level="16.5.6" data-path="cha-AD.html"><a href="cha-AD.html#a-note-on-performance-benchmarking"><i class="fa fa-check"></i><b>16.5.6</b> A note on performance benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="cha-AD.html"><a href="cha-AD.html#advanced-uses-double-taping"><i class="fa fa-check"></i><b>16.6</b> Advanced uses: double taping</a></li>
<li class="chapter" data-level="16.7" data-path="cha-AD.html"><a href="cha-AD.html#derivatives-involving-model-calculations"><i class="fa fa-check"></i><b>16.7</b> Derivatives involving model calculations</a>
<ul>
<li class="chapter" data-level="16.7.1" data-path="cha-AD.html"><a href="cha-AD.html#method-1-nimderivs-of-modelcalculate"><i class="fa fa-check"></i><b>16.7.1</b> Method 1: <code>nimDerivs</code> of <code>model$calculate</code></a></li>
<li class="chapter" data-level="16.7.2" data-path="cha-AD.html"><a href="cha-AD.html#method-2-nimderivs-of-a-method-that-calls-modelcalculate"><i class="fa fa-check"></i><b>16.7.2</b> Method 2: <code>nimDerivs</code> of a method that calls <code>model$calculate</code></a></li>
</ul></li>
<li class="chapter" data-level="16.8" data-path="cha-AD.html"><a href="cha-AD.html#sec:parameter-transform"><i class="fa fa-check"></i><b>16.8</b> Parameter transformations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="example-maximum-likelihood-estimation-using-optim-with-gradients-from-nimderivs..html"><a href="example-maximum-likelihood-estimation-using-optim-with-gradients-from-nimderivs..html"><i class="fa fa-check"></i><b>17</b> Example: maximum likelihood estimation using <code>optim</code> with gradients from <code>nimDerivs</code>.</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cha-using-models" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">Chapter 13</span> Working with NIMBLE models<a href="cha-using-models.html#cha-using-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Here we describe how one can get information about NIMBLE models and
carry out operations on a model. While all of this functionality can
be used from R, its primary use occurs when writing nimbleFunctions (see Chapter <a href="cha-progr-with-models.html#cha-progr-with-models">15</a>).
Information about node types, distributions, and dimensions can be
used to determine algorithm behavior in <em>setup</em> code of nimbleFunctions. Information
about node or variable values or the parameter and bound values of a node would generally be used for algorithm
calculations in <em>run</em> code of nimbleFunctions. Similarly, carrying out numerical operations
on a model, including setting node or variable values, would generally be done in run code.</p>
<div id="sec:accessing-variables" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> The variables and nodes in a NIMBLE model<a href="cha-using-models.html#sec:accessing-variables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Section <a href="cha-building-models.html#sec:nodes-and-variables">6.2</a> defines what we mean by variables and nodes in a NIMBLE model and discusses how to determine and access the nodes in a model and their dependency relationships. Here we’ll review and go into more detail on the topics of determining the nodes and node dependencies in a model.</p>
<div id="sec:get-nodes" class="section level3 hasAnchor" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Determining the nodes in a model<a href="cha-using-models.html#sec:get-nodes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One can determine the variables in a model using <code>getVarNames</code> and the nodes in a model using <code>getNodeNames</code>, with optional arguments allowing you to select only certain types of nodes. We illustrate here with the pump model from Chapter <a href="cha-lightning-intro.html#cha-lightning-intro">2</a>.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="cha-using-models.html#cb246-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getVarNames</span>()</span></code></pre></div>
<pre><code>## [1] &quot;lifted_d1_over_beta&quot; &quot;theta&quot;               &quot;lambda&quot;             
## [4] &quot;x&quot;                   &quot;alpha&quot;               &quot;beta&quot;</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="cha-using-models.html#cb248-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getNodeNames</span>()</span></code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;               &quot;beta&quot;                &quot;lifted_d1_over_beta&quot;
##  [4] &quot;theta[1]&quot;            &quot;theta[2]&quot;            &quot;theta[3]&quot;           
##  [7] &quot;theta[4]&quot;            &quot;theta[5]&quot;            &quot;theta[6]&quot;           
## [10] &quot;theta[7]&quot;            &quot;theta[8]&quot;            &quot;theta[9]&quot;           
## [13] &quot;theta[10]&quot;           &quot;lambda[1]&quot;           &quot;lambda[2]&quot;          
## [16] &quot;lambda[3]&quot;           &quot;lambda[4]&quot;           &quot;lambda[5]&quot;          
## [19] &quot;lambda[6]&quot;           &quot;lambda[7]&quot;           &quot;lambda[8]&quot;          
## [22] &quot;lambda[9]&quot;           &quot;lambda[10]&quot;          &quot;x[1]&quot;               
## [25] &quot;x[2]&quot;                &quot;x[3]&quot;                &quot;x[4]&quot;               
## [28] &quot;x[5]&quot;                &quot;x[6]&quot;                &quot;x[7]&quot;               
## [31] &quot;x[8]&quot;                &quot;x[9]&quot;                &quot;x[10]&quot;</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="cha-using-models.html#cb250-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getNodeNames</span>(<span class="at">determOnly =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;lifted_d1_over_beta&quot; &quot;lambda[1]&quot;           &quot;lambda[2]&quot;          
##  [4] &quot;lambda[3]&quot;           &quot;lambda[4]&quot;           &quot;lambda[5]&quot;          
##  [7] &quot;lambda[6]&quot;           &quot;lambda[7]&quot;           &quot;lambda[8]&quot;          
## [10] &quot;lambda[9]&quot;           &quot;lambda[10]&quot;</code></pre>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="cha-using-models.html#cb252-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getNodeNames</span>(<span class="at">stochOnly =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;     &quot;beta&quot;      &quot;theta[1]&quot;  &quot;theta[2]&quot;  &quot;theta[3]&quot;  &quot;theta[4]&quot; 
##  [7] &quot;theta[5]&quot;  &quot;theta[6]&quot;  &quot;theta[7]&quot;  &quot;theta[8]&quot;  &quot;theta[9]&quot;  &quot;theta[10]&quot;
## [13] &quot;x[1]&quot;      &quot;x[2]&quot;      &quot;x[3]&quot;      &quot;x[4]&quot;      &quot;x[5]&quot;      &quot;x[6]&quot;     
## [19] &quot;x[7]&quot;      &quot;x[8]&quot;      &quot;x[9]&quot;      &quot;x[10]&quot;</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="cha-using-models.html#cb254-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getNodeNames</span>(<span class="at">dataOnly =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;x[1]&quot;  &quot;x[2]&quot;  &quot;x[3]&quot;  &quot;x[4]&quot;  &quot;x[5]&quot;  &quot;x[6]&quot;  &quot;x[7]&quot;  &quot;x[8]&quot;  &quot;x[9]&quot; 
## [10] &quot;x[10]&quot;</code></pre>
<p>You can see one lifted node (see next section), <code>lifted_d1_over_beta</code>, involved in a reparameterization to NIMBLE’s canonical parameterization of the gamma distribution for the <code>theta</code> nodes.</p>
<p>We can determine the set of nodes contained in one or more nodes or variables using <code>expandNodeNames</code>, illustrated here for an example with multivariate nodes. The
<code>returnScalarComponents</code> argument also allows us to return all of the scalar elements of multivariate nodes.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="cha-using-models.html#cb256-1" aria-hidden="true" tabindex="-1"></a>multiVarCode2 <span class="ot">&lt;-</span> <span class="fu">nimbleCode</span>({</span>
<span id="cb256-2"><a href="cha-using-models.html#cb256-2" aria-hidden="true" tabindex="-1"></a>    X[<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] <span class="sc">~</span> <span class="fu">dmnorm</span>(mu[], cov[,])</span>
<span id="cb256-3"><a href="cha-using-models.html#cb256-3" aria-hidden="true" tabindex="-1"></a>    X[<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">3</span>] <span class="sc">~</span> <span class="fu">dmnorm</span>(mu[], cov[,])</span>
<span id="cb256-4"><a href="cha-using-models.html#cb256-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) </span>
<span id="cb256-5"><a href="cha-using-models.html#cb256-5" aria-hidden="true" tabindex="-1"></a>        Y[i] <span class="sc">~</span> <span class="fu">dnorm</span>(mn, <span class="dv">1</span>)</span>
<span id="cb256-6"><a href="cha-using-models.html#cb256-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb256-7"><a href="cha-using-models.html#cb256-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-8"><a href="cha-using-models.html#cb256-8" aria-hidden="true" tabindex="-1"></a>multiVarModel2 <span class="ot">&lt;-</span> <span class="fu">nimbleModel</span>(multiVarCode2,</span>
<span id="cb256-9"><a href="cha-using-models.html#cb256-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">dimensions =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">5</span>, <span class="at">cov =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>)),</span>
<span id="cb256-10"><a href="cha-using-models.html#cb256-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">calculate =</span> <span class="cn">FALSE</span>)</span>
<span id="cb256-11"><a href="cha-using-models.html#cb256-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-12"><a href="cha-using-models.html#cb256-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-13"><a href="cha-using-models.html#cb256-13" aria-hidden="true" tabindex="-1"></a>multiVarModel2<span class="sc">$</span><span class="fu">expandNodeNames</span>(<span class="st">&quot;Y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Y[1]&quot; &quot;Y[2]&quot; &quot;Y[3]&quot; &quot;Y[4]&quot;</code></pre>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="cha-using-models.html#cb258-1" aria-hidden="true" tabindex="-1"></a>multiVarModel2<span class="sc">$</span><span class="fu">expandNodeNames</span>(<span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>), <span class="at">returnScalarComponents =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;X[1, 1]&quot;  &quot;X[1, 2]&quot;  &quot;X[1, 3]&quot;  &quot;X[6, 3]&quot;  &quot;X[7, 3]&quot;  &quot;X[8, 3]&quot; 
##  [7] &quot;X[9, 3]&quot;  &quot;X[10, 3]&quot; &quot;X[1, 4]&quot;  &quot;X[1, 5]&quot;  &quot;Y[1]&quot;     &quot;Y[2]&quot;    
## [13] &quot;Y[3]&quot;     &quot;Y[4]&quot;</code></pre>
<p>As discussed in Section <a href="cha-building-models.html#sec:cdisdata">6.2.6</a>, you can determine whether a node is flagged as data using <code>isData</code>.</p>
</div>
<div id="sec:introduced-nodes" class="section level3 hasAnchor" number="13.1.2">
<h3><span class="header-section-number">13.1.2</span> Understanding lifted nodes<a href="cha-using-models.html#sec:introduced-nodes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In some cases, NIMBLE introduces new nodes into the model that were
not specified in the BUGS code for the model, such as the
<code>lifted_d1_over_beta</code> node in the introductory example. For
this reason, it is important that programs written to adapt to
different model structures use NIMBLE’s systems for querying the model
graph. For example, a call to <code>pump$getDependencies("beta")</code> will
correctly include <code>lifted_d1_over_beta</code> in the results. If one
skips this step and assumes the nodes are only those that appear in
the BUGS code, one may not get correct results.</p>
<p>It can be helpful to know the situations in which lifted nodes are
generated. These include:</p>
<ol style="list-style-type: decimal">
<li>When distribution parameters are expressions, NIMBLE
creates a new deterministic node that contains the expression for a
given parameter. The node is then a direct descendant of the new
deterministic node. This is an optional feature, but it is
currently enabled in all cases.</li>
<li>As discussed in Section <a href="cha-writing-models.html#subsec:BUGS-link">5.2.6</a>, the use of link
functions causes new nodes to be introduced. This requires care if
you need to initialize values in stochastic declarations with link functions.</li>
<li>Use of alternative parameterizations of distributions, described in Section <a href="cha-writing-models.html#subsec:dists-and-functions">5.2.4</a> causes new nodes to be introduced. For
example when a user provides the precision of a normal distribution
as <code>tau</code>, NIMBLE creates a new node <code>sd &lt;- 1/sqrt(tau)</code> and
uses <code>sd</code> as a parameter in the normal distribution. If many
nodes use the same <code>tau</code>, only one new <code>sd</code> node will be
created, so the computation <code>1/sqrt(tau)</code> will not be repeated
redundantly.</li>
</ol>
</div>
<div id="sec:cdgetdependencies" class="section level3 hasAnchor" number="13.1.3">
<h3><span class="header-section-number">13.1.3</span> Determining dependencies in a model<a href="cha-using-models.html#sec:cdgetdependencies" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next we’ll see how to determine the node dependencies (or
‘descendants’ or child nodes) in a model. There are a variety of arguments to <code>getDependencies</code> that
allow one to specify whether to include the node itself, whether to
include deterministic or stochastic or data dependents, etc. By
default <code>getDependencies</code> returns descendants up to the next
stochastic node on all edges emanating from the node(s) specified as input. This is what would be
needed to calculate a Metropolis-Hastings acceptance probability in
MCMC, for example.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="cha-using-models.html#cb260-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getDependencies</span>(<span class="st">&quot;alpha&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;     &quot;theta[1]&quot;  &quot;theta[2]&quot;  &quot;theta[3]&quot;  &quot;theta[4]&quot;  &quot;theta[5]&quot; 
##  [7] &quot;theta[6]&quot;  &quot;theta[7]&quot;  &quot;theta[8]&quot;  &quot;theta[9]&quot;  &quot;theta[10]&quot;</code></pre>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="cha-using-models.html#cb262-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getDependencies</span>(<span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>))</span></code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;               &quot;beta&quot;                &quot;lifted_d1_over_beta&quot;
##  [4] &quot;theta[1]&quot;            &quot;theta[2]&quot;            &quot;theta[3]&quot;           
##  [7] &quot;theta[4]&quot;            &quot;theta[5]&quot;            &quot;theta[6]&quot;           
## [10] &quot;theta[7]&quot;            &quot;theta[8]&quot;            &quot;theta[9]&quot;           
## [13] &quot;theta[10]&quot;</code></pre>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="cha-using-models.html#cb264-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getDependencies</span>(<span class="st">&quot;theta[1:3]&quot;</span>, <span class="at">self =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;lambda[1]&quot; &quot;lambda[2]&quot; &quot;lambda[3]&quot; &quot;x[1]&quot;      &quot;x[2]&quot;      &quot;x[3]&quot;</code></pre>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="cha-using-models.html#cb266-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getDependencies</span>(<span class="st">&quot;theta[1:3]&quot;</span>, <span class="at">stochOnly =</span> <span class="cn">TRUE</span>, <span class="at">self =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;x[1]&quot; &quot;x[2]&quot; &quot;x[3]&quot;</code></pre>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="cha-using-models.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get all dependencies, not just the direct descendants</span></span>
<span id="cb268-2"><a href="cha-using-models.html#cb268-2" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getDependencies</span>(<span class="st">&quot;alpha&quot;</span>, <span class="at">downstream =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;alpha&quot;      &quot;theta[1]&quot;   &quot;theta[2]&quot;   &quot;theta[3]&quot;   &quot;theta[4]&quot;  
##  [6] &quot;theta[5]&quot;   &quot;theta[6]&quot;   &quot;theta[7]&quot;   &quot;theta[8]&quot;   &quot;theta[9]&quot;  
## [11] &quot;theta[10]&quot;  &quot;lambda[1]&quot;  &quot;lambda[2]&quot;  &quot;lambda[3]&quot;  &quot;lambda[4]&quot; 
## [16] &quot;lambda[5]&quot;  &quot;lambda[6]&quot;  &quot;lambda[7]&quot;  &quot;lambda[8]&quot;  &quot;lambda[9]&quot; 
## [21] &quot;lambda[10]&quot; &quot;x[1]&quot;       &quot;x[2]&quot;       &quot;x[3]&quot;       &quot;x[4]&quot;      
## [26] &quot;x[5]&quot;       &quot;x[6]&quot;       &quot;x[7]&quot;       &quot;x[8]&quot;       &quot;x[9]&quot;      
## [31] &quot;x[10]&quot;</code></pre>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="cha-using-models.html#cb270-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getDependencies</span>(<span class="st">&quot;alpha&quot;</span>, <span class="at">downstream =</span> <span class="cn">TRUE</span>, <span class="at">dataOnly =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;x[1]&quot;  &quot;x[2]&quot;  &quot;x[3]&quot;  &quot;x[4]&quot;  &quot;x[5]&quot;  &quot;x[6]&quot;  &quot;x[7]&quot;  &quot;x[8]&quot;  &quot;x[9]&quot; 
## [10] &quot;x[10]&quot;</code></pre>
<p>In addition, one can determine parent nodes using <code>getParents</code>.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="cha-using-models.html#cb272-1" aria-hidden="true" tabindex="-1"></a>pump<span class="sc">$</span><span class="fu">getParents</span>(<span class="st">&quot;alpha&quot;</span>)</span></code></pre></div>
<pre><code>## character(0)</code></pre>
</div>
</div>
<div id="sec:nodeInfo" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Accessing information about nodes and variables<a href="cha-using-models.html#sec:nodeInfo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="getting-distributional-information-about-a-node" class="section level3 hasAnchor" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Getting distributional information about a node<a href="cha-using-models.html#getting-distributional-information-about-a-node" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We briefly demonstrate some of the functionality for information about a node here,
but refer readers to the R help on <code>modelBaseClass</code> for full details.</p>
<p>Here is an example model, with use of various functions to determine
information about nodes or variables.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="cha-using-models.html#cb274-1" aria-hidden="true" tabindex="-1"></a>code <span class="ot">&lt;-</span> <span class="fu">nimbleCode</span>({</span>
<span id="cb274-2"><a href="cha-using-models.html#cb274-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) </span>
<span id="cb274-3"><a href="cha-using-models.html#cb274-3" aria-hidden="true" tabindex="-1"></a>        y[i] <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="at">sd =</span> sigma)</span>
<span id="cb274-4"><a href="cha-using-models.html#cb274-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="sc">~</span> <span class="fu">T</span>(<span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb274-5"><a href="cha-using-models.html#cb274-5" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb274-6"><a href="cha-using-models.html#cb274-6" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb274-7"><a href="cha-using-models.html#cb274-7" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">nimbleModel</span>(code, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">4</span>)),</span>
<span id="cb274-8"><a href="cha-using-models.html#cb274-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">inits =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">1</span>))</span>
<span id="cb274-9"><a href="cha-using-models.html#cb274-9" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span><span class="fu">isEndNode</span>(<span class="st">&#39;y&#39;</span>)</span></code></pre></div>
<pre><code>## y[1] y[2] y[3] y[4] 
## TRUE TRUE TRUE TRUE</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="cha-using-models.html#cb276-1" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span><span class="fu">getDistribution</span>(<span class="st">&#39;sigma&#39;</span>)</span></code></pre></div>
<pre><code>##   sigma 
## &quot;dunif&quot;</code></pre>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="cha-using-models.html#cb278-1" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span><span class="fu">isDiscrete</span>(<span class="fu">c</span>(<span class="st">&#39;y&#39;</span>, <span class="st">&#39;mu&#39;</span>, <span class="st">&#39;sigma&#39;</span>))</span></code></pre></div>
<pre><code>##  y[1]  y[2]  y[3]  y[4]    mu sigma 
## FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="cha-using-models.html#cb280-1" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span><span class="fu">isDeterm</span>(<span class="st">&#39;mu&#39;</span>)</span></code></pre></div>
<pre><code>##    mu 
## FALSE</code></pre>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="cha-using-models.html#cb282-1" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span><span class="fu">getDimension</span>(<span class="st">&#39;mu&#39;</span>)</span></code></pre></div>
<pre><code>## value 
##     0</code></pre>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="cha-using-models.html#cb284-1" aria-hidden="true" tabindex="-1"></a>m<span class="sc">$</span><span class="fu">getDimension</span>(<span class="st">&#39;mu&#39;</span>, <span class="at">includeParams =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## value  mean    sd   tau   var 
##     0     0     0     0     0</code></pre>
<p>Note that any variables provided to these functions are expanded into
their constituent node names, so the length of results may not be the
same length as the input vector of node and variable names. However
the order of the results should be preserved relative to the order of
the inputs, once the expansion is accounted for.</p>
</div>
<div id="getting-information-about-a-distribution" class="section level3 hasAnchor" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Getting information about a distribution<a href="cha-using-models.html#getting-information-about-a-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One can also get generic information about a distribution based on the
name of the distribution using the function <code>getDistributionInfo</code>.
In particular, one can determine whether a distribution
was provided by the user (<code>isUserDefined</code>), whether a distribution provides CDF and
quantile functions (<code>pqDefined</code>), whether a distribution is a
discrete distribution (<code>isDiscrete</code>), the parameter names (include
alternative parameterizations) for a distribution (<code>getParamNames</code>),
and the dimension of the distribution and its parameters
(<code>getDimension</code>). For more extensive information, please see the R
help for <code>getDistributionInfo</code>.</p>
</div>
<div id="sec:getParam" class="section level3 hasAnchor" number="13.2.3">
<h3><span class="header-section-number">13.2.3</span> Getting distribution parameter values for a node<a href="cha-using-models.html#sec:getParam" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code>getParam</code> provides access to values of the parameters
of a node’s distribution. The two arguments must
be the name of one (stochastic) node and the name of a parameter for the
distribution followed by that node. The parameter does not have to be
one of the parameters used when the node was declared. Alternative
parameterization values can also be obtained. See
Section <a href="cha-writing-models.html#subsec:distributions">5.2.4.1</a> for available parameterizations.
(These can also be seen in <code>nimble:::distributionsInputList</code>.)</p>
<p>Here is an example:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="cha-using-models.html#cb286-1" aria-hidden="true" tabindex="-1"></a>gammaModel <span class="ot">&lt;-</span> <span class="fu">nimbleModel</span>(</span>
<span id="cb286-2"><a href="cha-using-models.html#cb286-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nimbleCode</span>({</span>
<span id="cb286-3"><a href="cha-using-models.html#cb286-3" aria-hidden="true" tabindex="-1"></a>        a <span class="sc">~</span> <span class="fu">dlnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb286-4"><a href="cha-using-models.html#cb286-4" aria-hidden="true" tabindex="-1"></a>        x <span class="sc">~</span> <span class="fu">dgamma</span>(<span class="at">shape =</span> <span class="dv">2</span>, <span class="at">scale =</span> a)</span>
<span id="cb286-5"><a href="cha-using-models.html#cb286-5" aria-hidden="true" tabindex="-1"></a>    }), <span class="at">data =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fl">2.4</span>), <span class="at">inits =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="fl">1.2</span>))</span>
<span id="cb286-6"><a href="cha-using-models.html#cb286-6" aria-hidden="true" tabindex="-1"></a>gammaModel<span class="sc">$</span><span class="fu">getParam</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;scale&#39;</span>)</span></code></pre></div>
<pre><code>## [1] 1.2</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="cha-using-models.html#cb288-1" aria-hidden="true" tabindex="-1"></a>gammaModel<span class="sc">$</span><span class="fu">getParam</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;rate&#39;</span>)</span></code></pre></div>
<pre><code>## [1] 0.8333333</code></pre>
<p><code>getParam</code> is part of the NIMBLE language, so it can be used in run code of nimbleFunctions.</p>
</div>
<div id="sec:getBound" class="section level3 hasAnchor" number="13.2.4">
<h3><span class="header-section-number">13.2.4</span> Getting distribution bounds for a node<a href="cha-using-models.html#sec:getBound" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The function <code>getBound</code> provides access to the lower and upper
bounds of the distribution for a node. In most cases these bounds
will be fixed based on the distribution, but for the uniform distribution
the bounds are the parameters of the distribution, and when truncation is used (Section <a href="cha-writing-models.html#subsec:trunc">5.2.7</a>), the bounds will be determined
by the truncation. Like the functions described in the previous section, <code>getBound</code> can be
used as global function taking a model as the first argument, or it
can be used as a model member function. The next two arguments must
be the name of one (stochastic) node and either <code>"lower"</code> or <code>"upper"</code>
indicating whether the lower or upper bound is desired. For multivariate nodes
the bound is a scalar that is the bound for all elements of the node, as we
do not handle truncation for multivariate nodes.</p>
<p>Here is an example:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="cha-using-models.html#cb290-1" aria-hidden="true" tabindex="-1"></a>exampleModel <span class="ot">&lt;-</span> <span class="fu">nimbleModel</span>(</span>
<span id="cb290-2"><a href="cha-using-models.html#cb290-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nimbleCode</span>({</span>
<span id="cb290-3"><a href="cha-using-models.html#cb290-3" aria-hidden="true" tabindex="-1"></a>        y <span class="sc">~</span> <span class="fu">T</span>(<span class="fu">dnorm</span>(mu, <span class="at">sd =</span> sig), a, <span class="cn">Inf</span>)</span>
<span id="cb290-4"><a href="cha-using-models.html#cb290-4" aria-hidden="true" tabindex="-1"></a>        a <span class="sc">~</span> <span class="fu">dunif</span>(<span class="sc">-</span><span class="dv">1</span>, b)</span>
<span id="cb290-5"><a href="cha-using-models.html#cb290-5" aria-hidden="true" tabindex="-1"></a>        b <span class="sc">~</span> <span class="fu">dgamma</span>(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb290-6"><a href="cha-using-models.html#cb290-6" aria-hidden="true" tabindex="-1"></a>    }), <span class="at">inits =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">mu =</span> <span class="dv">1</span>, <span class="at">sig =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">4</span>),</span>
<span id="cb290-7"><a href="cha-using-models.html#cb290-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="dv">4</span>))</span>
<span id="cb290-8"><a href="cha-using-models.html#cb290-8" aria-hidden="true" tabindex="-1"></a><span class="fu">getBound</span>(exampleModel, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;lower&#39;</span>)</span></code></pre></div>
<pre><code>## [1] -0.5</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="cha-using-models.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getBound</span>(exampleModel, <span class="st">&#39;y&#39;</span>, <span class="st">&#39;upper&#39;</span>)</span></code></pre></div>
<pre><code>## [1] Inf</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="cha-using-models.html#cb294-1" aria-hidden="true" tabindex="-1"></a>exampleModel<span class="sc">$</span>b <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb294-2"><a href="cha-using-models.html#cb294-2" aria-hidden="true" tabindex="-1"></a>exampleModel<span class="sc">$</span><span class="fu">calculate</span>(exampleModel<span class="sc">$</span><span class="fu">getDependencies</span>(<span class="st">&#39;b&#39;</span>))</span></code></pre></div>
<pre><code>## [1] -4.386294</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="cha-using-models.html#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getBound</span>(exampleModel, <span class="st">&#39;a&#39;</span>, <span class="st">&#39;upper&#39;</span>)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="cha-using-models.html#cb298-1" aria-hidden="true" tabindex="-1"></a>exampleModel<span class="sc">$</span><span class="fu">getBound</span>(<span class="st">&#39;b&#39;</span>,<span class="st">&#39;lower&#39;</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p><code>getBound</code> is part of the NIMBLE language, so it can be used in run code of nimbleFunctions. In fact, we anticipate that
most use of <code>getBound</code> will be for algorithms, such as for the reflection
version of the random walk MCMC sampler.</p>
</div>
</div>
<div id="sec:cdcalc-cdsim-cdgetl" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Carrying out model calculations<a href="cha-using-models.html#sec:cdcalc-cdsim-cdgetl" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="core-model-operations-calculation-and-simulation" class="section level3 hasAnchor" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Core model operations: calculation and simulation<a href="cha-using-models.html#core-model-operations-calculation-and-simulation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The four basic ways to operate a model are to calculate nodes,
simulate into nodes, get the log probabilities (or probability
densities) that have already been calculated, and compare the log probability
of a new value to that of an old value. In more detail:</p>
<ul>
<li><strong>calculate</strong> For a stochastic node,
<code>calculate</code> determines the log probability value, stores it in the
appropriate <code>logProb</code> variable, and
returns it. For a deterministic node, <code>calculate</code> executes the
deterministic calculation and returns 0.</li>
<li><strong>simulate</strong> For a stochastic node, <code>simulate</code> generates a
random draw. For deterministic nodes,
<code>simulate</code> is equivalent to <code>calculate</code> without returning 0. <code>simulate</code> always returns <code>NULL</code> (or <code>void</code> in C++).</li>
<li><strong>getLogProb</strong> <code>getLogProb</code> simply
returns the most recently calculated log probability value, or 0 for a
deterministic node.</li>
<li><strong>calculateDiff</strong> <code>calculateDiff</code> is identical to
<code>calculate</code>, but it returns the new log probability value minus
the one that was previously stored. This is useful when one wants to
change the value or values of node(s) in the model (e.g., by setting a value or
<code>simulate</code>) and then determine
the change in the log probability, such as needed for a
Metropolis-Hastings acceptance probability.</li>
</ul>
<p>Each of these functions is accessed as a member function of a model
object, taking a vector of node names as an argument<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a>. If there is
more than one node name, <code>calculate</code> and <code>getLogProb</code> return the
sum of the log probabilities from each node, while <code>calculateDiff</code>
returns the sum of the new values minus the old values. Next we show
an example using <code>simulate</code>.</p>
<div id="sec:arbitr-coll-nodes" class="section level4 hasAnchor" number="13.3.1.1">
<h4><span class="header-section-number">13.3.1.1</span> Example: simulating arbitrary collections of nodes<a href="cha-using-models.html#sec:arbitr-coll-nodes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="cha-using-models.html#cb300-1" aria-hidden="true" tabindex="-1"></a>mc <span class="ot">&lt;-</span> <span class="fu">nimbleCode</span>({</span>
<span id="cb300-2"><a href="cha-using-models.html#cb300-2" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.001</span>)</span>
<span id="cb300-3"><a href="cha-using-models.html#cb300-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb300-4"><a href="cha-using-models.html#cb300-4" aria-hidden="true" tabindex="-1"></a>        y[i] <span class="sc">~</span> <span class="fu">dnorm</span>(a, <span class="fl">0.1</span>)</span>
<span id="cb300-5"><a href="cha-using-models.html#cb300-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb300-6"><a href="cha-using-models.html#cb300-6" aria-hidden="true" tabindex="-1"></a>            z[i,j] <span class="sc">~</span> <span class="fu">dnorm</span>(y[i], <span class="at">sd =</span> <span class="fl">0.1</span>)</span>
<span id="cb300-7"><a href="cha-using-models.html#cb300-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb300-8"><a href="cha-using-models.html#cb300-8" aria-hidden="true" tabindex="-1"></a>    y.squared[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] <span class="ot">&lt;-</span> y[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb300-9"><a href="cha-using-models.html#cb300-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb300-10"><a href="cha-using-models.html#cb300-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-11"><a href="cha-using-models.html#cb300-11" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">nimbleModel</span>(mc, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">z =</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">15</span>), <span class="at">nrow =</span> <span class="dv">5</span>)))</span>
<span id="cb300-12"><a href="cha-using-models.html#cb300-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-13"><a href="cha-using-models.html#cb300-13" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>a <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb300-14"><a href="cha-using-models.html#cb300-14" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>y</span></code></pre></div>
<pre><code>## [1] NA NA NA NA NA</code></pre>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="cha-using-models.html#cb302-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">simulate</span>(<span class="st">&quot;y[1:3]&quot;</span>)</span>
<span id="cb302-2"><a href="cha-using-models.html#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate(model, &quot;y[1:3]&quot;)</span></span>
<span id="cb302-3"><a href="cha-using-models.html#cb302-3" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>y</span></code></pre></div>
<pre><code>## [1] -4.3723097  1.7331821  0.6234022         NA         NA</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="cha-using-models.html#cb304-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">simulate</span>(<span class="st">&quot;y&quot;</span>)</span>
<span id="cb304-2"><a href="cha-using-models.html#cb304-2" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>y</span></code></pre></div>
<pre><code>## [1]  6.6051146  2.0859962 -0.9702564 -0.3898915 -0.5978887</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="cha-using-models.html#cb306-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>z</span></code></pre></div>
<pre><code>##            [,1]       [,2]        [,3]
## [1,] -1.0314207 -0.9537793 -0.79453166
## [2,] -2.3710229 -0.3980044 -0.30881797
## [3,] -0.3245763 -0.3112171  0.36144477
## [4,] -0.9442988  0.7960927  1.39879110
## [5,] -0.7658900  0.9864283 -0.05607042</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="cha-using-models.html#cb308-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">simulate</span>(<span class="fu">c</span>(<span class="st">&quot;y[1:3]&quot;</span>, <span class="st">&quot;z[1:5, 1:3]&quot;</span>))</span>
<span id="cb308-2"><a href="cha-using-models.html#cb308-2" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>y</span></code></pre></div>
<pre><code>## [1]  1.5882948  1.5578821  3.8961663 -0.3898915 -0.5978887</code></pre>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="cha-using-models.html#cb310-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>z</span></code></pre></div>
<pre><code>##            [,1]       [,2]        [,3]
## [1,] -1.0314207 -0.9537793 -0.79453166
## [2,] -2.3710229 -0.3980044 -0.30881797
## [3,] -0.3245763 -0.3112171  0.36144477
## [4,] -0.9442988  0.7960927  1.39879110
## [5,] -0.7658900  0.9864283 -0.05607042</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="cha-using-models.html#cb312-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">simulate</span>(<span class="fu">c</span>(<span class="st">&quot;z[1:5, 1:3]&quot;</span>), <span class="at">includeData =</span> <span class="cn">TRUE</span>)</span>
<span id="cb312-2"><a href="cha-using-models.html#cb312-2" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>z</span></code></pre></div>
<pre><code>##            [,1]       [,2]       [,3]
## [1,]  1.6203124  1.5516260  1.4942336
## [2,]  1.6213524  1.5516332  1.5761658
## [3,]  4.0065304  4.0713699  3.8007847
## [4,] -0.2254835 -0.4765649 -0.3632563
## [5,] -0.5756517 -0.6255796 -0.4584634</code></pre>
<p>The example illustrates a number of features:</p>
<ol style="list-style-type: decimal">
<li><code>simulate(model, nodes)</code> is equivalent to
<code>model$simulate(nodes)</code>. You can use either, but the latter is
encouraged and the former may be deprecated inthe future.</li>
<li>Inputs like <code>"y[1:3]"</code> are automatically expanded into
<code>c("y[1]", "y[2]", "y[3]")</code>. In fact, simply <code>"y"</code> will be
expanded into all nodes within <code>y</code>.</li>
<li>An arbitrary number of nodes can be provided as a character
vector.</li>
<li>Simulations will be done in the order provided, so in practice
the nodes should often be obtained by functions such as
<code>getDependencies</code>. These return nodes in
topologically-sorted order, which means no node is manipulated before something
it depends on.</li>
<li>The data nodes <code>z</code> were not simulated into until
<code>includeData = TRUE</code> was used.</li>
</ol>
<p>Use of <code>calculate</code>, <code>calculateDiff</code> and <code>getLogProb</code> are similar to <code>simulate</code>,
except that they return a value (described above) and they have no <code>includeData</code> argument.</p>
</div>
</div>
<div id="sec:cdsimn-cdcalcn-cdget" class="section level3 hasAnchor" number="13.3.2">
<h3><span class="header-section-number">13.3.2</span> Pre-defined nimbleFunctions for operating on model nodes: <em>simNodes</em>, <em>calcNodes</em>, and <em>getLogProbNodes</em><a href="cha-using-models.html#sec:cdsimn-cdcalcn-cdget" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!---  Chris would still like to revisit this -- clarify when a user might use these and where to put this text. Main question is that if these are intended as building blocks, their only use is seemingly in R. If you use in run code, you might as well just put calculate()/simulate()/etc. directly in the run code since it will call the compiled nodeFunctions anyway. -->
<p><code>simNodes</code>, <code>calcNodes</code> and <code>getLogProbNodes</code> are basic nimbleFunctions that simulate, calculate, or get the log probabilities
(densities), respectively, of the same set of nodes each time they
are called. Each of these
takes a model and a character string of node names
as inputs. If <code>nodes</code> is left blank, then all the nodes of the model
are used.</p>
<p>For <code>simNodes</code>, the nodes provided will be topologically sorted to
simulate in the correct order. For <code>calcNodes</code> and <code>getLogProbNodes</code>,
the nodes will be sorted and dependent nodes will be included. Recall that
the calculations must be up to date (from a <code>calculate</code> call) for <code>getLogProbNodes</code>
to return the values you are probably looking for.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="cha-using-models.html#cb314-1" aria-hidden="true" tabindex="-1"></a>simpleModelCode <span class="ot">&lt;-</span> <span class="fu">nimbleCode</span>({</span>
<span id="cb314-2"><a href="cha-using-models.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>){</span>
<span id="cb314-3"><a href="cha-using-models.html#cb314-3" aria-hidden="true" tabindex="-1"></a>    x[i] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb314-4"><a href="cha-using-models.html#cb314-4" aria-hidden="true" tabindex="-1"></a>    y[i] <span class="sc">~</span> <span class="fu">dnorm</span>(x[i], <span class="dv">1</span>) <span class="co"># y depends on x</span></span>
<span id="cb314-5"><a href="cha-using-models.html#cb314-5" aria-hidden="true" tabindex="-1"></a>    z[i] <span class="sc">~</span> <span class="fu">dnorm</span>(y[i], <span class="dv">1</span>) <span class="co"># z depends on y</span></span>
<span id="cb314-6"><a href="cha-using-models.html#cb314-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># z conditionally independent of x</span></span>
<span id="cb314-7"><a href="cha-using-models.html#cb314-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb314-8"><a href="cha-using-models.html#cb314-8" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb314-9"><a href="cha-using-models.html#cb314-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-10"><a href="cha-using-models.html#cb314-10" aria-hidden="true" tabindex="-1"></a>simpleModel <span class="ot">&lt;-</span> <span class="fu">nimbleModel</span>(simpleModelCode, <span class="at">check =</span> <span class="cn">FALSE</span>)</span>
<span id="cb314-11"><a href="cha-using-models.html#cb314-11" aria-hidden="true" tabindex="-1"></a>cSimpleModel <span class="ot">&lt;-</span> <span class="fu">compileNimble</span>(simpleModel)</span>
<span id="cb314-12"><a href="cha-using-models.html#cb314-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-13"><a href="cha-using-models.html#cb314-13" aria-hidden="true" tabindex="-1"></a><span class="co"># simulates all the x&#39;s and y&#39;s</span></span>
<span id="cb314-14"><a href="cha-using-models.html#cb314-14" aria-hidden="true" tabindex="-1"></a>rSimXY <span class="ot">&lt;-</span> <span class="fu">simNodes</span>(simpleModel, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>) ) </span>
<span id="cb314-15"><a href="cha-using-models.html#cb314-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-16"><a href="cha-using-models.html#cb314-16" aria-hidden="true" tabindex="-1"></a><span class="co"># calls calculate on x and its dependents (y, but not z)</span></span>
<span id="cb314-17"><a href="cha-using-models.html#cb314-17" aria-hidden="true" tabindex="-1"></a>rCalcXDep <span class="ot">&lt;-</span> <span class="fu">calcNodes</span>(simpleModel, <span class="at">nodes =</span> <span class="st">&#39;x&#39;</span>)</span>
<span id="cb314-18"><a href="cha-using-models.html#cb314-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-19"><a href="cha-using-models.html#cb314-19" aria-hidden="true" tabindex="-1"></a><span class="co"># calls getLogProb on x&#39;s and y&#39;s</span></span>
<span id="cb314-20"><a href="cha-using-models.html#cb314-20" aria-hidden="true" tabindex="-1"></a>rGetLogProbXDep <span class="ot">&lt;-</span> <span class="fu">getLogProbNodes</span>(simpleModel,</span>
<span id="cb314-21"><a href="cha-using-models.html#cb314-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nodes =</span> <span class="st">&#39;x&#39;</span>)</span>
<span id="cb314-22"><a href="cha-using-models.html#cb314-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-23"><a href="cha-using-models.html#cb314-23" aria-hidden="true" tabindex="-1"></a><span class="co"># compiling the functions</span></span>
<span id="cb314-24"><a href="cha-using-models.html#cb314-24" aria-hidden="true" tabindex="-1"></a>cSimXY <span class="ot">&lt;-</span> <span class="fu">compileNimble</span>(rSimXY, <span class="at">project =</span> simpleModel)</span>
<span id="cb314-25"><a href="cha-using-models.html#cb314-25" aria-hidden="true" tabindex="-1"></a>cCalcXDep <span class="ot">&lt;-</span> <span class="fu">compileNimble</span>(rCalcXDep, <span class="at">project =</span> simpleModel)</span>
<span id="cb314-26"><a href="cha-using-models.html#cb314-26" aria-hidden="true" tabindex="-1"></a>cGetLogProbXDep <span class="ot">&lt;-</span> <span class="fu">compileNimble</span>(rGetLogProbXDep, <span class="at">project =</span> simpleModel)</span>
<span id="cb314-27"><a href="cha-using-models.html#cb314-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-28"><a href="cha-using-models.html#cb314-28" aria-hidden="true" tabindex="-1"></a>cSimpleModel<span class="sc">$</span>x</span></code></pre></div>
<pre><code>## [1] NA NA NA NA</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="cha-using-models.html#cb316-1" aria-hidden="true" tabindex="-1"></a>cSimpleModel<span class="sc">$</span>y</span></code></pre></div>
<pre><code>## [1] NA NA NA NA</code></pre>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="cha-using-models.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulating x and y</span></span>
<span id="cb318-2"><a href="cha-using-models.html#cb318-2" aria-hidden="true" tabindex="-1"></a>cSimXY<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb318-3"><a href="cha-using-models.html#cb318-3" aria-hidden="true" tabindex="-1"></a>cSimpleModel<span class="sc">$</span>x</span></code></pre></div>
<pre><code>## [1] -0.6589120  0.6605313 -0.0132557 -0.9314803</code></pre>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="cha-using-models.html#cb320-1" aria-hidden="true" tabindex="-1"></a>cSimpleModel<span class="sc">$</span>y</span></code></pre></div>
<pre><code>## [1]  0.5557771 -1.4278091 -0.5394082 -2.4728829</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="cha-using-models.html#cb322-1" aria-hidden="true" tabindex="-1"></a>cCalcXDep<span class="sc">$</span><span class="fu">run</span>()</span></code></pre></div>
<pre><code>## [1] -12.46535</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="cha-using-models.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gives correct answer because logProbs</span></span>
<span id="cb324-2"><a href="cha-using-models.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="co"># updated by &#39;calculate&#39; after simulation</span></span>
<span id="cb324-3"><a href="cha-using-models.html#cb324-3" aria-hidden="true" tabindex="-1"></a>cGetLogProbXDep<span class="sc">$</span><span class="fu">run</span>()</span></code></pre></div>
<pre><code>## [1] -12.46535</code></pre>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="cha-using-models.html#cb326-1" aria-hidden="true" tabindex="-1"></a>cSimXY<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb326-2"><a href="cha-using-models.html#cb326-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-3"><a href="cha-using-models.html#cb326-3" aria-hidden="true" tabindex="-1"></a><span class="co"># gives old answer because logProbs</span></span>
<span id="cb326-4"><a href="cha-using-models.html#cb326-4" aria-hidden="true" tabindex="-1"></a><span class="co"># not updated after &#39;simulate&#39;</span></span>
<span id="cb326-5"><a href="cha-using-models.html#cb326-5" aria-hidden="true" tabindex="-1"></a>cGetLogProbXDep<span class="sc">$</span><span class="fu">run</span>()</span></code></pre></div>
<pre><code>## [1] -12.46535</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="cha-using-models.html#cb328-1" aria-hidden="true" tabindex="-1"></a>cCalcXDep<span class="sc">$</span><span class="fu">run</span>()</span></code></pre></div>
<pre><code>## [1] -9.277808</code></pre>
</div>
<div id="sec:access-log-prob" class="section level3 hasAnchor" number="13.3.3">
<h3><span class="header-section-number">13.3.3</span> Accessing log probabilities via <em>logProb</em> variables<a href="cha-using-models.html#sec:access-log-prob" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<!---  at some point we might remove this as logProb variables might be viewed as private member data, but as PdV points out, these are genuinely useful to a user because they can be added as monitors separately from the associated variable -->
<p>For each variable that contains at least one stochastic node, NIMBLE generates a model variable with the prefix ‘logProb_’. In general users will not need to access these logProb variables directly but rather will use <code>getLogProb</code>. However, knowing they exist can be useful, in part because these variables can be monitored in an MCMC.</p>
<p>When the stochastic node is scalar, the
<code>logProb</code> variable will have the same size. For example:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="cha-using-models.html#cb330-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>logProb_y</span></code></pre></div>
<pre><code>## [1] NA NA NA NA NA</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="cha-using-models.html#cb332-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span><span class="fu">calculate</span>(<span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<pre><code>## [1] -11.02766</code></pre>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="cha-using-models.html#cb334-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>logProb_y</span></code></pre></div>
<pre><code>## [1] -2.087536 -2.085793 -2.489620 -2.166821 -2.197894</code></pre>
<p>Creation of <code>logProb</code> variables for stochastic multivariate nodes
is trickier, because they can represent an arbitrary block of a larger
variable. In general NIMBLE records the logProb values using
the lowest possible indices. For example, if <code>x[5:10, 15:20]</code>
follows a Wishart distribution, its log probability (density) value
will be stored in <code>logProb_x[5, 15]</code>. When possible, NIMBLE will
reduce the dimensions of the corresponding logProb variable. For
example, in</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="cha-using-models.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) x[i,] <span class="sc">~</span> <span class="fu">dmnorm</span>(mu[], prec[,])</span></code></pre></div>
<p><code>x</code> may be <span class="math inline">\(10 \times 20\)</span> (dimensions must be provided), but <code>logProb_x</code>
will be <span class="math inline">\(10 \times 1\)</span>. For the most part you do not need to worry about
how NIMBLE is storing the log probability values, because you can
always get them using <code>getLogProb</code>.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="26">
<li id="fn26"><p>Standard usage is <code>model$calculate(nodes)</code> but <code>calculate(model, nodes)</code> is synonymous.<a href="cha-using-models.html#fnref26" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cha-user-defined.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cha-data-structures.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["NimbleUserManual.pdf", "NimbleUserManual.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 3
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
