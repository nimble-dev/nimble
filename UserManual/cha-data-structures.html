<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 Data structures in NIMBLE | NimbleUserManual.knit</title>
  <meta name="description" content="This is the NIMBLE User Manual." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 Data structures in NIMBLE | NimbleUserManual.knit" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/nimble-icon.png" />
  <meta property="og:description" content="This is the NIMBLE User Manual." />
  <meta name="github-repo" content="nimble-dev/nimble" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 Data structures in NIMBLE | NimbleUserManual.knit" />
  
  <meta name="twitter:description" content="This is the NIMBLE User Manual." />
  <meta name="twitter:image" content="/nimble-icon.png" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cha-using-models.html"/>
<link rel="next" href="cha-progr-with-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<img src="./nimble-icon.png"
     width=100>
<li><a href="./cha-welcome-nimble.html">NIMBLE User Manual, Version 1.0.1</a></li>
<li><a href="https://github.com/nimble-dev/nimble">NIMBLE Development Team</a></li>
<li><a href="https://R-nimble.org">https://R-nimble.org</a></li>

<li class="divider"></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html"><i class="fa fa-check"></i><b>1</b> Welcome to NIMBLE</a>
<ul>
<li class="chapter" data-level="1.1" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html#sec:what-is-nimble"><i class="fa fa-check"></i><b>1.1</b> What does NIMBLE do?</a></li>
<li class="chapter" data-level="1.2" data-path="cha-welcome-nimble.html"><a href="cha-welcome-nimble.html#how-to-use-this-manual"><i class="fa fa-check"></i><b>1.2</b> How to use this manual</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html"><i class="fa fa-check"></i><b>2</b> Lightning introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:brief-example"><i class="fa fa-check"></i><b>2.1</b> A brief example</a></li>
<li class="chapter" data-level="2.2" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-model"><i class="fa fa-check"></i><b>2.2</b> Creating a model</a></li>
<li class="chapter" data-level="2.3" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:compiling-model"><i class="fa fa-check"></i><b>2.3</b> Compiling the model</a></li>
<li class="chapter" data-level="2.4" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:intro-runMCMC"><i class="fa fa-check"></i><b>2.4</b> One-line invocation of MCMC</a></li>
<li class="chapter" data-level="2.5" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-mcmc"><i class="fa fa-check"></i><b>2.5</b> Creating, compiling and running a basic MCMC configuration</a></li>
<li class="chapter" data-level="2.6" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:customizing-mcmc"><i class="fa fa-check"></i><b>2.6</b> Customizing the MCMC</a></li>
<li class="chapter" data-level="2.7" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:running-mcem"><i class="fa fa-check"></i><b>2.7</b> Running MCEM</a></li>
<li class="chapter" data-level="2.8" data-path="cha-lightning-intro.html"><a href="cha-lightning-intro.html#sec:creating-your-own"><i class="fa fa-check"></i><b>2.8</b> Creating your own functions</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html"><i class="fa fa-check"></i><b>3</b> More introduction</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#nimble-adopts-and-extends-the-bugs-language-for-specifying-models"><i class="fa fa-check"></i><b>3.1</b> NIMBLE adopts and extends the BUGS language for specifying models</a></li>
<li class="chapter" data-level="3.2" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#sec:nimble-lang-writ"><i class="fa fa-check"></i><b>3.2</b> nimbleFunctions for writing algorithms</a></li>
<li class="chapter" data-level="3.3" data-path="cha-more-introduction.html"><a href="cha-more-introduction.html#sec:nimble-algor-libr"><i class="fa fa-check"></i><b>3.3</b> The NIMBLE algorithm library</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html"><i class="fa fa-check"></i><b>4</b> Installing NIMBLE</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:requ-run-nimble"><i class="fa fa-check"></i><b>4.1</b> Requirements to run NIMBLE</a></li>
<li class="chapter" data-level="4.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:compiler"><i class="fa fa-check"></i><b>4.2</b> Installing a C++ compiler for NIMBLE to use</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#macos"><i class="fa fa-check"></i><b>4.2.1</b> MacOS</a></li>
<li class="chapter" data-level="4.2.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#linux"><i class="fa fa-check"></i><b>4.2.2</b> Linux</a></li>
<li class="chapter" data-level="4.2.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#windows"><i class="fa fa-check"></i><b>4.2.3</b> Windows</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#installing-the-nimble-package"><i class="fa fa-check"></i><b>4.3</b> Installing the NIMBLE package</a></li>
<li class="chapter" data-level="4.4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#troubleshooting-installation-problems"><i class="fa fa-check"></i><b>4.4</b> Troubleshooting installation problems</a></li>
<li class="chapter" data-level="4.5" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#customizing-your-installation"><i class="fa fa-check"></i><b>4.5</b> Customizing your installation</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#using-your-own-copy-of-eigen"><i class="fa fa-check"></i><b>4.5.1</b> Using your own copy of Eigen</a></li>
<li class="chapter" data-level="4.5.2" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#using-libnimble"><i class="fa fa-check"></i><b>4.5.2</b> Using libnimble</a></li>
<li class="chapter" data-level="4.5.3" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#sec:blas"><i class="fa fa-check"></i><b>4.5.3</b> BLAS and LAPACK</a></li>
<li class="chapter" data-level="4.5.4" data-path="cha-installing-nimble.html"><a href="cha-installing-nimble.html#customizing-compilation-of-the-nimble-generated-c"><i class="fa fa-check"></i><b>4.5.4</b> Customizing compilation of the NIMBLE-generated C++</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>II Models in NIMBLE</b></span></li>
<li class="chapter" data-level="5" data-path="cha-writing-models.html"><a href="cha-writing-models.html"><i class="fa fa-check"></i><b>5</b> Writing models in NIMBLE’s dialect of BUGS</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:supp-feat-bugs"><i class="fa fa-check"></i><b>5.1</b> Comparison to BUGS dialects supported by WinBUGS, OpenBUGS and JAGS</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#supported-features-of-bugs-and-jags"><i class="fa fa-check"></i><b>5.1.1</b> Supported features of BUGS and JAGS</a></li>
<li class="chapter" data-level="5.1.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:extensions-bugs"><i class="fa fa-check"></i><b>5.1.2</b> NIMBLE’s Extensions to BUGS and JAGS</a></li>
<li class="chapter" data-level="5.1.3" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:not-yet-supported"><i class="fa fa-check"></i><b>5.1.3</b> Not-supported features of BUGS and JAGS</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#writing-models"><i class="fa fa-check"></i><b>5.2</b> Writing models</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="cha-writing-models.html"><a href="cha-writing-models.html#declaring-stochastic-and-deterministic-nodes"><i class="fa fa-check"></i><b>5.2.1</b> Declaring stochastic and deterministic nodes</a></li>
<li class="chapter" data-level="5.2.2" data-path="cha-writing-models.html"><a href="cha-writing-models.html#sec:more-kinds-bugs"><i class="fa fa-check"></i><b>5.2.2</b> More kinds of BUGS declarations</a></li>
<li class="chapter" data-level="5.2.3" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:vectorized-versus-scalar-declarations"><i class="fa fa-check"></i><b>5.2.3</b> Vectorized versus scalar declarations</a></li>
<li class="chapter" data-level="5.2.4" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:dists-and-functions"><i class="fa fa-check"></i><b>5.2.4</b> Available distributions</a></li>
<li class="chapter" data-level="5.2.5" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:BUGS-lang-fxns"><i class="fa fa-check"></i><b>5.2.5</b> Available BUGS language functions</a></li>
<li class="chapter" data-level="5.2.6" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:BUGS-link"><i class="fa fa-check"></i><b>5.2.6</b> Available link functions</a></li>
<li class="chapter" data-level="5.2.7" data-path="cha-writing-models.html"><a href="cha-writing-models.html#subsec:trunc"><i class="fa fa-check"></i><b>5.2.7</b> Truncation, censoring, and constraints</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="cha-building-models.html"><a href="cha-building-models.html"><i class="fa fa-check"></i><b>6</b> Building and using models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="cha-building-models.html"><a href="cha-building-models.html#creating-model-objects"><i class="fa fa-check"></i><b>6.1</b> Creating model objects</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="cha-building-models.html"><a href="cha-building-models.html#using-nimblemodel-to-create-a-model"><i class="fa fa-check"></i><b>6.1.1</b> Using <em>nimbleModel</em> to create a model</a></li>
<li class="chapter" data-level="6.1.2" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:readBUGSmodel"><i class="fa fa-check"></i><b>6.1.2</b> Creating a model from standard BUGS and JAGS input files</a></li>
<li class="chapter" data-level="6.1.3" data-path="cha-building-models.html"><a href="cha-building-models.html#sub:multiple-instances"><i class="fa fa-check"></i><b>6.1.3</b> Making multiple instances from the same model definition</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:nodes-and-variables"><i class="fa fa-check"></i><b>6.2</b> NIMBLE models are objects you can query and manipulate</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:what-are-nodes-and-variables"><i class="fa fa-check"></i><b>6.2.1</b> What are variables and nodes?</a></li>
<li class="chapter" data-level="6.2.2" data-path="cha-building-models.html"><a href="cha-building-models.html#determining-the-nodes-and-variables-in-a-model"><i class="fa fa-check"></i><b>6.2.2</b> Determining the nodes and variables in a model</a></li>
<li class="chapter" data-level="6.2.3" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:accessing-nodes"><i class="fa fa-check"></i><b>6.2.3</b> Accessing nodes</a></li>
<li class="chapter" data-level="6.2.4" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:how-nodes-are"><i class="fa fa-check"></i><b>6.2.4</b> How nodes are named</a></li>
<li class="chapter" data-level="6.2.5" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:why-use-node"><i class="fa fa-check"></i><b>6.2.5</b> Why use node names?</a></li>
<li class="chapter" data-level="6.2.6" data-path="cha-building-models.html"><a href="cha-building-models.html#sec:cdisdata"><i class="fa fa-check"></i><b>6.2.6</b> Checking if a node holds data</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="cha-building-models.html"><a href="cha-building-models.html#using-models-in-parallel"><i class="fa fa-check"></i><b>6.3</b> Using models in parallel</a></li>
</ul></li>
<li class="part"><span><b>III Algorithms in NIMBLE</b></span></li>
<li class="chapter" data-level="7" data-path="cha-mcmc.html"><a href="cha-mcmc.html"><i class="fa fa-check"></i><b>7</b> MCMC</a>
<ul>
<li class="chapter" data-level="7.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:nimbleMCMC"><i class="fa fa-check"></i><b>7.1</b> One-line invocation of MCMC: <em>nimbleMCMC</em></a></li>
<li class="chapter" data-level="7.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-configuration"><i class="fa fa-check"></i><b>7.2</b> The MCMC configuration</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:default-mcmc-conf"><i class="fa fa-check"></i><b>7.2.1</b> Default MCMC configuration</a></li>
<li class="chapter" data-level="7.2.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:customizing-mcmc-conf"><i class="fa fa-check"></i><b>7.2.2</b> Customizing the MCMC configuration</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:build-compile-mcmc"><i class="fa fa-check"></i><b>7.3</b> Building and compiling the MCMC</a></li>
<li class="chapter" data-level="7.4" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:initMCMC"><i class="fa fa-check"></i><b>7.4</b> Initializing MCMC</a></li>
<li class="chapter" data-level="7.5" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:runMCMC"><i class="fa fa-check"></i><b>7.5</b> User-friendly execution of MCMC algorithms: <em>runMCMC</em></a></li>
<li class="chapter" data-level="7.6" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:executing-the-mcmc-algorithm"><i class="fa fa-check"></i><b>7.6</b> Running the MCMC</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-rerun"><i class="fa fa-check"></i><b>7.6.1</b> Rerunning versus restarting an MCMC</a></li>
<li class="chapter" data-level="7.6.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:sampler-time"><i class="fa fa-check"></i><b>7.6.2</b> Measuring sampler computation times: <em>getTimes</em></a></li>
<li class="chapter" data-level="7.6.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#assessing-the-adaption-process-of-rw-and-rw_block-samplers"><i class="fa fa-check"></i><b>7.6.3</b> Assessing the adaption process of <em>RW</em> and <em>RW_block</em> samplers</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:extracting-samples"><i class="fa fa-check"></i><b>7.7</b> Extracting MCMC samples</a></li>
<li class="chapter" data-level="7.8" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:WAIC"><i class="fa fa-check"></i><b>7.8</b> Calculating WAIC</a></li>
<li class="chapter" data-level="7.9" data-path="cha-mcmc.html"><a href="cha-mcmc.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>7.9</b> k-fold cross-validation</a></li>
<li class="chapter" data-level="7.10" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc"><i class="fa fa-check"></i><b>7.10</b> Variable selection using Reversible Jump MCMC</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc-indicator"><i class="fa fa-check"></i><b>7.10.1</b> Using indicator variables</a></li>
<li class="chapter" data-level="7.10.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:rjmcmc-no-indicator"><i class="fa fa-check"></i><b>7.10.2</b> Without indicator variables</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:samplers-provided"><i class="fa fa-check"></i><b>7.11</b> Samplers provided with NIMBLE</a>
<ul>
<li class="chapter" data-level="7.11.1" data-path="cha-mcmc.html"><a href="cha-mcmc.html#conjugate-gibbs-samplers"><i class="fa fa-check"></i><b>7.11.1</b> Conjugate (‘Gibbs’) samplers</a></li>
<li class="chapter" data-level="7.11.2" data-path="cha-mcmc.html"><a href="cha-mcmc.html#subsec:HMC"><i class="fa fa-check"></i><b>7.11.2</b> Hamiltonian Monte Carlo (HMC)</a></li>
<li class="chapter" data-level="7.11.3" data-path="cha-mcmc.html"><a href="cha-mcmc.html#customized-log-likelihood-evaluations-rw_llfunction-sampler"><i class="fa fa-check"></i><b>7.11.3</b> Customized log-likelihood evaluations: <em>RW_llFunction sampler</em></a></li>
<li class="chapter" data-level="7.11.4" data-path="cha-mcmc.html"><a href="cha-mcmc.html#particle-mcmc-sampler"><i class="fa fa-check"></i><b>7.11.4</b> Particle MCMC sampler</a></li>
</ul></li>
<li class="chapter" data-level="7.12" data-path="cha-mcmc.html"><a href="cha-mcmc.html#sec:mcmc-example-litters"><i class="fa fa-check"></i><b>7.12</b> Detailed MCMC example: <em>litters</em></a></li>
<li class="chapter" data-level="7.13" data-path="cha-mcmc.html"><a href="cha-mcmc.html#mcmc-suite-compare-mcmcs"><i class="fa fa-check"></i><b>7.13</b> Comparing different MCMCs with <em>MCMCsuite</em> and <em>compareMCMCs</em></a></li>
<li class="chapter" data-level="7.14" data-path="cha-mcmc.html"><a href="cha-mcmc.html#running-mcmc-chains-in-parallel"><i class="fa fa-check"></i><b>7.14</b> Running MCMC chains in parallel</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html"><i class="fa fa-check"></i><b>8</b> Sequential Monte Carlo, Particle MCMC, Iterated Filtering, and MCEM</a>
<ul>
<li class="chapter" data-level="8.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#particle-filters-sequential-monte-carlo-and-iterated-filtering"><i class="fa fa-check"></i><b>8.1</b> Particle filters / sequential Monte Carlo and iterated filtering</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#filtering-algorithms"><i class="fa fa-check"></i><b>8.1.1</b> Filtering algorithms</a></li>
<li class="chapter" data-level="8.1.2" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#sec:particle-mcmc"><i class="fa fa-check"></i><b>8.1.2</b> Particle MCMC (PMCMC)</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#monte-carlo-expectation-maximization-mcem"><i class="fa fa-check"></i><b>8.2</b> Monte Carlo Expectation Maximization (MCEM)</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="cha-algos-provided.html"><a href="cha-algos-provided.html#sec:estimate-mcem-cov"><i class="fa fa-check"></i><b>8.2.1</b> Estimating the asymptotic covariance From MCEM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="cha-spatial.html"><a href="cha-spatial.html"><i class="fa fa-check"></i><b>9</b> Spatial models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="cha-spatial.html"><a href="cha-spatial.html#intrinsic-gaussian-car-model-dcar_normal"><i class="fa fa-check"></i><b>9.1</b> Intrinsic Gaussian CAR model: <em>dcar_normal</em></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="cha-spatial.html"><a href="cha-spatial.html#specification-and-density"><i class="fa fa-check"></i><b>9.1.1</b> Specification and density</a></li>
<li class="chapter" data-level="9.1.2" data-path="cha-spatial.html"><a href="cha-spatial.html#example"><i class="fa fa-check"></i><b>9.1.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="cha-spatial.html"><a href="cha-spatial.html#proper-gaussian-car-model-dcar_proper"><i class="fa fa-check"></i><b>9.2</b> Proper Gaussian CAR model: <em>dcar_proper</em></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="cha-spatial.html"><a href="cha-spatial.html#specification-and-density-1"><i class="fa fa-check"></i><b>9.2.1</b> Specification and density</a></li>
<li class="chapter" data-level="9.2.2" data-path="cha-spatial.html"><a href="cha-spatial.html#example-1"><i class="fa fa-check"></i><b>9.2.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="cha-spatial.html"><a href="cha-spatial.html#sec:spatial-mcmc-sampling-car"><i class="fa fa-check"></i><b>9.3</b> MCMC Sampling of CAR models</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="cha-spatial.html"><a href="cha-spatial.html#initial-values"><i class="fa fa-check"></i><b>9.3.1</b> Initial values</a></li>
<li class="chapter" data-level="9.3.2" data-path="cha-spatial.html"><a href="cha-spatial.html#zero-neighbor-regions"><i class="fa fa-check"></i><b>9.3.2</b> Zero-neighbor regions</a></li>
<li class="chapter" data-level="9.3.3" data-path="cha-spatial.html"><a href="cha-spatial.html#zero-mean-constraint"><i class="fa fa-check"></i><b>9.3.3</b> Zero-mean constraint</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="cha-bnp.html"><a href="cha-bnp.html"><i class="fa fa-check"></i><b>10</b> Bayesian nonparametric models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:bnpmixtures"><i class="fa fa-check"></i><b>10.1</b> Bayesian nonparametric mixture models</a></li>
<li class="chapter" data-level="10.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:crp"><i class="fa fa-check"></i><b>10.2</b> Chinese Restaurant Process model</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="cha-bnp.html"><a href="cha-bnp.html#specification-and-density-2"><i class="fa fa-check"></i><b>10.2.1</b> Specification and density</a></li>
<li class="chapter" data-level="10.2.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:excrp"><i class="fa fa-check"></i><b>10.2.2</b> Example</a></li>
<li class="chapter" data-level="10.2.3" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:extensionscrp"><i class="fa fa-check"></i><b>10.2.3</b> Extensions</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:sb"><i class="fa fa-check"></i><b>10.3</b> Stick-breaking model</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="cha-bnp.html"><a href="cha-bnp.html#specification-and-function"><i class="fa fa-check"></i><b>10.3.1</b> Specification and function</a></li>
<li class="chapter" data-level="10.3.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:exsb"><i class="fa fa-check"></i><b>10.3.2</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="cha-bnp.html"><a href="cha-bnp.html#mcmc-sampling-of-bnp-models"><i class="fa fa-check"></i><b>10.4</b> MCMC sampling of BNP models</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:mcmcdcrp"><i class="fa fa-check"></i><b>10.4.1</b> Sampling CRP models</a></li>
<li class="chapter" data-level="10.4.2" data-path="cha-bnp.html"><a href="cha-bnp.html#sec:mcmcsb"><i class="fa fa-check"></i><b>10.4.2</b> Sampling stick-breaking models</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Programming with NIMBLE</b></span></li>
<li class="chapter" data-level="" data-path="overview.html"><a href="overview.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="11" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html"><i class="fa fa-check"></i><b>11</b> Writing simple nimbleFunctions</a>
<ul>
<li class="chapter" data-level="11.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:RC-intro"><i class="fa fa-check"></i><b>11.1</b> Introduction to simple nimbleFunctions</a></li>
<li class="chapter" data-level="11.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:r-fiunctions-implemented"><i class="fa fa-check"></i><b>11.2</b> R functions (or variants) implemented in NIMBLE</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#finding-help-for-nimbles-versions-of-r-functions"><i class="fa fa-check"></i><b>11.2.1</b> Finding help for NIMBLE’s versions of R functions</a></li>
<li class="chapter" data-level="11.2.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#basic-operations"><i class="fa fa-check"></i><b>11.2.2</b> Basic operations</a></li>
<li class="chapter" data-level="11.2.3" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:basic-math-linear"><i class="fa fa-check"></i><b>11.2.3</b> Math and linear algebra</a></li>
<li class="chapter" data-level="11.2.4" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:nimble-dist-funs"><i class="fa fa-check"></i><b>11.2.4</b> Distribution functions</a></li>
<li class="chapter" data-level="11.2.5" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:basic-flow-control"><i class="fa fa-check"></i><b>11.2.5</b> Flow control: <em>if-then-else</em>, <em>for</em>, <em>while</em>, and <em>stop</em></a></li>
<li class="chapter" data-level="11.2.6" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:print"><i class="fa fa-check"></i><b>11.2.6</b> <em>print</em> and <em>cat</em></a></li>
<li class="chapter" data-level="11.2.7" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:check-user-interr"><i class="fa fa-check"></i><b>11.2.7</b> Checking for user interrupts: <em>checkInterrupt</em></a></li>
<li class="chapter" data-level="11.2.8" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#optimization-optim-and-nimoptim"><i class="fa fa-check"></i><b>11.2.8</b> Optimization: <em>optim</em> and <em>nimOptim</em></a></li>
<li class="chapter" data-level="11.2.9" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:altern-keyw-some"><i class="fa fa-check"></i><b>11.2.9</b> ‘nim’ synonyms for some functions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:how-nimble-handles"><i class="fa fa-check"></i><b>11.3</b> How NIMBLE handles types of variables</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:nimbleList-RCFuns"><i class="fa fa-check"></i><b>11.3.1</b> nimbleList data structures</a></li>
<li class="chapter" data-level="11.3.2" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:how-types-work"><i class="fa fa-check"></i><b>11.3.2</b> How numeric types work</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:decl-argum-return"><i class="fa fa-check"></i><b>11.4</b> Declaring argument and return types</a></li>
<li class="chapter" data-level="11.5" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:comp-nimbl-pass"><i class="fa fa-check"></i><b>11.5</b> Compiled nimbleFunctions pass arguments by reference</a></li>
<li class="chapter" data-level="11.6" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:calling-external-code"><i class="fa fa-check"></i><b>11.6</b> Calling external compiled code</a></li>
<li class="chapter" data-level="11.7" data-path="cha-RCfunctions.html"><a href="cha-RCfunctions.html#sec:calling-R-code"><i class="fa fa-check"></i><b>11.7</b> Calling uncompiled R functions from compiled nimbleFunctions</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="cha-user-defined.html"><a href="cha-user-defined.html"><i class="fa fa-check"></i><b>12</b> Creating user-defined BUGS distributions and functions</a>
<ul>
<li class="chapter" data-level="12.1" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:user-functions"><i class="fa fa-check"></i><b>12.1</b> User-defined functions</a></li>
<li class="chapter" data-level="12.2" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:user-distributions"><i class="fa fa-check"></i><b>12.2</b> User-defined distributions</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="cha-user-defined.html"><a href="cha-user-defined.html#sec:registerDistributions"><i class="fa fa-check"></i><b>12.2.1</b> Using <em>registerDistributions</em> for alternative parameterizations and providing other information</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cha-using-models.html"><a href="cha-using-models.html"><i class="fa fa-check"></i><b>13</b> Working with NIMBLE models</a>
<ul>
<li class="chapter" data-level="13.1" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:accessing-variables"><i class="fa fa-check"></i><b>13.1</b> The variables and nodes in a NIMBLE model</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:get-nodes"><i class="fa fa-check"></i><b>13.1.1</b> Determining the nodes in a model</a></li>
<li class="chapter" data-level="13.1.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:introduced-nodes"><i class="fa fa-check"></i><b>13.1.2</b> Understanding lifted nodes</a></li>
<li class="chapter" data-level="13.1.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdgetdependencies"><i class="fa fa-check"></i><b>13.1.3</b> Determining dependencies in a model</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:nodeInfo"><i class="fa fa-check"></i><b>13.2</b> Accessing information about nodes and variables</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="cha-using-models.html"><a href="cha-using-models.html#getting-distributional-information-about-a-node"><i class="fa fa-check"></i><b>13.2.1</b> Getting distributional information about a node</a></li>
<li class="chapter" data-level="13.2.2" data-path="cha-using-models.html"><a href="cha-using-models.html#getting-information-about-a-distribution"><i class="fa fa-check"></i><b>13.2.2</b> Getting information about a distribution</a></li>
<li class="chapter" data-level="13.2.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:getParam"><i class="fa fa-check"></i><b>13.2.3</b> Getting distribution parameter values for a node</a></li>
<li class="chapter" data-level="13.2.4" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:getBound"><i class="fa fa-check"></i><b>13.2.4</b> Getting distribution bounds for a node</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdcalc-cdsim-cdgetl"><i class="fa fa-check"></i><b>13.3</b> Carrying out model calculations</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="cha-using-models.html"><a href="cha-using-models.html#core-model-operations-calculation-and-simulation"><i class="fa fa-check"></i><b>13.3.1</b> Core model operations: calculation and simulation</a></li>
<li class="chapter" data-level="13.3.2" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:cdsimn-cdcalcn-cdget"><i class="fa fa-check"></i><b>13.3.2</b> Pre-defined nimbleFunctions for operating on model nodes: <em>simNodes</em>, <em>calcNodes</em>, and <em>getLogProbNodes</em></a></li>
<li class="chapter" data-level="13.3.3" data-path="cha-using-models.html"><a href="cha-using-models.html#sec:access-log-prob"><i class="fa fa-check"></i><b>13.3.3</b> Accessing log probabilities via <em>logProb</em> variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="cha-data-structures.html"><a href="cha-data-structures.html"><i class="fa fa-check"></i><b>14</b> Data structures in NIMBLE</a>
<ul>
<li class="chapter" data-level="14.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:modelValues-struct"><i class="fa fa-check"></i><b>14.1</b> The modelValues data structure</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#creating-modelvalues-objects"><i class="fa fa-check"></i><b>14.1.1</b> Creating modelValues objects</a></li>
<li class="chapter" data-level="14.1.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:access-cont-modelv"><i class="fa fa-check"></i><b>14.1.2</b> Accessing contents of modelValues</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:nimbleLists"><i class="fa fa-check"></i><b>14.2</b> The nimbleList data structure</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:predef-nimbleLists"><i class="fa fa-check"></i><b>14.2.1</b> Pre-defined nimbleList types</a></li>
<li class="chapter" data-level="14.2.2" data-path="cha-data-structures.html"><a href="cha-data-structures.html#sec:eigen-nimFunctions"><i class="fa fa-check"></i><b>14.2.2</b> Using <em>eigen</em> and <em>svd</em> in nimbleFunctions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html"><i class="fa fa-check"></i><b>15</b> Writing nimbleFunctions to interact with models</a>
<ul>
<li class="chapter" data-level="15.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:writ-nimble-funct"><i class="fa fa-check"></i><b>15.1</b> Overview</a></li>
<li class="chapter" data-level="15.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-comp-nimbl"><i class="fa fa-check"></i><b>15.2</b> Using and compiling nimbleFunctions</a></li>
<li class="chapter" data-level="15.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#writing-setup-code"><i class="fa fa-check"></i><b>15.3</b> Writing setup code</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#useful-tools-for-setup-functions"><i class="fa fa-check"></i><b>15.3.1</b> Useful tools for setup functions</a></li>
<li class="chapter" data-level="15.3.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:access-modify-numer"><i class="fa fa-check"></i><b>15.3.2</b> Accessing and modifying numeric values from setup</a></li>
<li class="chapter" data-level="15.3.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#determining-numeric-types-in-nimblefunctions"><i class="fa fa-check"></i><b>15.3.3</b> Determining numeric types in nimbleFunctions</a></li>
<li class="chapter" data-level="15.3.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:determ-pers-texttts"><i class="fa fa-check"></i><b>15.3.4</b> Control of setup outputs</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:nimble-lang-comp"><i class="fa fa-check"></i><b>15.4</b> Writing run code</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:driv-models:-calc"><i class="fa fa-check"></i><b>15.4.1</b> Driving models: <em>calculate</em>, <em>calculateDiff</em>, <em>simulate</em>, <em>getLogProb</em></a></li>
<li class="chapter" data-level="15.4.2" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#getting-and-setting-variable-and-node-values"><i class="fa fa-check"></i><b>15.4.2</b> Getting and setting variable and node values</a></li>
<li class="chapter" data-level="15.4.3" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#getting-parameter-values-and-node-bounds"><i class="fa fa-check"></i><b>15.4.3</b> Getting parameter values and node bounds</a></li>
<li class="chapter" data-level="15.4.4" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:access-model-modelv"><i class="fa fa-check"></i><b>15.4.4</b> Using modelValues objects</a></li>
<li class="chapter" data-level="15.4.5" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-model-variable"><i class="fa fa-check"></i><b>15.4.5</b> Using model variables and modelValues in expressions</a></li>
<li class="chapter" data-level="15.4.6" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:incl-other-meth"><i class="fa fa-check"></i><b>15.4.6</b> Including other methods in a nimbleFunction</a></li>
<li class="chapter" data-level="15.4.7" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:using-other-nimbl"><i class="fa fa-check"></i><b>15.4.7</b> Using other nimbleFunctions</a></li>
<li class="chapter" data-level="15.4.8" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:virt-nimbl-nimbl"><i class="fa fa-check"></i><b>15.4.8</b> Virtual nimbleFunctions and nimbleFunctionLists</a></li>
<li class="chapter" data-level="15.4.9" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#character-objects"><i class="fa fa-check"></i><b>15.4.9</b> Character objects</a></li>
<li class="chapter" data-level="15.4.10" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:user-defined-data"><i class="fa fa-check"></i><b>15.4.10</b> User-defined data structures</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:user-samplers"><i class="fa fa-check"></i><b>15.5</b> Example: writing user-defined samplers to extend NIMBLE’s MCMC engine</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#user-defined-samplers-and-posterior-predictive-nodes"><i class="fa fa-check"></i><b>15.5.1</b> User-defined samplers and posterior predictive nodes</a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#copying-nimblefunctions-and-nimble-models"><i class="fa fa-check"></i><b>15.6</b> Copying nimbleFunctions (and NIMBLE models)</a></li>
<li class="chapter" data-level="15.7" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#sec:debugging"><i class="fa fa-check"></i><b>15.7</b> Debugging nimbleFunctions</a></li>
<li class="chapter" data-level="15.8" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#timing-nimblefunctions-with-run.time"><i class="fa fa-check"></i><b>15.8</b> Timing nimbleFunctions with <em>run.time</em></a></li>
<li class="chapter" data-level="15.9" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#clearing-and-unloading-compiled-objects"><i class="fa fa-check"></i><b>15.9</b> Clearing and unloading compiled objects</a></li>
<li class="chapter" data-level="15.10" data-path="cha-progr-with-models.html"><a href="cha-progr-with-models.html#reducing-memory-usage"><i class="fa fa-check"></i><b>15.10</b> Reducing memory usage</a></li>
</ul></li>
<li class="part"><span><b>V Automatic Derivatives in NIMBLE</b></span></li>
<li class="chapter" data-level="16" data-path="cha-AD.html"><a href="cha-AD.html"><i class="fa fa-check"></i><b>16</b> Automatic Derivatives</a>
<ul>
<li class="chapter" data-level="16.1" data-path="cha-AD.html"><a href="cha-AD.html#sec:use-derivs"><i class="fa fa-check"></i><b>16.1</b> How to turn on derivatives in a model</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="cha-AD.html"><a href="cha-AD.html#finish-setting-up-the-glmm-example"><i class="fa fa-check"></i><b>16.1.1</b> Finish setting up the GLMM example</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="cha-AD.html"><a href="cha-AD.html#how-to-use-laplace-approximation"><i class="fa fa-check"></i><b>16.2</b> How to use Laplace approximation</a></li>
<li class="chapter" data-level="16.3" data-path="cha-AD.html"><a href="cha-AD.html#how-to-support-derivatives-in-user-defined-functions-and-distributions"><i class="fa fa-check"></i><b>16.3</b> How to support derivatives in user-defined functions and distributions</a></li>
<li class="chapter" data-level="16.4" data-path="cha-AD.html"><a href="cha-AD.html#what-operations-are-and-arent-supported-for-ad"><i class="fa fa-check"></i><b>16.4</b> What operations are and aren’t supported for AD</a></li>
<li class="chapter" data-level="16.5" data-path="cha-AD.html"><a href="cha-AD.html#basics-of-obtaining-derivatives-in-nimblefunctions"><i class="fa fa-check"></i><b>16.5</b> Basics of obtaining derivatives in <code>nimbleFunctions</code></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="cha-AD.html"><a href="cha-AD.html#checking-derivatives-with-uncompiled-execution"><i class="fa fa-check"></i><b>16.5.1</b> Checking derivatives with uncompiled execution</a></li>
<li class="chapter" data-level="16.5.2" data-path="cha-AD.html"><a href="cha-AD.html#holding-some-local-variables-out-of-derivative-tracking"><i class="fa fa-check"></i><b>16.5.2</b> Holding some local variables out of derivative tracking</a></li>
<li class="chapter" data-level="16.5.3" data-path="cha-AD.html"><a href="cha-AD.html#using-ad-with-multiple-nimblefunctions"><i class="fa fa-check"></i><b>16.5.3</b> Using AD with multiple nimbleFunctions</a></li>
<li class="chapter" data-level="16.5.4" data-path="cha-AD.html"><a href="cha-AD.html#understanding-more-about-how-ad-works-taping-of-operations"><i class="fa fa-check"></i><b>16.5.4</b> Understanding more about how AD works: <em>taping</em> of operations</a></li>
<li class="chapter" data-level="16.5.5" data-path="cha-AD.html"><a href="cha-AD.html#resetting-a-nimderivs-call"><i class="fa fa-check"></i><b>16.5.5</b> Resetting a <code>nimDerivs</code> call</a></li>
<li class="chapter" data-level="16.5.6" data-path="cha-AD.html"><a href="cha-AD.html#a-note-on-performance-benchmarking"><i class="fa fa-check"></i><b>16.5.6</b> A note on performance benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="cha-AD.html"><a href="cha-AD.html#advanced-uses-double-taping"><i class="fa fa-check"></i><b>16.6</b> Advanced uses: double taping</a></li>
<li class="chapter" data-level="16.7" data-path="cha-AD.html"><a href="cha-AD.html#derivatives-involving-model-calculations"><i class="fa fa-check"></i><b>16.7</b> Derivatives involving model calculations</a>
<ul>
<li class="chapter" data-level="16.7.1" data-path="cha-AD.html"><a href="cha-AD.html#method-1-nimderivs-of-modelcalculate"><i class="fa fa-check"></i><b>16.7.1</b> Method 1: <code>nimDerivs</code> of <code>model$calculate</code></a></li>
<li class="chapter" data-level="16.7.2" data-path="cha-AD.html"><a href="cha-AD.html#method-2-nimderivs-of-a-method-that-calls-modelcalculate"><i class="fa fa-check"></i><b>16.7.2</b> Method 2: <code>nimDerivs</code> of a method that calls <code>model$calculate</code></a></li>
</ul></li>
<li class="chapter" data-level="16.8" data-path="cha-AD.html"><a href="cha-AD.html#sec:parameter-transform"><i class="fa fa-check"></i><b>16.8</b> Parameter transformations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="example-maximum-likelihood-estimation-using-optim-with-gradients-from-nimderivs..html"><a href="example-maximum-likelihood-estimation-using-optim-with-gradients-from-nimderivs..html"><i class="fa fa-check"></i><b>17</b> Example: maximum likelihood estimation using <code>optim</code> with gradients from <code>nimDerivs</code>.</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cha-data-structures" class="section level1 hasAnchor" number="14">
<h1><span class="header-section-number">Chapter 14</span> Data structures in NIMBLE<a href="cha-data-structures.html#cha-data-structures" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>NIMBLE provides several data structures useful for programming.</p>
<p>We’ll first describe <em>modelValues</em>, which are containers designed for
storing values for models. Then in Section <a href="cha-data-structures.html#sec:nimbleLists">14.2</a> we’ll describe <em>nimbleLists</em>, which have a similar purpose to lists in R, allowing you to store heterogeneous information in a single object.</p>
<p>modelValues can be created in either R or in nimbleFunction setup code. nimbleLists can be created in R code, in nimbleFunction setup code, and in nimbleFunction run code, from a nimbleList definition created in R or setup code. Once created, modelValues and <code>nimbleLists</code> can then be used either in R or in nimbleFunction setup or run code. If used in run code, they will be compiled along with the nimbleFunction.</p>
<div id="sec:modelValues-struct" class="section level2 hasAnchor" number="14.1">
<h2><span class="header-section-number">14.1</span> The modelValues data structure<a href="cha-data-structures.html#sec:modelValues-struct" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>modelValues are containers designed for
storing values for models. They may be used for model outputs or
model inputs. A modelValues object will contain <em>rows</em> of
variables. Each row contains one object of each variable, which may
be multivariate. The simplest way to build a
modelValues object is from a model object. This will create a
modelValues object with the same variables as the model. Although
they were motivated by models, one is free to set up a
modelValues with any variables one wants.</p>
<p>As with the material in the rest of this chapter, modelValues objects
will generally be used in nimbleFunctions that interact with models
(see Chapter <a href="cha-progr-with-models.html#cha-progr-with-models">15</a>)<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>. modelValues objects can
be defined either in setup code or separately in R (and then passed as
an argument to setup code). The modelValues object can then used in run code of nimbleFunctions.</p>
<div id="creating-modelvalues-objects" class="section level3 hasAnchor" number="14.1.1">
<h3><span class="header-section-number">14.1.1</span> Creating modelValues objects<a href="cha-data-structures.html#creating-modelvalues-objects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is a simple example of creating a modelValues object:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="cha-data-structures.html#cb337-1" aria-hidden="true" tabindex="-1"></a>pumpModelValues <span class="ot">=</span> <span class="fu">modelValues</span>(pumpModel, <span class="at">m =</span> <span class="dv">2</span>)</span>
<span id="cb337-2"><a href="cha-data-structures.html#cb337-2" aria-hidden="true" tabindex="-1"></a>pumpModel<span class="sc">$</span>x</span></code></pre></div>
<pre><code>##  [1]  5  1  5 14  3 19  1  1  4 22</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="cha-data-structures.html#cb339-1" aria-hidden="true" tabindex="-1"></a>pumpModelValues<span class="sc">$</span>x</span></code></pre></div>
<pre><code>## [[1]]
##  [1] NA NA NA NA NA NA NA NA NA NA
## 
## [[2]]
##  [1] NA NA NA NA NA NA NA NA NA NA</code></pre>
<p>In this example, <code>pumpModelValues</code> has the same variables as
<code>pumpModel</code>, and we set <code>pumpModelValues</code> to have <code>m = 2</code>
rows. As you can see, the rows are stored as elements of a list.</p>
<p>Alternatively, one can define a modelValues object manually by first defining a modelValues <em>configuration</em> via the
<code>modelValuesConf</code> function, and then creating an instance from that configuration, like this:
<!--- %    
%%    1. `vars`, which is a character vector of variable names, 
%      1. `type`, which is a character vector of the data types for each variable (`double' for real numbers, `integer' for integers) and  
%%        1. `size`, which is a list of vectors of the sizes in each dimension of each variable. The names of the list elements must match the names provided in `vars`.   --></p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="cha-data-structures.html#cb341-1" aria-hidden="true" tabindex="-1"></a>mvConf <span class="ot">=</span> <span class="fu">modelValuesConf</span>(<span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&#39;a&#39;</span>, <span class="st">&#39;b&#39;</span>, <span class="st">&#39;c&#39;</span>), </span>
<span id="cb341-2"><a href="cha-data-structures.html#cb341-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&#39;double&#39;</span>, <span class="st">&#39;int&#39;</span>, <span class="st">&#39;double&#39;</span>), </span>
<span id="cb341-3"><a href="cha-data-structures.html#cb341-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">size =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">2</span>, <span class="at">b =</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">c =</span> <span class="dv">1</span>) )</span>
<span id="cb341-4"><a href="cha-data-structures.html#cb341-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-5"><a href="cha-data-structures.html#cb341-5" aria-hidden="true" tabindex="-1"></a>customMV <span class="ot">=</span> <span class="fu">modelValues</span>(mvConf, <span class="at">m =</span> <span class="dv">2</span>)</span>
<span id="cb341-6"><a href="cha-data-structures.html#cb341-6" aria-hidden="true" tabindex="-1"></a>customMV<span class="sc">$</span>a</span></code></pre></div>
<pre><code>## [[1]]
## [1] NA NA
## 
## [[2]]
## [1] NA NA</code></pre>
<p>The arguments to <code>modelValuesConf</code> are matching lists of variable
names, types, and sizes. See <code>help(modelValuesConf)</code> for more
details. Note that in R execution, the types are not enforced. But
they will be the types created in C++ code during compilation, so they
should be specified carefully.</p>
<p>The object returned by <code>modelValues</code> is an uncompiled
modelValues object. When a nimbleFunction is compiled, any modelValues
objects it uses are also compiled. A NIMBLE model always contains a
modelValues object that it uses as a default location to store the values of its variables.</p>
<p>Here is an example where the <code>customMV</code> created above is used as
the setup argument for a nimbleFunction, which is then compiled. Its
compiled modelValues is then accessed with <code>$</code>.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="cha-data-structures.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simple nimbleFunction that uses a modelValues object</span></span>
<span id="cb343-2"><a href="cha-data-structures.html#cb343-2" aria-hidden="true" tabindex="-1"></a>resizeMV <span class="ot">&lt;-</span> <span class="fu">nimbleFunction</span>(</span>
<span id="cb343-3"><a href="cha-data-structures.html#cb343-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">setup =</span> <span class="cf">function</span>(mv){},</span>
<span id="cb343-4"><a href="cha-data-structures.html#cb343-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">run =</span> <span class="cf">function</span>(<span class="at">k =</span> <span class="fu">integer</span>() ){</span>
<span id="cb343-5"><a href="cha-data-structures.html#cb343-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">resize</span>(mv,k)})</span>
<span id="cb343-6"><a href="cha-data-structures.html#cb343-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-7"><a href="cha-data-structures.html#cb343-7" aria-hidden="true" tabindex="-1"></a>rResize <span class="ot">&lt;-</span> <span class="fu">resizeMV</span>(customMV)</span>
<span id="cb343-8"><a href="cha-data-structures.html#cb343-8" aria-hidden="true" tabindex="-1"></a>cResize <span class="ot">&lt;-</span> <span class="fu">compileNimble</span>(rResize)</span>
<span id="cb343-9"><a href="cha-data-structures.html#cb343-9" aria-hidden="true" tabindex="-1"></a>cResize<span class="sc">$</span><span class="fu">run</span>(<span class="dv">5</span>)</span>
<span id="cb343-10"><a href="cha-data-structures.html#cb343-10" aria-hidden="true" tabindex="-1"></a>cCustomMV <span class="ot">&lt;-</span> cResize<span class="sc">$</span>mv</span>
<span id="cb343-11"><a href="cha-data-structures.html#cb343-11" aria-hidden="true" tabindex="-1"></a><span class="co"># cCustomMV is a compiled modelValues object</span></span>
<span id="cb343-12"><a href="cha-data-structures.html#cb343-12" aria-hidden="true" tabindex="-1"></a>cCustomMV[[<span class="st">&#39;a&#39;</span>]]</span></code></pre></div>
<pre><code>## [[1]]
## [1] NA NA
## 
## [[2]]
## [1] NA NA
## 
## [[3]]
## [1] 0 0
## 
## [[4]]
## [1] 0 0
## 
## [[5]]
## [1] 0 0</code></pre>
<p>Compiled modelValues objects can be accessed and altered in all the
same ways as uncompiled ones. However, only uncompiled modelValues
can be used as arguments to setup code in nimbleFunctions.</p>
<p>In the example above a modelValues object is passed to setup code, but
a modelValues configuration can also be passed, with creation of
modelValues object(s) from the configuration done in setup code.</p>
</div>
<div id="sec:access-cont-modelv" class="section level3 hasAnchor" number="14.1.2">
<h3><span class="header-section-number">14.1.2</span> Accessing contents of modelValues<a href="cha-data-structures.html#sec:access-cont-modelv" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The values in a modelValues object can be accessed in several ways
from R, and in fewer ways from NIMBLE.</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="cha-data-structures.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sets the first row of a to (0, 1).  R only.</span></span>
<span id="cb345-2"><a href="cha-data-structures.html#cb345-2" aria-hidden="true" tabindex="-1"></a>customMV[[<span class="st">&#39;a&#39;</span>]][[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)   </span>
<span id="cb345-3"><a href="cha-data-structures.html#cb345-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-4"><a href="cha-data-structures.html#cb345-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sets the second row of a to (2, 3)</span></span>
<span id="cb345-5"><a href="cha-data-structures.html#cb345-5" aria-hidden="true" tabindex="-1"></a>customMV[<span class="st">&#39;a&#39;</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>)       </span>
<span id="cb345-6"><a href="cha-data-structures.html#cb345-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-7"><a href="cha-data-structures.html#cb345-7" aria-hidden="true" tabindex="-1"></a><span class="co"># can access subsets of each row</span></span>
<span id="cb345-8"><a href="cha-data-structures.html#cb345-8" aria-hidden="true" tabindex="-1"></a>customMV[<span class="st">&#39;a&#39;</span>, <span class="dv">2</span>][<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb345-9"><a href="cha-data-structures.html#cb345-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-10"><a href="cha-data-structures.html#cb345-10" aria-hidden="true" tabindex="-1"></a><span class="co"># accesses all values of &#39;a&#39;. Output is a list.  R only.</span></span>
<span id="cb345-11"><a href="cha-data-structures.html#cb345-11" aria-hidden="true" tabindex="-1"></a>customMV[[<span class="st">&#39;a&#39;</span>]]                  </span></code></pre></div>
<pre><code>## [[1]]
## [1] 0 1
## 
## [[2]]
## [1] 2 4</code></pre>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="cha-data-structures.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sets the first row of b to a matrix with values 1. R only.</span></span>
<span id="cb347-2"><a href="cha-data-structures.html#cb347-2" aria-hidden="true" tabindex="-1"></a>customMV[[<span class="st">&#39;b&#39;</span>]][[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)  </span>
<span id="cb347-3"><a href="cha-data-structures.html#cb347-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-4"><a href="cha-data-structures.html#cb347-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sets the second row of b.  R only.</span></span>
<span id="cb347-5"><a href="cha-data-structures.html#cb347-5" aria-hidden="true" tabindex="-1"></a>customMV[[<span class="st">&#39;b&#39;</span>]][[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)  </span>
<span id="cb347-6"><a href="cha-data-structures.html#cb347-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-7"><a href="cha-data-structures.html#cb347-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure the size of inputs is correct</span></span>
<span id="cb347-8"><a href="cha-data-structures.html#cb347-8" aria-hidden="true" tabindex="-1"></a><span class="co"># customMV[&#39;a&#39;, 1] &lt;- 1:10  &quot;</span></span>
<span id="cb347-9"><a href="cha-data-structures.html#cb347-9" aria-hidden="true" tabindex="-1"></a><span class="co"># problem: size of &#39;a&#39; is 2, not 10!</span></span>
<span id="cb347-10"><a href="cha-data-structures.html#cb347-10" aria-hidden="true" tabindex="-1"></a><span class="co"># will cause problems when compiling nimbleFunction using customMV</span></span></code></pre></div>
<p>Currently, only the syntax <code>customMV["a", 2]</code> works in the NIMBLE
language, not <code>customMV[["a"][[2]]</code>.</p>
<p>We can query and change the number of rows using <code>getsize</code> and
<code>resize</code>, respectively. These work in both R and NIMBLE. Note
that we don’t specify the variables in this case: all variables in a
modelValues object will have the same number of rows.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="cha-data-structures.html#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getsize</span>(customMV)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="cha-data-structures.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="fu">resize</span>(customMV, <span class="dv">3</span>)</span>
<span id="cb350-2"><a href="cha-data-structures.html#cb350-2" aria-hidden="true" tabindex="-1"></a><span class="fu">getsize</span>(customMV)</span></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="cha-data-structures.html#cb352-1" aria-hidden="true" tabindex="-1"></a>customMV<span class="sc">$</span>a</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0 1
## 
## [[2]]
## [1] 2 4
## 
## [[3]]
## [1] NA NA</code></pre>
<p>Often it is useful to convert a modelValues object to a matrix for use
in R. For example, we may want to convert MCMC output into a matrix,
for use with the <code>coda</code> package for processing MCMC samples, or into a
list. This can be done with the <code>as.matrix</code> and <code>as.list</code> methods for
modelValues objects, respectively. <code>as.matrix</code> will generate column
names from every scalar element of variables (e.g. “b[1, 1]” ,“b[2,
1]”, etc.). The rows of the modelValues will be the rows of the
matrix, with any matrices or arrays converted to a vector based on
column-major ordering.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="cha-data-structures.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(customMV, <span class="st">&#39;a&#39;</span>)   <span class="co"># convert &#39;a&#39;</span></span></code></pre></div>
<pre><code>##      a[1] a[2]
## [1,]    0    1
## [2,]    2    4
## [3,]   NA   NA</code></pre>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="cha-data-structures.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(customMV)        <span class="co"># convert all variables</span></span></code></pre></div>
<pre><code>##      a[1] a[2] b[1, 1] b[2, 1] b[1, 2] b[2, 2] c[1]
## [1,]    0    1       1       1       1       1   NA
## [2,]    2    4       2       2       2       2   NA
## [3,]   NA   NA      NA      NA      NA      NA   NA</code></pre>
<p><code>as.list</code> will return a list with an element for each variable. Each
element will be an array of the same size and shape as the variable
with an additional index for the iteration (e.g., MCMC iteration when used for
MCMC output). By default iteration is the first index, but it
can be the last if needed.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="cha-data-structures.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(customMV, <span class="st">&#39;a&#39;</span>)    <span class="co"># get only &#39;a&#39;</span></span></code></pre></div>
<pre><code>## $a
##      [,1] [,2]
## [1,]    0    1
## [2,]    2    4
## [3,]   NA   NA</code></pre>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="cha-data-structures.html#cb360-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(customMV)         <span class="co"># get all variables</span></span></code></pre></div>
<pre><code>## $a
##      [,1] [,2]
## [1,]    0    1
## [2,]    2    4
## [3,]   NA   NA
## 
## $b
## , , 1
## 
##      [,1] [,2]
## [1,]    1    1
## [2,]    2    2
## [3,]   NA   NA
## 
## , , 2
## 
##      [,1] [,2]
## [1,]    1    1
## [2,]    2    2
## [3,]   NA   NA
## 
## 
## $c
##      [,1]
## [1,]   NA
## [2,]   NA
## [3,]   NA</code></pre>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="cha-data-structures.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.list</span>(customMV, <span class="st">&#39;a&#39;</span>, <span class="at">iterationAsLastIndex =</span> <span class="cn">TRUE</span>) <span class="co"># put iteration in last index</span></span></code></pre></div>
<pre><code>## $a
##      [,1] [,2] [,3]
## [1,]    0    2   NA
## [2,]    1    4   NA</code></pre>
<p>If a variable is a scalar, using <code>unlist</code> in R to extract all rows as a vector can be useful.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="cha-data-structures.html#cb364-1" aria-hidden="true" tabindex="-1"></a>customMV[<span class="st">&#39;c&#39;</span>, <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb364-2"><a href="cha-data-structures.html#cb364-2" aria-hidden="true" tabindex="-1"></a>customMV[<span class="st">&#39;c&#39;</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb364-3"><a href="cha-data-structures.html#cb364-3" aria-hidden="true" tabindex="-1"></a>customMV[<span class="st">&#39;c&#39;</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb364-4"><a href="cha-data-structures.html#cb364-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unlist</span>(customMV[<span class="st">&#39;c&#39;</span>, ])</span></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>Once we have a modelValues object, we can see the structure of its
contents via the <code>varNames</code> and <code>sizes</code> components of the object.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="cha-data-structures.html#cb366-1" aria-hidden="true" tabindex="-1"></a>customMV<span class="sc">$</span>varNames</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot;</code></pre>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="cha-data-structures.html#cb368-1" aria-hidden="true" tabindex="-1"></a>customMV<span class="sc">$</span>sizes</span></code></pre></div>
<pre><code>## $a
## [1] 2
## 
## $b
## [1] 2 2
## 
## $c
## [1] 1</code></pre>
<p>As with most NIMBLE objects, modelValues are passed by reference, not
by value. That means any modifications of modelValues objects in
either R functions or nimbleFunctions will persist outside of the
function. This allows for more efficient computation, as stored values
are immediately shared among nimbleFunctions.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="cha-data-structures.html#cb370-1" aria-hidden="true" tabindex="-1"></a>alter_a <span class="ot">&lt;-</span> <span class="cf">function</span>(mv){</span>
<span id="cb370-2"><a href="cha-data-structures.html#cb370-2" aria-hidden="true" tabindex="-1"></a>  mv[<span class="st">&#39;a&#39;</span>,<span class="dv">1</span>][<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb370-3"><a href="cha-data-structures.html#cb370-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb370-4"><a href="cha-data-structures.html#cb370-4" aria-hidden="true" tabindex="-1"></a>customMV[<span class="st">&#39;a&#39;</span>, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 0 1</code></pre>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="cha-data-structures.html#cb372-1" aria-hidden="true" tabindex="-1"></a><span class="fu">alter_a</span>(customMV)</span>
<span id="cb372-2"><a href="cha-data-structures.html#cb372-2" aria-hidden="true" tabindex="-1"></a>customMV[<span class="st">&#39;a&#39;</span>,<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 1 1</code></pre>
<p>However, when you retrieve a variable from a modelValues object, the result is a standard R list, which is subsequently passed by value, as usual in R.</p>
<div id="automating-calculation-and-simulation-using-modelvalues" class="section level4 hasAnchor" number="14.1.2.1">
<h4><span class="header-section-number">14.1.2.1</span> Automating calculation and simulation using modelValues<a href="cha-data-structures.html#automating-calculation-and-simulation-using-modelvalues" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<!---  At some point Chris would still  like to discuss when a user would be expected to use this (e.g., we could mention a use case), though he thinks this is more clear than simNodes/calcNodes. -->
<p>The nimbleFunctions <code>simNodesMV</code>, <code>calcNodesMV</code>, and <code>getLogProbsMV</code>
can be used to operate on a model based on rows in a modelValues object.
For example,
<code>simNodesMV</code> will simulate in the model multiple times and record
each simulation in a row of its modelValues. <code>calcNodesMV</code> and
<code>getLogProbsMV</code> iterate over the rows of a modelValues, copy the
nodes into the model, and then do their job of calculating or
collecting log probabilities (densities), respectively. Each of these
returns a numeric vector with the summed log probabilities of the
chosen nodes from each row. <code>calcNodesMV</code> will
save the log probabilities back into the modelValues object if
<code>saveLP = TRUE</code>, a run-time argument.</p>
<p>Here are some examples:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="cha-data-structures.html#cb374-1" aria-hidden="true" tabindex="-1"></a>mv <span class="ot">&lt;-</span> <span class="fu">modelValues</span>(simpleModel)</span>
<span id="cb374-2"><a href="cha-data-structures.html#cb374-2" aria-hidden="true" tabindex="-1"></a>rSimManyXY <span class="ot">&lt;-</span> <span class="fu">simNodesMV</span>(simpleModel, <span class="at">nodes =</span> <span class="fu">c</span>(<span class="st">&#39;x&#39;</span>, <span class="st">&#39;y&#39;</span>), <span class="at">mv =</span> mv)</span>
<span id="cb374-3"><a href="cha-data-structures.html#cb374-3" aria-hidden="true" tabindex="-1"></a>rCalcManyXDeps <span class="ot">&lt;-</span> <span class="fu">calcNodesMV</span>(simpleModel, <span class="at">nodes =</span> <span class="st">&#39;x&#39;</span>, <span class="at">mv =</span> mv)</span>
<span id="cb374-4"><a href="cha-data-structures.html#cb374-4" aria-hidden="true" tabindex="-1"></a>rGetLogProbMany <span class="ot">&lt;-</span> <span class="fu">getLogProbNodesMV</span>(simpleModel, <span class="at">nodes =</span> <span class="st">&#39;x&#39;</span>, <span class="at">mv =</span> mv)</span>
<span id="cb374-5"><a href="cha-data-structures.html#cb374-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-6"><a href="cha-data-structures.html#cb374-6" aria-hidden="true" tabindex="-1"></a>cSimManyXY <span class="ot">&lt;-</span> <span class="fu">compileNimble</span>(rSimManyXY, <span class="at">project =</span> simpleModel)</span>
<span id="cb374-7"><a href="cha-data-structures.html#cb374-7" aria-hidden="true" tabindex="-1"></a>cCalcManyXDeps <span class="ot">&lt;-</span> <span class="fu">compileNimble</span>(rCalcManyXDeps, <span class="at">project =</span> simpleModel)</span>
<span id="cb374-8"><a href="cha-data-structures.html#cb374-8" aria-hidden="true" tabindex="-1"></a>cGetLogProbMany <span class="ot">&lt;-</span> <span class="fu">compileNimble</span>(rGetLogProbMany, <span class="at">project =</span> simpleModel)</span>
<span id="cb374-9"><a href="cha-data-structures.html#cb374-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb374-10"><a href="cha-data-structures.html#cb374-10" aria-hidden="true" tabindex="-1"></a>cSimManyXY<span class="sc">$</span><span class="fu">run</span>(<span class="at">m =</span> <span class="dv">5</span>) <span class="co"># simulating 5 times</span></span>
<span id="cb374-11"><a href="cha-data-structures.html#cb374-11" aria-hidden="true" tabindex="-1"></a>cCalcManyXDeps<span class="sc">$</span><span class="fu">run</span>(<span class="at">saveLP =</span> <span class="cn">TRUE</span>) <span class="co"># calculating </span></span></code></pre></div>
<pre><code>## [1] -18.52723 -14.93433 -23.21395 -22.64131 -12.31624</code></pre>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="cha-data-structures.html#cb376-1" aria-hidden="true" tabindex="-1"></a>cGetLogProbMany<span class="sc">$</span><span class="fu">run</span>() <span class="co">#</span></span></code></pre></div>
<pre><code>## [1] -18.52723 -14.93433 -23.21395 -22.64131 -12.31624</code></pre>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="cha-data-structures.html#cb378-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(cSimManyXY<span class="sc">$</span>mv) <span class="co"># extract simulated values</span></span></code></pre></div>
</div>
</div>
</div>
<div id="sec:nimbleLists" class="section level2 hasAnchor" number="14.2">
<h2><span class="header-section-number">14.2</span> The nimbleList data structure<a href="cha-data-structures.html#sec:nimbleLists" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>nimbleLists provide a container for storing different types of objects in NIMBLE, similar to the list data structure in R. Before a nimbleList can be created and used, a <em>definition</em><a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a> for that nimbleList must be created that provides the names, types, and dimensions of the elements in the nimbleList. nimbleList definitions must be created in R (either in R’s global environment or in setup code), but the nimbleList
instances can be created in run code.</p>
<p>Unlike lists in R, nimbleLists must have the names and types of all list elements provided by a definition before the list can be used. A nimbleList definition can be made by using the <code>nimbleList</code> function in one of two manners. The first manner is to provide the <code>nimbleList</code> function with a series of expressions of the form <code>name = type(nDim)</code>, similar to the specification of run-time arguments to nimbleFunctions. The types allowed for a nimbleList are the same as those allowed as run-time arguments to a nimbleFunction, described in Section <a href="cha-RCfunctions.html#sec:decl-argum-return">11.4</a>. For example, the following line of code creates a nimbleList definition with two elements: <code>x</code>, which is a scalar integer, and <code>Y</code>, which is a matrix of doubles.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="cha-data-structures.html#cb379-1" aria-hidden="true" tabindex="-1"></a> exampleNimListDef <span class="ot">&lt;-</span> <span class="fu">nimbleList</span>(<span class="at">x =</span> <span class="fu">integer</span>(<span class="dv">0</span>), <span class="at">Y =</span> <span class="fu">double</span>(<span class="dv">2</span>))</span></code></pre></div>
<p>The second method of creating a nimbleList definition is by providing an R list of <em>nimbleType</em> objects to the <code>nimbleList()</code> function. A nimbleType object can be created using the <code>nimbleType</code> function, which must be provided with three arguments: the <code>name</code> of the element being created, the <code>type</code> of the element being created, and the <code>dim</code> of the element being created. For example, the following code creates a list with two nimbleType objects and uses these objects to create a nimbleList definition.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="cha-data-structures.html#cb380-1" aria-hidden="true" tabindex="-1"></a>nimbleListTypes <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">nimbleType</span>(<span class="at">name =</span> <span class="st">&#39;x&#39;</span>, <span class="at">type =</span> <span class="st">&#39;integer&#39;</span>, <span class="at">dim =</span> <span class="dv">0</span>),</span>
<span id="cb380-2"><a href="cha-data-structures.html#cb380-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">nimbleType</span>(<span class="at">name =</span> <span class="st">&#39;Y&#39;</span>, <span class="at">type =</span> <span class="st">&#39;double&#39;</span>, <span class="at">dim =</span> <span class="dv">2</span>))</span>
<span id="cb380-3"><a href="cha-data-structures.html#cb380-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-4"><a href="cha-data-structures.html#cb380-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># this nimbleList definition is identical to the one created above</span></span>
<span id="cb380-5"><a href="cha-data-structures.html#cb380-5" aria-hidden="true" tabindex="-1"></a> exampleNimListDef2 <span class="ot">&lt;-</span> <span class="fu">nimbleList</span>(nimbleListTypes)</span></code></pre></div>
<p>Creating definitions using a list of <code>nimbleType</code>s can be useful, as it allows for programmatic generation of nimbleList elements.</p>
<p>Once a nimbleList definition has been created, new instances of nimbleLists can be made from that definition using the <code>new</code> member function. The <code>new</code> function can optionally take initial values for the list elements as arguments. Below, we create a new nimbleList from our <code>exampleNimListDef</code> and specify values for the two elements of our list:</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="cha-data-structures.html#cb381-1" aria-hidden="true" tabindex="-1"></a> exampleNimList <span class="ot">&lt;-</span> exampleNimListDef<span class="sc">$</span><span class="fu">new</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">Y =</span> <span class="fu">diag</span>(<span class="dv">2</span>))</span></code></pre></div>
<p>Once created, nimbleList elements can be accessed using the <code>$</code> operator, just as with lists in R. For example, the value of the <code>x</code> element of our <code>exampleNimbleList</code> can be set to <code>7</code> using</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="cha-data-structures.html#cb382-1" aria-hidden="true" tabindex="-1"></a> exampleNimList<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="dv">7</span></span></code></pre></div>
<p>nimbleList definitions can be created either in R’s global environment or in <code>setup</code> code of a nimbleFunction. Once a nimbleList definition has been made, new instances of nimbleLists can be created using the <code>new</code> function in R’s global environment, in setup code, or in run code of a nimbleFunction.</p>
<p>nimbleLists can also be passed as arguments to run code of nimbleFunctions and returned from nimbleFunctions. To use a nimbleList as a run function argument, the name of the nimbleList definition should be provided as the argument type, with a set of parentheses following. To return a nimbleList from the run code of a nimbleFunction, the <code>returnType</code> of that function should be the name of the nimbleList definition, again using a following set of parentheses.</p>
<p>Below, we demonstrate a function that takes the <code>exampleNimList</code> as an argument, modifies its <code>Y</code> element, and returns the nimbleList.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="cha-data-structures.html#cb383-1" aria-hidden="true" tabindex="-1"></a>mynf <span class="ot">&lt;-</span> <span class="fu">nimbleFunction</span>(</span>
<span id="cb383-2"><a href="cha-data-structures.html#cb383-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">run =</span> <span class="cf">function</span>(<span class="at">vals =</span> <span class="fu">exampleNimListDef</span>()){</span>
<span id="cb383-3"><a href="cha-data-structures.html#cb383-3" aria-hidden="true" tabindex="-1"></a>    onesMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">value =</span> <span class="dv">1</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb383-4"><a href="cha-data-structures.html#cb383-4" aria-hidden="true" tabindex="-1"></a>    vals<span class="sc">$</span>Y  <span class="ot">&lt;-</span> onesMatrix</span>
<span id="cb383-5"><a href="cha-data-structures.html#cb383-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">returnType</span>(<span class="fu">exampleNimListDef</span>())</span>
<span id="cb383-6"><a href="cha-data-structures.html#cb383-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(vals)</span>
<span id="cb383-7"><a href="cha-data-structures.html#cb383-7" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb383-8"><a href="cha-data-structures.html#cb383-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb383-9"><a href="cha-data-structures.html#cb383-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pass exampleNimList as argument to mynf</span></span>
<span id="cb383-10"><a href="cha-data-structures.html#cb383-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mynf</span>(exampleNimList)</span></code></pre></div>
<pre><code>## nimbleList object of type nfRefClass_59
## Field &quot;x&quot;:
## [1] 7
## Field &quot;Y&quot;:
##      [,1] [,2]
## [1,]    1    1
## [2,]    1    1</code></pre>
<p>nimbleList arguments to run functions are passed by reference – this means that if an element of a nimbleList argument is modified within a function, that element will remain modified when the function has finished running. To see this, we can inspect the value of the <code>Y</code> element of the <code>exampleNimList</code> object and see that it has been modified.</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="cha-data-structures.html#cb385-1" aria-hidden="true" tabindex="-1"></a>exampleNimList<span class="sc">$</span>Y</span></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    1    1
## [2,]    1    1</code></pre>
<p>In addition to storing basic data types, nimbleLists can also store other nimbleLists. To achieve this, we must create a nimbleList definition that declares the types of nested nimbleLists a nimbleList will store. Below, we create two types of nimbleLists: the first, named <code>innerNimList</code>, will be stored inside the second, named <code>outerNimList</code>:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="cha-data-structures.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first, create definitions for both inner and outer nimbleLists</span></span>
<span id="cb387-2"><a href="cha-data-structures.html#cb387-2" aria-hidden="true" tabindex="-1"></a>innerNimListDef <span class="ot">&lt;-</span> <span class="fu">nimbleList</span>(<span class="at">someText =</span> <span class="fu">character</span>(<span class="dv">0</span>))</span>
<span id="cb387-3"><a href="cha-data-structures.html#cb387-3" aria-hidden="true" tabindex="-1"></a>outerNimListDef <span class="ot">&lt;-</span> <span class="fu">nimbleList</span>(<span class="at">xList =</span> <span class="fu">innerNimListDef</span>(),</span>
<span id="cb387-4"><a href="cha-data-structures.html#cb387-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">z =</span> <span class="fu">double</span>(<span class="dv">0</span>))</span>
<span id="cb387-5"><a href="cha-data-structures.html#cb387-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-6"><a href="cha-data-structures.html#cb387-6" aria-hidden="true" tabindex="-1"></a><span class="co"># then, create outer nimbleList</span></span>
<span id="cb387-7"><a href="cha-data-structures.html#cb387-7" aria-hidden="true" tabindex="-1"></a>outerNimList <span class="ot">&lt;-</span> outerNimListDef<span class="sc">$</span><span class="fu">new</span>(<span class="at">z =</span> <span class="fl">3.14</span>)</span>
<span id="cb387-8"><a href="cha-data-structures.html#cb387-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-9"><a href="cha-data-structures.html#cb387-9" aria-hidden="true" tabindex="-1"></a><span class="co"># access element of inner nimbleList</span></span>
<span id="cb387-10"><a href="cha-data-structures.html#cb387-10" aria-hidden="true" tabindex="-1"></a>outerNimList<span class="sc">$</span>xList<span class="sc">$</span>someText <span class="ot">&lt;-</span> <span class="st">&quot;hello, world&quot;</span></span></code></pre></div>
<p>Note that definitions for inner, or nested, nimbleLists must be created before the definition for an outer nimbleList.</p>
<div id="sec:predef-nimbleLists" class="section level3 hasAnchor" number="14.2.1">
<h3><span class="header-section-number">14.2.1</span> Pre-defined nimbleList types<a href="cha-data-structures.html#sec:predef-nimbleLists" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Several types of nimbleLists are predefined in NIMBLE for use with particular kinds of nimbleFunctions.</p>
<ul>
<li><code>eigenNimbleList</code> and <code>svdNimbleList</code> are the return types of the <code>eigen</code> and <code>svd</code> functions (Section @ref(sec:eigen-nimFunctions}).</li>
<li><code>waicNimbleList</code> is the type provided for WAIC output from an MCMC.</li>
<li><code>waicDetailsNimbleList</code> is the type provided for detailed WAIC output from an MCMC.</li>
<li><code>optimResultNimbleList</code> is the return type of <code>nimOptim</code>.</li>
<li><code>optimControlNimbleList</code> is the type for the control list input to <code>nimOptim</code>.</li>
</ul>
</div>
<div id="sec:eigen-nimFunctions" class="section level3 hasAnchor" number="14.2.2">
<h3><span class="header-section-number">14.2.2</span> Using <em>eigen</em> and <em>svd</em> in nimbleFunctions<a href="cha-data-structures.html#sec:eigen-nimFunctions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>NIMBLE has two linear algebra functions that return nimbleLists. The <code>eigen</code> function takes a symmetic matrix, <code>x</code>, as an argument and returns a nimbleList of type <code>eigenNimbleList</code>. nimbleLists of type <code>eigenNimbleList</code> have two elements: <code>values</code>, a vector with the eigenvalues of <code>x</code>, and <code>vectors</code>, a square matrix with the same dimension as <code>x</code> whose columns are the eigenvectors of <code>x</code>. The <code>eigen</code> function has two additional arguments: <code>symmetric</code> and <code>only.values</code>. The <code>symmetric</code> argument can be used to specify if <code>x</code> is a symmetric matrix or not. If <code>symmetric = FALSE</code> (the default value), <code>x</code> will be checked for symmetry. Eigendecompositions in NIMBLE for symmetric matrices are both faster and more accurate. Additionally, eigendecompostions of non-symmetric matrices can have complex entries, which are not supported by NIMBLE. If a complex entry is detected, NIMBLE will issue a warning and that entry will be set to <code>NaN</code>. The <code>only.values</code> arument defaults to <code>FALSE</code>. If <code>only.values = TRUE</code>, the <code>eigen</code> function will not calculate the eigenvectors of <code>x</code>, leaving the <code>vectors</code> nimbleList element empty. This can reduce calculation time if only the eigenvalues of <code>x</code> are needed.</p>
<p>The <code>svd</code> function takes an <span class="math inline">\(n \times p\)</span> matrix <code>x</code> as an argument, and returns a nimbleList of type <code>svdNimbleList</code>. nimbleLists of type <code>svdNimbleList</code> have three elements: <code>d</code>, a vector with the singular values of <code>x</code>, <code>u</code> a matrix with the left singular vectors of <code>x</code>, and <code>v</code>, a matrix with the right singular vectors of <code>x</code>. The <code>svd</code> function has an optional argument <code>vectors</code> which defaults to a value of <code>"full"</code>. The <code>vectors</code> argument can be used to specify the number of singular vectors that are returned. If <code>vectors = "full"</code>, <code>v</code> will be an <span class="math inline">\(n \times n\)</span> matrix and <code>u</code> will be an <span class="math inline">\(p \times p\)</span> matrix. If <code>vectors = "thin"</code>, <code>v</code> will be an<span class="math inline">\(n \times m\)</span> matrix, where <span class="math inline">\(m = \min(n,p)\)</span>, and <code>u</code> will be an <span class="math inline">\(m \times p\)</span> matrix. If <code>vectors = "none"</code>, the <code>u</code> and <code>v</code> elements of the returned nimbleList will not be populated.</p>
<p>nimbleLists created by either <code>eigen</code> or <code>svd</code> can be returned from a nimbleFunction, using <code>returnType(eigenNimbleList())</code> or <code>returnType(svdNimbleList())</code> respectively. nimbleLists created by <code>eigen</code> and <code>svd</code> can also be used within other nimbleLists by specifying the nimbleList element types as <code>eigenNimbleList()</code> and <code>svdNimbleList()</code>. The below example demonstrates the use of <code>eigen</code> and <code>svd</code> within a nimbleFunction.</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="cha-data-structures.html#cb388-1" aria-hidden="true" tabindex="-1"></a>eigenListFunctionGenerator <span class="ot">&lt;-</span> <span class="fu">nimbleFunction</span>(</span>
<span id="cb388-2"><a href="cha-data-structures.html#cb388-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">setup =</span> <span class="cf">function</span>(){</span>
<span id="cb388-3"><a href="cha-data-structures.html#cb388-3" aria-hidden="true" tabindex="-1"></a>    demoMatrix <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">4</span>) <span class="sc">+</span> <span class="dv">2</span></span>
<span id="cb388-4"><a href="cha-data-structures.html#cb388-4" aria-hidden="true" tabindex="-1"></a>    eigenAndSvdListDef <span class="ot">&lt;-</span> <span class="fu">nimbleList</span>(<span class="at">demoEigenList =</span> <span class="fu">eigenNimbleList</span>(), </span>
<span id="cb388-5"><a href="cha-data-structures.html#cb388-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">demoSvdList =</span> <span class="fu">svdNimbleList</span>())</span>
<span id="cb388-6"><a href="cha-data-structures.html#cb388-6" aria-hidden="true" tabindex="-1"></a>    eigenAndSvdList <span class="ot">&lt;-</span> eigenAndSvdListDef<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb388-7"><a href="cha-data-structures.html#cb388-7" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb388-8"><a href="cha-data-structures.html#cb388-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">run =</span> <span class="cf">function</span>(){</span>
<span id="cb388-9"><a href="cha-data-structures.html#cb388-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># we will take the eigendecomposition and svd of a symmetric matrix</span></span>
<span id="cb388-10"><a href="cha-data-structures.html#cb388-10" aria-hidden="true" tabindex="-1"></a>    eigenAndSvdList<span class="sc">$</span>demoEigenList <span class="ot">&lt;&lt;-</span> <span class="fu">eigen</span>(demoMatrix, <span class="at">symmetric =</span> <span class="cn">TRUE</span>, </span>
<span id="cb388-11"><a href="cha-data-structures.html#cb388-11" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">only.values =</span> <span class="cn">TRUE</span>)</span>
<span id="cb388-12"><a href="cha-data-structures.html#cb388-12" aria-hidden="true" tabindex="-1"></a>    eigenAndSvdList<span class="sc">$</span>demoSvdList <span class="ot">&lt;&lt;-</span> <span class="fu">svd</span>(demoMatrix, <span class="at">vectors =</span> <span class="st">&#39;none&#39;</span>)</span>
<span id="cb388-13"><a href="cha-data-structures.html#cb388-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">returnType</span>(<span class="fu">eigenAndSvdListDef</span>())</span>
<span id="cb388-14"><a href="cha-data-structures.html#cb388-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(eigenAndSvdList)</span>
<span id="cb388-15"><a href="cha-data-structures.html#cb388-15" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb388-16"><a href="cha-data-structures.html#cb388-16" aria-hidden="true" tabindex="-1"></a>eigenListFunction <span class="ot">&lt;-</span> <span class="fu">eigenListFunctionGenerator</span>()</span>
<span id="cb388-17"><a href="cha-data-structures.html#cb388-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-18"><a href="cha-data-structures.html#cb388-18" aria-hidden="true" tabindex="-1"></a>outputList <span class="ot">&lt;-</span>  eigenListFunction<span class="sc">$</span><span class="fu">run</span>()</span>
<span id="cb388-19"><a href="cha-data-structures.html#cb388-19" aria-hidden="true" tabindex="-1"></a>outputList<span class="sc">$</span>demoEigenList<span class="sc">$</span>values</span></code></pre></div>
<pre><code>## [1] 9 1 1 1</code></pre>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="cha-data-structures.html#cb390-1" aria-hidden="true" tabindex="-1"></a>outputList<span class="sc">$</span>demoSvdList<span class="sc">$</span>d</span></code></pre></div>
<pre><code>## [1] 9 1 1 1</code></pre>
<p>The eigenvalues and singular values returned from the above function are the same since the matrix being decomposed was symmetric. However, note that both eigendecompositions and singular value decompositions are numerical procedures, and computed solutions may have slight differences even for a symmetric input matrix.</p>

<!--- % See http://yihui.name/knitr/demo/child/ for documentation on the parent/child document system of knitr -->
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="27">
<li id="fn27"><p>One may want to read this
section after an initial reading of Chapter <a href="cha-progr-with-models.html#cha-progr-with-models">15</a>.<a href="cha-data-structures.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>The <em>configuration</em> for a modelValues object is the same concept as a <em>definition</em> here; in a future release of NIMBLE we may make the usage more consistent between modelValues and nimbleLists.<a href="cha-data-structures.html#fnref28" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cha-using-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="cha-progr-with-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["NimbleUserManual.pdf", "NimbleUserManual.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toc_depth": 3
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
